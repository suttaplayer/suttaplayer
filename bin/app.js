"use strict";(()=>{var fs=Object.create;var Sr=Object.defineProperty;var vs=Object.getOwnPropertyDescriptor;var ys=Object.getOwnPropertyNames;var ws=Object.getPrototypeOf,Ps=Object.prototype.hasOwnProperty;var _s=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var bs=(s,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ys(e))!Ps.call(s,r)&&r!==t&&Sr(s,r,{get:()=>e[r],enumerable:!(i=vs(e,r))||i.enumerable});return s};var Fi=(s,e,t)=>(t=s!=null?fs(ws(s)):{},bs(e||!s||!s.__esModule?Sr(t,"default",{value:s,enumerable:!0}):t,s));var hi=_s((Tu,di)=>{"use strict";var yn=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{},ls=function(s){var e=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,t=0,i={},r={manual:s.Prism&&s.Prism.manual,disableWorkerMessageHandler:s.Prism&&s.Prism.disableWorkerMessageHandler,util:{encode:function h(d){return d instanceof n?new n(d.type,h(d.content),d.alias):Array.isArray(d)?d.map(h):d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(h){return Object.prototype.toString.call(h).slice(8,-1)},objId:function(h){return h.__id||Object.defineProperty(h,"__id",{value:++t}),h.__id},clone:function h(d,p){var g,m;switch(p=p||{},r.util.type(d)){case"Object":if(m=r.util.objId(d),p[m])return p[m];for(var v in g={},p[m]=g,d)d.hasOwnProperty(v)&&(g[v]=h(d[v],p));return g;case"Array":return m=r.util.objId(d),p[m]?p[m]:(g=[],p[m]=g,d.forEach(function(f,w){g[w]=h(f,p)}),g);default:return d}},getLanguage:function(h){for(;h;){var d=e.exec(h.className);if(d)return d[1].toLowerCase();h=h.parentElement}return"none"},setLanguage:function(h,d){h.className=h.className.replace(RegExp(e,"gi"),""),h.classList.add("language-"+d)},currentScript:function(){if(typeof document>"u")return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(g){var h=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(g.stack)||[])[1];if(h){var d=document.getElementsByTagName("script");for(var p in d)if(d[p].src==h)return d[p]}return null}},isActive:function(h,d,p){for(var g="no-"+d;h;){var m=h.classList;if(m.contains(d))return!0;if(m.contains(g))return!1;h=h.parentElement}return!!p}},languages:{plain:i,plaintext:i,text:i,txt:i,extend:function(h,d){var p=r.util.clone(r.languages[h]);for(var g in d)p[g]=d[g];return p},insertBefore:function(h,d,p,g){var m=(g=g||r.languages)[h],v={};for(var f in m)if(m.hasOwnProperty(f)){if(f==d)for(var w in p)p.hasOwnProperty(w)&&(v[w]=p[w]);p.hasOwnProperty(f)||(v[f]=m[f])}var k=g[h];return g[h]=v,r.languages.DFS(r.languages,function(S,I){I===k&&S!=h&&(this[S]=v)}),v},DFS:function h(d,p,g,m){m=m||{};var v=r.util.objId;for(var f in d)if(d.hasOwnProperty(f)){p.call(d,f,d[f],g||f);var w=d[f],k=r.util.type(w);k!=="Object"||m[v(w)]?k!=="Array"||m[v(w)]||(m[v(w)]=!0,h(w,p,f,m)):(m[v(w)]=!0,h(w,p,null,m))}}},plugins:{},highlightAll:function(h,d){r.highlightAllUnder(document,h,d)},highlightAllUnder:function(h,d,p){var g={callback:p,container:h,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};r.hooks.run("before-highlightall",g),g.elements=Array.prototype.slice.apply(g.container.querySelectorAll(g.selector)),r.hooks.run("before-all-elements-highlight",g);for(var m,v=0;m=g.elements[v++];)r.highlightElement(m,d===!0,g.callback)},highlightElement:function(h,d,p){var g=r.util.getLanguage(h),m=r.languages[g];r.util.setLanguage(h,g);var v=h.parentElement;v&&v.nodeName.toLowerCase()==="pre"&&r.util.setLanguage(v,g);var f={element:h,language:g,grammar:m,code:h.textContent};function w(S){f.highlightedCode=S,r.hooks.run("before-insert",f),f.element.innerHTML=f.highlightedCode,r.hooks.run("after-highlight",f),r.hooks.run("complete",f),p&&p.call(f.element)}if(r.hooks.run("before-sanity-check",f),(v=f.element.parentElement)&&v.nodeName.toLowerCase()==="pre"&&!v.hasAttribute("tabindex")&&v.setAttribute("tabindex","0"),!f.code)return r.hooks.run("complete",f),void(p&&p.call(f.element));if(r.hooks.run("before-highlight",f),f.grammar)if(d&&s.Worker){var k=new Worker(r.filename);k.onmessage=function(S){w(S.data)},k.postMessage(JSON.stringify({language:f.language,code:f.code,immediateClose:!0}))}else w(r.highlight(f.code,f.grammar,f.language));else w(r.util.encode(f.code))},highlight:function(h,d,p){var g={code:h,grammar:d,language:p};if(r.hooks.run("before-tokenize",g),!g.grammar)throw new Error('The language "'+g.language+'" has no grammar.');return g.tokens=r.tokenize(g.code,g.grammar),r.hooks.run("after-tokenize",g),n.stringify(r.util.encode(g.tokens),g.language)},tokenize:function(h,d){var p=d.rest;if(p){for(var g in p)d[g]=p[g];delete d.rest}var m=new l;return c(m,m.head,h),a(h,m,d,m.head,0),function(v){for(var f=[],w=v.head.next;w!==v.tail;)f.push(w.value),w=w.next;return f}(m)},hooks:{all:{},add:function(h,d){var p=r.hooks.all;p[h]=p[h]||[],p[h].push(d)},run:function(h,d){var p=r.hooks.all[h];if(p&&p.length)for(var g,m=0;g=p[m++];)g(d)}},Token:n};function n(h,d,p,g){this.type=h,this.content=d,this.alias=p,this.length=0|(g||"").length}function o(h,d,p,g){h.lastIndex=d;var m=h.exec(p);if(m&&g&&m[1]){var v=m[1].length;m.index+=v,m[0]=m[0].slice(v)}return m}function a(h,d,p,g,m,v){for(var f in p)if(p.hasOwnProperty(f)&&p[f]){var w=p[f];w=Array.isArray(w)?w:[w];for(var k=0;k<w.length;++k){if(v&&v.cause==f+","+k)return;var S=w[k],I=S.inside,C=!!S.lookbehind,R=!!S.greedy,W=S.alias;if(R&&!S.pattern.global){var te=S.pattern.toString().match(/[imsuy]*$/)[0];S.pattern=RegExp(S.pattern.source,te+"g")}for(var U=S.pattern||S,E=g.next,V=m;E!==d.tail&&!(v&&V>=v.reach);V+=E.value.length,E=E.next){var $=E.value;if(d.length>h.length)return;if(!($ instanceof n)){var M,_e=1;if(R){if(!(M=o(U,V,h,C))||M.index>=h.length)break;var re=M.index,Ze=M.index+M[0].length,de=V;for(de+=E.value.length;re>=de;)de+=(E=E.next).value.length;if(V=de-=E.value.length,E.value instanceof n)continue;for(var he=E;he!==d.tail&&(de<Ze||typeof he.value=="string");he=he.next)_e++,de+=he.value.length;_e--,$=h.slice(V,de),M.index-=V}else if(!(M=o(U,0,$,C)))continue;re=M.index;var be=M[0],ye=$.slice(0,re),ue=$.slice(re+be.length),ke=V+$.length;v&&ke>v.reach&&(v.reach=ke);var Se=E.prev;if(ye&&(Se=c(d,Se,ye),V+=ye.length),u(d,Se,_e),E=c(d,Se,new n(f,I?r.tokenize(be,I):be,W,be)),ue&&c(d,E,ue),_e>1){var pe={cause:f+","+k,reach:ke};a(h,d,p,E.prev,V,pe),v&&pe.reach>v.reach&&(v.reach=pe.reach)}}}}}}function l(){var h={value:null,prev:null,next:null},d={value:null,prev:h,next:null};h.next=d,this.head=h,this.tail=d,this.length=0}function c(h,d,p){var g=d.next,m={value:p,prev:d,next:g};return d.next=m,g.prev=m,h.length++,m}function u(h,d,p){for(var g=d.next,m=0;m<p&&g!==h.tail;m++)g=g.next;d.next=g,g.prev=d,h.length-=m}if(s.Prism=r,n.stringify=function h(d,p){if(typeof d=="string")return d;if(Array.isArray(d)){var g="";return d.forEach(function(k){g+=h(k,p)}),g}var m={type:d.type,content:h(d.content,p),tag:"span",classes:["token",d.type],attributes:{},language:p},v=d.alias;v&&(Array.isArray(v)?Array.prototype.push.apply(m.classes,v):m.classes.push(v)),r.hooks.run("wrap",m);var f="";for(var w in m.attributes)f+=" "+w+'="'+(m.attributes[w]||"").replace(/"/g,"&quot;")+'"';return"<"+m.tag+' class="'+m.classes.join(" ")+'"'+f+">"+m.content+"</"+m.tag+">"},!s.document)return s.addEventListener&&(r.disableWorkerMessageHandler||s.addEventListener("message",function(h){var d=JSON.parse(h.data),p=d.language,g=d.code,m=d.immediateClose;s.postMessage(r.highlight(g,r.languages[p],p)),m&&s.close()},!1)),r;var y=r.util.currentScript();function _(){r.manual||r.highlightAll()}if(y&&(r.filename=y.src,y.hasAttribute("data-manual")&&(r.manual=!0)),!r.manual){var P=document.readyState;P==="loading"||P==="interactive"&&y&&y.defer?document.addEventListener("DOMContentLoaded",_):window.requestAnimationFrame?window.requestAnimationFrame(_):window.setTimeout(_,16)}return r}(yn);typeof di<"u"&&di.exports&&(di.exports=ls),typeof global<"u"&&(global.Prism=ls)});var ks=function(){function s(e,t){t===void 0&&(t=[]),this._eventType=e,this._eventFunctions=t}return s.prototype.init=function(){var e=this;this._eventFunctions.forEach(function(t){typeof window<"u"&&window.addEventListener(e._eventType,t)})},s}(),Tr=ks;var Ss=function(){function s(){this._instances={Accordion:{},Carousel:{},Collapse:{},Dial:{},Dismiss:{},Drawer:{},Dropdown:{},Modal:{},Popover:{},Tabs:{},Tooltip:{},InputCounter:{}}}return s.prototype.addInstance=function(e,t,i,r){if(r===void 0&&(r=!1),!this._instances[e])return console.warn("Flowbite: Component ".concat(e," does not exist.")),!1;if(this._instances[e][i]&&!r){console.warn("Flowbite: Instance with ID ".concat(i," already exists."));return}r&&this._instances[e][i]&&this._instances[e][i].destroyAndRemoveInstance(),this._instances[e][i||this._generateRandomId()]=t},s.prototype.getAllInstances=function(){return this._instances},s.prototype.getInstances=function(e){return this._instances[e]?this._instances[e]:(console.warn("Flowbite: Component ".concat(e," does not exist.")),!1)},s.prototype.getInstance=function(e,t){if(this._componentAndInstanceCheck(e,t)){if(!this._instances[e][t]){console.warn("Flowbite: Instance with ID ".concat(t," does not exist."));return}return this._instances[e][t]}},s.prototype.destroyAndRemoveInstance=function(e,t){this._componentAndInstanceCheck(e,t)&&(this.destroyInstanceObject(e,t),this.removeInstance(e,t))},s.prototype.removeInstance=function(e,t){this._componentAndInstanceCheck(e,t)&&delete this._instances[e][t]},s.prototype.destroyInstanceObject=function(e,t){this._componentAndInstanceCheck(e,t)&&this._instances[e][t].destroy()},s.prototype.instanceExists=function(e,t){return!(!this._instances[e]||!this._instances[e][t])},s.prototype._generateRandomId=function(){return Math.random().toString(36).substr(2,9)},s.prototype._componentAndInstanceCheck=function(e,t){return this._instances[e]?this._instances[e][t]?!0:(console.warn("Flowbite: Instance with ID ".concat(t," does not exist.")),!1):(console.warn("Flowbite: Component ".concat(e," does not exist.")),!1)},s}(),Er=new Ss,b=Er;typeof window<"u"&&(window.FlowbiteInstances=Er);var Lt=function(){return Lt=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},Lt.apply(this,arguments)},$t={alwaysOpen:!1,activeClasses:"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white",inactiveClasses:"text-gray-500 dark:text-gray-400",onOpen:function(){},onClose:function(){},onToggle:function(){}},Ts={id:null,override:!0},Ar=function(){function s(e,t,i,r){e===void 0&&(e=null),t===void 0&&(t=[]),i===void 0&&(i=$t),r===void 0&&(r=Ts),this._instanceId=r.id?r.id:e.id,this._accordionEl=e,this._items=t,this._options=Lt(Lt({},$t),i),this._initialized=!1,this.init(),b.addInstance("Accordion",this,this._instanceId,r.override)}return s.prototype.init=function(){var e=this;this._items.length&&!this._initialized&&(this._items.forEach(function(t){t.active&&e.open(t.id);var i=function(){e.toggle(t.id)};t.triggerEl.addEventListener("click",i),t.clickHandler=i}),this._initialized=!0)},s.prototype.destroy=function(){this._items.length&&this._initialized&&(this._items.forEach(function(e){e.triggerEl.removeEventListener("click",e.clickHandler),delete e.clickHandler}),this._initialized=!1)},s.prototype.removeInstance=function(){b.removeInstance("Accordion",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype.getItem=function(e){return this._items.filter(function(t){return t.id===e})[0]},s.prototype.open=function(e){var t,i,r=this,n=this.getItem(e);this._options.alwaysOpen||this._items.map(function(o){var a,l;o!==n&&((a=o.triggerEl.classList).remove.apply(a,r._options.activeClasses.split(" ")),(l=o.triggerEl.classList).add.apply(l,r._options.inactiveClasses.split(" ")),o.targetEl.classList.add("hidden"),o.triggerEl.setAttribute("aria-expanded","false"),o.active=!1,o.iconEl&&o.iconEl.classList.remove("rotate-180"))}),(t=n.triggerEl.classList).add.apply(t,this._options.activeClasses.split(" ")),(i=n.triggerEl.classList).remove.apply(i,this._options.inactiveClasses.split(" ")),n.triggerEl.setAttribute("aria-expanded","true"),n.targetEl.classList.remove("hidden"),n.active=!0,n.iconEl&&n.iconEl.classList.add("rotate-180"),this._options.onOpen(this,n)},s.prototype.toggle=function(e){var t=this.getItem(e);t.active?this.close(e):this.open(e),this._options.onToggle(this,t)},s.prototype.close=function(e){var t,i,r=this.getItem(e);(t=r.triggerEl.classList).remove.apply(t,this._options.activeClasses.split(" ")),(i=r.triggerEl.classList).add.apply(i,this._options.inactiveClasses.split(" ")),r.targetEl.classList.add("hidden"),r.triggerEl.setAttribute("aria-expanded","false"),r.active=!1,r.iconEl&&r.iconEl.classList.remove("rotate-180"),this._options.onClose(this,r)},s}();function et(){document.querySelectorAll("[data-accordion]").forEach(function(s){var e=s.getAttribute("data-accordion"),t=s.getAttribute("data-active-classes"),i=s.getAttribute("data-inactive-classes"),r=[];s.querySelectorAll("[data-accordion-target]").forEach(function(n){if(n.closest("[data-accordion]")===s){var o={id:n.getAttribute("data-accordion-target"),triggerEl:n,targetEl:document.querySelector(n.getAttribute("data-accordion-target")),iconEl:n.querySelector("[data-accordion-icon]"),active:n.getAttribute("aria-expanded")==="true"};r.push(o)}}),new Ar(s,r,{alwaysOpen:e==="open",activeClasses:t||$t.activeClasses,inactiveClasses:i||$t.inactiveClasses})})}typeof window<"u"&&(window.Accordion=Ar,window.initAccordions=et);var Ht=function(){return Ht=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},Ht.apply(this,arguments)},Ir={onCollapse:function(){},onExpand:function(){},onToggle:function(){}},Es={id:null,override:!0},Ni=function(){function s(e,t,i,r){e===void 0&&(e=null),t===void 0&&(t=null),i===void 0&&(i=Ir),r===void 0&&(r=Es),this._instanceId=r.id?r.id:e.id,this._targetEl=e,this._triggerEl=t,this._options=Ht(Ht({},Ir),i),this._visible=!1,this._initialized=!1,this.init(),b.addInstance("Collapse",this,this._instanceId,r.override)}return s.prototype.init=function(){var e=this;this._triggerEl&&this._targetEl&&!this._initialized&&(this._triggerEl.hasAttribute("aria-expanded")?this._visible=this._triggerEl.getAttribute("aria-expanded")==="true":this._visible=!this._targetEl.classList.contains("hidden"),this._clickHandler=function(){e.toggle()},this._triggerEl.addEventListener("click",this._clickHandler),this._initialized=!0)},s.prototype.destroy=function(){this._triggerEl&&this._initialized&&(this._triggerEl.removeEventListener("click",this._clickHandler),this._initialized=!1)},s.prototype.removeInstance=function(){b.removeInstance("Collapse",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype.collapse=function(){this._targetEl.classList.add("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","false"),this._visible=!1,this._options.onCollapse(this)},s.prototype.expand=function(){this._targetEl.classList.remove("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","true"),this._visible=!0,this._options.onExpand(this)},s.prototype.toggle=function(){this._visible?this.collapse():this.expand(),this._options.onToggle(this)},s}();function tt(){document.querySelectorAll("[data-collapse-toggle]").forEach(function(s){var e=s.getAttribute("data-collapse-toggle"),t=document.getElementById(e);t?b.instanceExists("Collapse",t.getAttribute("id"))?new Ni(t,s,{},{id:t.getAttribute("id")+"_"+b._generateRandomId()}):new Ni(t,s):console.error('The target element with id "'.concat(e,'" does not exist. Please check the data-collapse-toggle attribute.'))})}typeof window<"u"&&(window.Collapse=Ni,window.initCollapses=tt);var Ne=function(){return Ne=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},Ne.apply(this,arguments)},Dt={defaultPosition:0,indicators:{items:[],activeClasses:"bg-white dark:bg-gray-800",inactiveClasses:"bg-white/50 dark:bg-gray-800/50 hover:bg-white dark:hover:bg-gray-800"},interval:3e3,onNext:function(){},onPrev:function(){},onChange:function(){}},As={id:null,override:!0},Rr=function(){function s(e,t,i,r){e===void 0&&(e=null),t===void 0&&(t=[]),i===void 0&&(i=Dt),r===void 0&&(r=As),this._instanceId=r.id?r.id:e.id,this._carouselEl=e,this._items=t,this._options=Ne(Ne(Ne({},Dt),i),{indicators:Ne(Ne({},Dt.indicators),i.indicators)}),this._activeItem=this.getItem(this._options.defaultPosition),this._indicators=this._options.indicators.items,this._intervalDuration=this._options.interval,this._intervalInstance=null,this._initialized=!1,this.init(),b.addInstance("Carousel",this,this._instanceId,r.override)}return s.prototype.init=function(){var e=this;this._items.length&&!this._initialized&&(this._items.map(function(t){t.el.classList.add("absolute","inset-0","transition-transform","transform")}),this._getActiveItem()?this.slideTo(this._getActiveItem().position):this.slideTo(0),this._indicators.map(function(t,i){t.el.addEventListener("click",function(){e.slideTo(i)})}),this._initialized=!0)},s.prototype.destroy=function(){this._initialized&&(this._initialized=!1)},s.prototype.removeInstance=function(){b.removeInstance("Carousel",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype.getItem=function(e){return this._items[e]},s.prototype.slideTo=function(e){var t=this._items[e],i={left:t.position===0?this._items[this._items.length-1]:this._items[t.position-1],middle:t,right:t.position===this._items.length-1?this._items[0]:this._items[t.position+1]};this._rotate(i),this._setActiveItem(t),this._intervalInstance&&(this.pause(),this.cycle()),this._options.onChange(this)},s.prototype.next=function(){var e=this._getActiveItem(),t=null;e.position===this._items.length-1?t=this._items[0]:t=this._items[e.position+1],this.slideTo(t.position),this._options.onNext(this)},s.prototype.prev=function(){var e=this._getActiveItem(),t=null;e.position===0?t=this._items[this._items.length-1]:t=this._items[e.position-1],this.slideTo(t.position),this._options.onPrev(this)},s.prototype._rotate=function(e){this._items.map(function(t){t.el.classList.add("hidden")}),e.left.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),e.left.el.classList.add("-translate-x-full","z-10"),e.middle.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-10"),e.middle.el.classList.add("translate-x-0","z-20"),e.right.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),e.right.el.classList.add("translate-x-full","z-10")},s.prototype.cycle=function(){var e=this;typeof window<"u"&&(this._intervalInstance=window.setInterval(function(){e.next()},this._intervalDuration))},s.prototype.pause=function(){clearInterval(this._intervalInstance)},s.prototype._getActiveItem=function(){return this._activeItem},s.prototype._setActiveItem=function(e){var t,i,r=this;this._activeItem=e;var n=e.position;this._indicators.length&&(this._indicators.map(function(o){var a,l;o.el.setAttribute("aria-current","false"),(a=o.el.classList).remove.apply(a,r._options.indicators.activeClasses.split(" ")),(l=o.el.classList).add.apply(l,r._options.indicators.inactiveClasses.split(" "))}),(t=this._indicators[n].el.classList).add.apply(t,this._options.indicators.activeClasses.split(" ")),(i=this._indicators[n].el.classList).remove.apply(i,this._options.indicators.inactiveClasses.split(" ")),this._indicators[n].el.setAttribute("aria-current","true"))},s}();function it(){document.querySelectorAll("[data-carousel]").forEach(function(s){var e=s.getAttribute("data-carousel-interval"),t=s.getAttribute("data-carousel")==="slide",i=[],r=0;s.querySelectorAll("[data-carousel-item]").length&&Array.from(s.querySelectorAll("[data-carousel-item]")).map(function(c,u){i.push({position:u,el:c}),c.getAttribute("data-carousel-item")==="active"&&(r=u)});var n=[];s.querySelectorAll("[data-carousel-slide-to]").length&&Array.from(s.querySelectorAll("[data-carousel-slide-to]")).map(function(c){n.push({position:parseInt(c.getAttribute("data-carousel-slide-to")),el:c})});var o=new Rr(s,i,{defaultPosition:r,indicators:{items:n},interval:e||Dt.interval});t&&o.cycle();var a=s.querySelector("[data-carousel-next]"),l=s.querySelector("[data-carousel-prev]");a&&a.addEventListener("click",function(){o.next()}),l&&l.addEventListener("click",function(){o.prev()})})}typeof window<"u"&&(window.Carousel=Rr,window.initCarousels=it);var Ot=function(){return Ot=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},Ot.apply(this,arguments)},xr={transition:"transition-opacity",duration:300,timing:"ease-out",onHide:function(){}},Is={id:null,override:!0},Wi=function(){function s(e,t,i,r){e===void 0&&(e=null),t===void 0&&(t=null),i===void 0&&(i=xr),r===void 0&&(r=Is),this._instanceId=r.id?r.id:e.id,this._targetEl=e,this._triggerEl=t,this._options=Ot(Ot({},xr),i),this._initialized=!1,this.init(),b.addInstance("Dismiss",this,this._instanceId,r.override)}return s.prototype.init=function(){var e=this;this._triggerEl&&this._targetEl&&!this._initialized&&(this._clickHandler=function(){e.hide()},this._triggerEl.addEventListener("click",this._clickHandler),this._initialized=!0)},s.prototype.destroy=function(){this._triggerEl&&this._initialized&&(this._triggerEl.removeEventListener("click",this._clickHandler),this._initialized=!1)},s.prototype.removeInstance=function(){b.removeInstance("Dismiss",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype.hide=function(){var e=this;this._targetEl.classList.add(this._options.transition,"duration-".concat(this._options.duration),this._options.timing,"opacity-0"),setTimeout(function(){e._targetEl.classList.add("hidden")},this._options.duration),this._options.onHide(this,this._targetEl)},s}();function rt(){document.querySelectorAll("[data-dismiss-target]").forEach(function(s){var e=s.getAttribute("data-dismiss-target"),t=document.querySelector(e);t?new Wi(t,s):console.error('The dismiss element with id "'.concat(e,'" does not exist. Please check the data-dismiss-target attribute.'))})}typeof window<"u"&&(window.Dismiss=Wi,window.initDismisses=rt);var Ui=Wi;var x="top",B="bottom",H="right",L="left",Bt="auto",Re=[x,B,H,L],Te="start",We="end",Cr="clippingParents",Ft="viewport",st="popper",Mr="reference",Vi=Re.reduce(function(s,e){return s.concat([e+"-"+Te,e+"-"+We])},[]),Nt=[].concat(Re,[Bt]).reduce(function(s,e){return s.concat([e,e+"-"+Te,e+"-"+We])},[]),Rs="beforeRead",xs="read",Cs="afterRead",Ms="beforeMain",Ls="main",$s="afterMain",Hs="beforeWrite",Ds="write",Os="afterWrite",Lr=[Rs,xs,Cs,Ms,Ls,$s,Hs,Ds,Os];function z(s){return s?(s.nodeName||"").toLowerCase():null}function T(s){if(s==null)return window;if(s.toString()!=="[object Window]"){var e=s.ownerDocument;return e&&e.defaultView||window}return s}function se(s){var e=T(s).Element;return s instanceof e||s instanceof Element}function F(s){var e=T(s).HTMLElement;return s instanceof e||s instanceof HTMLElement}function nt(s){if(typeof ShadowRoot>"u")return!1;var e=T(s).ShadowRoot;return s instanceof e||s instanceof ShadowRoot}function Bs(s){var e=s.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},r=e.attributes[t]||{},n=e.elements[t];!F(n)||!z(n)||(Object.assign(n.style,i),Object.keys(r).forEach(function(o){var a=r[o];a===!1?n.removeAttribute(o):n.setAttribute(o,a===!0?"":a)}))})}function Fs(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var r=e.elements[i],n=e.attributes[i]||{},o=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]),a=o.reduce(function(l,c){return l[c]="",l},{});!F(r)||!z(r)||(Object.assign(r.style,a),Object.keys(n).forEach(function(l){r.removeAttribute(l)}))})}}var $r={name:"applyStyles",enabled:!0,phase:"write",fn:Bs,effect:Fs,requires:["computeStyles"]};function q(s){return s.split("-")[0]}var ge=Math.max,Ue=Math.min,Ee=Math.round;function ot(){var s=navigator.userAgentData;return s!=null&&s.brands&&Array.isArray(s.brands)?s.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Pt(){return!/^((?!chrome|android).)*safari/i.test(ot())}function ne(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=s.getBoundingClientRect(),r=1,n=1;e&&F(s)&&(r=s.offsetWidth>0&&Ee(i.width)/s.offsetWidth||1,n=s.offsetHeight>0&&Ee(i.height)/s.offsetHeight||1);var o=se(s)?T(s):window,a=o.visualViewport,l=!Pt()&&t,c=(i.left+(l&&a?a.offsetLeft:0))/r,u=(i.top+(l&&a?a.offsetTop:0))/n,y=i.width/r,_=i.height/n;return{width:y,height:_,top:u,right:c+y,bottom:u+_,left:c,x:c,y:u}}function Ve(s){var e=ne(s),t=s.offsetWidth,i=s.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:s.offsetLeft,y:s.offsetTop,width:t,height:i}}function _t(s,e){var t=e.getRootNode&&e.getRootNode();if(s.contains(e))return!0;if(t&&nt(t)){var i=e;do{if(i&&s.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function X(s){return T(s).getComputedStyle(s)}function zi(s){return["table","td","th"].indexOf(z(s))>=0}function Y(s){return((se(s)?s.ownerDocument:s.document)||window.document).documentElement}function Ae(s){return z(s)==="html"?s:s.assignedSlot||s.parentNode||(nt(s)?s.host:null)||Y(s)}function Hr(s){return!F(s)||X(s).position==="fixed"?null:s.offsetParent}function Ns(s){var e=/firefox/i.test(ot()),t=/Trident/i.test(ot());if(t&&F(s)){var i=X(s);if(i.position==="fixed")return null}var r=Ae(s);for(nt(r)&&(r=r.host);F(r)&&["html","body"].indexOf(z(r))<0;){var n=X(r);if(n.transform!=="none"||n.perspective!=="none"||n.contain==="paint"||["transform","perspective"].indexOf(n.willChange)!==-1||e&&n.willChange==="filter"||e&&n.filter&&n.filter!=="none")return r;r=r.parentNode}return null}function me(s){for(var e=T(s),t=Hr(s);t&&zi(t)&&X(t).position==="static";)t=Hr(t);return t&&(z(t)==="html"||z(t)==="body"&&X(t).position==="static")?e:t||Ns(s)||e}function ze(s){return["top","bottom"].indexOf(s)>=0?"x":"y"}function qe(s,e,t){return ge(s,Ue(e,t))}function Dr(s,e,t){var i=qe(s,e,t);return i>t?t:i}function bt(){return{top:0,right:0,bottom:0,left:0}}function kt(s){return Object.assign({},bt(),s)}function St(s,e){return e.reduce(function(t,i){return t[i]=s,t},{})}var Ws=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,kt(typeof e!="number"?e:St(e,Re))};function Us(s){var e,t=s.state,i=s.name,r=s.options,n=t.elements.arrow,o=t.modifiersData.popperOffsets,a=q(t.placement),l=ze(a),c=[L,H].indexOf(a)>=0,u=c?"height":"width";if(!(!n||!o)){var y=Ws(r.padding,t),_=Ve(n),P=l==="y"?x:L,h=l==="y"?B:H,d=t.rects.reference[u]+t.rects.reference[l]-o[l]-t.rects.popper[u],p=o[l]-t.rects.reference[l],g=me(n),m=g?l==="y"?g.clientHeight||0:g.clientWidth||0:0,v=d/2-p/2,f=y[P],w=m-_[u]-y[h],k=m/2-_[u]/2+v,S=qe(f,k,w),I=l;t.modifiersData[i]=(e={},e[I]=S,e.centerOffset=S-k,e)}}function Vs(s){var e=s.state,t=s.options,i=t.element,r=i===void 0?"[data-popper-arrow]":i;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||_t(e.elements.popper,r)&&(e.elements.arrow=r))}var Or={name:"arrow",enabled:!0,phase:"main",fn:Us,effect:Vs,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function oe(s){return s.split("-")[1]}var zs={top:"auto",right:"auto",bottom:"auto",left:"auto"};function qs(s,e){var t=s.x,i=s.y,r=e.devicePixelRatio||1;return{x:Ee(t*r)/r||0,y:Ee(i*r)/r||0}}function Br(s){var e,t=s.popper,i=s.popperRect,r=s.placement,n=s.variation,o=s.offsets,a=s.position,l=s.gpuAcceleration,c=s.adaptive,u=s.roundOffsets,y=s.isFixed,_=o.x,P=_===void 0?0:_,h=o.y,d=h===void 0?0:h,p=typeof u=="function"?u({x:P,y:d}):{x:P,y:d};P=p.x,d=p.y;var g=o.hasOwnProperty("x"),m=o.hasOwnProperty("y"),v=L,f=x,w=window;if(c){var k=me(t),S="clientHeight",I="clientWidth";if(k===T(t)&&(k=Y(t),X(k).position!=="static"&&a==="absolute"&&(S="scrollHeight",I="scrollWidth")),k=k,r===x||(r===L||r===H)&&n===We){f=B;var C=y&&k===w&&w.visualViewport?w.visualViewport.height:k[S];d-=C-i.height,d*=l?1:-1}if(r===L||(r===x||r===B)&&n===We){v=H;var R=y&&k===w&&w.visualViewport?w.visualViewport.width:k[I];P-=R-i.width,P*=l?1:-1}}var W=Object.assign({position:a},c&&zs),te=u===!0?qs({x:P,y:d},T(t)):{x:P,y:d};if(P=te.x,d=te.y,l){var U;return Object.assign({},W,(U={},U[f]=m?"0":"",U[v]=g?"0":"",U.transform=(w.devicePixelRatio||1)<=1?"translate("+P+"px, "+d+"px)":"translate3d("+P+"px, "+d+"px, 0)",U))}return Object.assign({},W,(e={},e[f]=m?d+"px":"",e[v]=g?P+"px":"",e.transform="",e))}function js(s){var e=s.state,t=s.options,i=t.gpuAcceleration,r=i===void 0?!0:i,n=t.adaptive,o=n===void 0?!0:n,a=t.roundOffsets,l=a===void 0?!0:a,c={placement:q(e.placement),variation:oe(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Br(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Br(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var Fr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:js,data:{}};var Wt={passive:!0};function Ys(s){var e=s.state,t=s.instance,i=s.options,r=i.scroll,n=r===void 0?!0:r,o=i.resize,a=o===void 0?!0:o,l=T(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return n&&c.forEach(function(u){u.addEventListener("scroll",t.update,Wt)}),a&&l.addEventListener("resize",t.update,Wt),function(){n&&c.forEach(function(u){u.removeEventListener("scroll",t.update,Wt)}),a&&l.removeEventListener("resize",t.update,Wt)}}var Nr={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Ys,data:{}};var Ks={left:"right",right:"left",bottom:"top",top:"bottom"};function at(s){return s.replace(/left|right|bottom|top/g,function(e){return Ks[e]})}var Xs={start:"end",end:"start"};function Ut(s){return s.replace(/start|end/g,function(e){return Xs[e]})}function je(s){var e=T(s),t=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:t,scrollTop:i}}function Ye(s){return ne(Y(s)).left+je(s).scrollLeft}function qi(s,e){var t=T(s),i=Y(s),r=t.visualViewport,n=i.clientWidth,o=i.clientHeight,a=0,l=0;if(r){n=r.width,o=r.height;var c=Pt();(c||!c&&e==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}return{width:n,height:o,x:a+Ye(s),y:l}}function ji(s){var e,t=Y(s),i=je(s),r=(e=s.ownerDocument)==null?void 0:e.body,n=ge(t.scrollWidth,t.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=ge(t.scrollHeight,t.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),a=-i.scrollLeft+Ye(s),l=-i.scrollTop;return X(r||t).direction==="rtl"&&(a+=ge(t.clientWidth,r?r.clientWidth:0)-n),{width:n,height:o,x:a,y:l}}function Ke(s){var e=X(s),t=e.overflow,i=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+r+i)}function Vt(s){return["html","body","#document"].indexOf(z(s))>=0?s.ownerDocument.body:F(s)&&Ke(s)?s:Vt(Ae(s))}function xe(s,e){var t;e===void 0&&(e=[]);var i=Vt(s),r=i===((t=s.ownerDocument)==null?void 0:t.body),n=T(i),o=r?[n].concat(n.visualViewport||[],Ke(i)?i:[]):i,a=e.concat(o);return r?a:a.concat(xe(Ae(o)))}function lt(s){return Object.assign({},s,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})}function Js(s,e){var t=ne(s,!1,e==="fixed");return t.top=t.top+s.clientTop,t.left=t.left+s.clientLeft,t.bottom=t.top+s.clientHeight,t.right=t.left+s.clientWidth,t.width=s.clientWidth,t.height=s.clientHeight,t.x=t.left,t.y=t.top,t}function Wr(s,e,t){return e===Ft?lt(qi(s,t)):se(e)?Js(e,t):lt(ji(Y(s)))}function Gs(s){var e=xe(Ae(s)),t=["absolute","fixed"].indexOf(X(s).position)>=0,i=t&&F(s)?me(s):s;return se(i)?e.filter(function(r){return se(r)&&_t(r,i)&&z(r)!=="body"}):[]}function Yi(s,e,t,i){var r=e==="clippingParents"?Gs(s):[].concat(e),n=[].concat(r,[t]),o=n[0],a=n.reduce(function(l,c){var u=Wr(s,c,i);return l.top=ge(u.top,l.top),l.right=Ue(u.right,l.right),l.bottom=Ue(u.bottom,l.bottom),l.left=ge(u.left,l.left),l},Wr(s,o,i));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Tt(s){var e=s.reference,t=s.element,i=s.placement,r=i?q(i):null,n=i?oe(i):null,o=e.x+e.width/2-t.width/2,a=e.y+e.height/2-t.height/2,l;switch(r){case x:l={x:o,y:e.y-t.height};break;case B:l={x:o,y:e.y+e.height};break;case H:l={x:e.x+e.width,y:a};break;case L:l={x:e.x-t.width,y:a};break;default:l={x:e.x,y:e.y}}var c=r?ze(r):null;if(c!=null){var u=c==="y"?"height":"width";switch(n){case Te:l[c]=l[c]-(e[u]/2-t[u]/2);break;case We:l[c]=l[c]+(e[u]/2-t[u]/2);break;default:}}return l}function fe(s,e){e===void 0&&(e={});var t=e,i=t.placement,r=i===void 0?s.placement:i,n=t.strategy,o=n===void 0?s.strategy:n,a=t.boundary,l=a===void 0?Cr:a,c=t.rootBoundary,u=c===void 0?Ft:c,y=t.elementContext,_=y===void 0?st:y,P=t.altBoundary,h=P===void 0?!1:P,d=t.padding,p=d===void 0?0:d,g=kt(typeof p!="number"?p:St(p,Re)),m=_===st?Mr:st,v=s.rects.popper,f=s.elements[h?m:_],w=Yi(se(f)?f:f.contextElement||Y(s.elements.popper),l,u,o),k=ne(s.elements.reference),S=Tt({reference:k,element:v,strategy:"absolute",placement:r}),I=lt(Object.assign({},v,S)),C=_===st?I:k,R={top:w.top-C.top+g.top,bottom:C.bottom-w.bottom+g.bottom,left:w.left-C.left+g.left,right:C.right-w.right+g.right},W=s.modifiersData.offset;if(_===st&&W){var te=W[r];Object.keys(R).forEach(function(U){var E=[H,B].indexOf(U)>=0?1:-1,V=[x,B].indexOf(U)>=0?"y":"x";R[U]+=te[V]*E})}return R}function Ki(s,e){e===void 0&&(e={});var t=e,i=t.placement,r=t.boundary,n=t.rootBoundary,o=t.padding,a=t.flipVariations,l=t.allowedAutoPlacements,c=l===void 0?Nt:l,u=oe(i),y=u?a?Vi:Vi.filter(function(h){return oe(h)===u}):Re,_=y.filter(function(h){return c.indexOf(h)>=0});_.length===0&&(_=y);var P=_.reduce(function(h,d){return h[d]=fe(s,{placement:d,boundary:r,rootBoundary:n,padding:o})[q(d)],h},{});return Object.keys(P).sort(function(h,d){return P[h]-P[d]})}function Qs(s){if(q(s)===Bt)return[];var e=at(s);return[Ut(s),e,Ut(e)]}function Zs(s){var e=s.state,t=s.options,i=s.name;if(!e.modifiersData[i]._skip){for(var r=t.mainAxis,n=r===void 0?!0:r,o=t.altAxis,a=o===void 0?!0:o,l=t.fallbackPlacements,c=t.padding,u=t.boundary,y=t.rootBoundary,_=t.altBoundary,P=t.flipVariations,h=P===void 0?!0:P,d=t.allowedAutoPlacements,p=e.options.placement,g=q(p),m=g===p,v=l||(m||!h?[at(p)]:Qs(p)),f=[p].concat(v).reduce(function(ye,ue){return ye.concat(q(ue)===Bt?Ki(e,{placement:ue,boundary:u,rootBoundary:y,padding:c,flipVariations:h,allowedAutoPlacements:d}):ue)},[]),w=e.rects.reference,k=e.rects.popper,S=new Map,I=!0,C=f[0],R=0;R<f.length;R++){var W=f[R],te=q(W),U=oe(W)===Te,E=[x,B].indexOf(te)>=0,V=E?"width":"height",$=fe(e,{placement:W,boundary:u,rootBoundary:y,altBoundary:_,padding:c}),M=E?U?H:L:U?B:x;w[V]>k[V]&&(M=at(M));var _e=at(M),re=[];if(n&&re.push($[te]<=0),a&&re.push($[M]<=0,$[_e]<=0),re.every(function(ye){return ye})){C=W,I=!1;break}S.set(W,re)}if(I)for(var Ze=h?3:1,de=function(ue){var ke=f.find(function(Se){var pe=S.get(Se);if(pe)return pe.slice(0,ue).every(function(Di){return Di})});if(ke)return C=ke,"break"},he=Ze;he>0;he--){var be=de(he);if(be==="break")break}e.placement!==C&&(e.modifiersData[i]._skip=!0,e.placement=C,e.reset=!0)}}var Ur={name:"flip",enabled:!0,phase:"main",fn:Zs,requiresIfExists:["offset"],data:{_skip:!1}};function Vr(s,e,t){return t===void 0&&(t={x:0,y:0}),{top:s.top-e.height-t.y,right:s.right-e.width+t.x,bottom:s.bottom-e.height+t.y,left:s.left-e.width-t.x}}function zr(s){return[x,H,B,L].some(function(e){return s[e]>=0})}function en(s){var e=s.state,t=s.name,i=e.rects.reference,r=e.rects.popper,n=e.modifiersData.preventOverflow,o=fe(e,{elementContext:"reference"}),a=fe(e,{altBoundary:!0}),l=Vr(o,i),c=Vr(a,r,n),u=zr(l),y=zr(c);e.modifiersData[t]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:y},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":y})}var qr={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:en};function tn(s,e,t){var i=q(s),r=[L,x].indexOf(i)>=0?-1:1,n=typeof t=="function"?t(Object.assign({},e,{placement:s})):t,o=n[0],a=n[1];return o=o||0,a=(a||0)*r,[L,H].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}function rn(s){var e=s.state,t=s.options,i=s.name,r=t.offset,n=r===void 0?[0,0]:r,o=Nt.reduce(function(u,y){return u[y]=tn(y,e.rects,n),u},{}),a=o[e.placement],l=a.x,c=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[i]=o}var jr={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:rn};function sn(s){var e=s.state,t=s.name;e.modifiersData[t]=Tt({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var Yr={name:"popperOffsets",enabled:!0,phase:"read",fn:sn,data:{}};function Xi(s){return s==="x"?"y":"x"}function nn(s){var e=s.state,t=s.options,i=s.name,r=t.mainAxis,n=r===void 0?!0:r,o=t.altAxis,a=o===void 0?!1:o,l=t.boundary,c=t.rootBoundary,u=t.altBoundary,y=t.padding,_=t.tether,P=_===void 0?!0:_,h=t.tetherOffset,d=h===void 0?0:h,p=fe(e,{boundary:l,rootBoundary:c,padding:y,altBoundary:u}),g=q(e.placement),m=oe(e.placement),v=!m,f=ze(g),w=Xi(f),k=e.modifiersData.popperOffsets,S=e.rects.reference,I=e.rects.popper,C=typeof d=="function"?d(Object.assign({},e.rects,{placement:e.placement})):d,R=typeof C=="number"?{mainAxis:C,altAxis:C}:Object.assign({mainAxis:0,altAxis:0},C),W=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,te={x:0,y:0};if(k){if(n){var U,E=f==="y"?x:L,V=f==="y"?B:H,$=f==="y"?"height":"width",M=k[f],_e=M+p[E],re=M-p[V],Ze=P?-I[$]/2:0,de=m===Te?S[$]:I[$],he=m===Te?-I[$]:-S[$],be=e.elements.arrow,ye=P&&be?Ve(be):{width:0,height:0},ue=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:bt(),ke=ue[E],Se=ue[V],pe=qe(0,S[$],ye[$]),Di=v?S[$]/2-Ze-pe-ke-R.mainAxis:de-pe-ke-R.mainAxis,ds=v?-S[$]/2+Ze+pe+Se+R.mainAxis:he+pe+Se+R.mainAxis,Oi=e.elements.arrow&&me(e.elements.arrow),hs=Oi?f==="y"?Oi.clientTop||0:Oi.clientLeft||0:0,mr=(U=W?.[f])!=null?U:0,us=M+Di-mr-hs,ps=M+ds-mr,fr=qe(P?Ue(_e,us):_e,M,P?ge(re,ps):re);k[f]=fr,te[f]=fr-M}if(a){var vr,gs=f==="x"?x:L,ms=f==="x"?B:H,Fe=k[w],Mt=w==="y"?"height":"width",yr=Fe+p[gs],wr=Fe-p[ms],Bi=[x,L].indexOf(g)!==-1,Pr=(vr=W?.[w])!=null?vr:0,_r=Bi?yr:Fe-S[Mt]-I[Mt]-Pr+R.altAxis,br=Bi?Fe+S[Mt]+I[Mt]-Pr-R.altAxis:wr,kr=P&&Bi?Dr(_r,Fe,br):qe(P?_r:yr,Fe,P?br:wr);k[w]=kr,te[w]=kr-Fe}e.modifiersData[i]=te}}var Kr={name:"preventOverflow",enabled:!0,phase:"main",fn:nn,requiresIfExists:["offset"]};function Ji(s){return{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}}function Gi(s){return s===T(s)||!F(s)?je(s):Ji(s)}function on(s){var e=s.getBoundingClientRect(),t=Ee(e.width)/s.offsetWidth||1,i=Ee(e.height)/s.offsetHeight||1;return t!==1||i!==1}function Qi(s,e,t){t===void 0&&(t=!1);var i=F(e),r=F(e)&&on(e),n=Y(e),o=ne(s,r,t),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!t)&&((z(e)!=="body"||Ke(n))&&(a=Gi(e)),F(e)?(l=ne(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):n&&(l.x=Ye(n))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function an(s){var e=new Map,t=new Set,i=[];s.forEach(function(n){e.set(n.name,n)});function r(n){t.add(n.name);var o=[].concat(n.requires||[],n.requiresIfExists||[]);o.forEach(function(a){if(!t.has(a)){var l=e.get(a);l&&r(l)}}),i.push(n)}return s.forEach(function(n){t.has(n.name)||r(n)}),i}function Zi(s){var e=an(s);return Lr.reduce(function(t,i){return t.concat(e.filter(function(r){return r.phase===i}))},[])}function er(s){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(s())})})),e}}function tr(s){var e=s.reduce(function(t,i){var r=t[i.name];return t[i.name]=r?Object.assign({},r,i,{options:Object.assign({},r.options,i.options),data:Object.assign({},r.data,i.data)}):i,t},{});return Object.keys(e).map(function(t){return e[t]})}var Xr={placement:"bottom",modifiers:[],strategy:"absolute"};function Jr(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Gr(s){s===void 0&&(s={});var e=s,t=e.defaultModifiers,i=t===void 0?[]:t,r=e.defaultOptions,n=r===void 0?Xr:r;return function(a,l,c){c===void 0&&(c=n);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},Xr,n),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},y=[],_=!1,P={state:u,setOptions:function(g){var m=typeof g=="function"?g(u.options):g;d(),u.options=Object.assign({},n,u.options,m),u.scrollParents={reference:se(a)?xe(a):a.contextElement?xe(a.contextElement):[],popper:xe(l)};var v=Zi(tr([].concat(i,u.options.modifiers)));return u.orderedModifiers=v.filter(function(f){return f.enabled}),h(),P.update()},forceUpdate:function(){if(!_){var g=u.elements,m=g.reference,v=g.popper;if(Jr(m,v)){u.rects={reference:Qi(m,me(v),u.options.strategy==="fixed"),popper:Ve(v)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(R){return u.modifiersData[R.name]=Object.assign({},R.data)});for(var f=0;f<u.orderedModifiers.length;f++){if(u.reset===!0){u.reset=!1,f=-1;continue}var w=u.orderedModifiers[f],k=w.fn,S=w.options,I=S===void 0?{}:S,C=w.name;typeof k=="function"&&(u=k({state:u,options:I,name:C,instance:P})||u)}}}},update:er(function(){return new Promise(function(p){P.forceUpdate(),p(u)})}),destroy:function(){d(),_=!0}};if(!Jr(a,l))return P;P.setOptions(c).then(function(p){!_&&c.onFirstUpdate&&c.onFirstUpdate(p)});function h(){u.orderedModifiers.forEach(function(p){var g=p.name,m=p.options,v=m===void 0?{}:m,f=p.effect;if(typeof f=="function"){var w=f({state:u,name:g,instance:P,options:v}),k=function(){};y.push(w||k)}})}function d(){y.forEach(function(p){return p()}),y=[]}return P}}var ln=[Nr,Yr,Fr,$r,jr,Ur,Kr,Or,qr],Xe=Gr({defaultModifiers:ln});var Ce=function(){return Ce=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},Ce.apply(this,arguments)},zt=function(s,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,n;i<r;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return s.concat(n||Array.prototype.slice.call(e))},Me={placement:"bottom",triggerType:"click",offsetSkidding:0,offsetDistance:10,delay:300,ignoreClickOutsideClass:!1,onShow:function(){},onHide:function(){},onToggle:function(){}},cn={id:null,override:!0},Qr=function(){function s(e,t,i,r){e===void 0&&(e=null),t===void 0&&(t=null),i===void 0&&(i=Me),r===void 0&&(r=cn),this._instanceId=r.id?r.id:e.id,this._targetEl=e,this._triggerEl=t,this._options=Ce(Ce({},Me),i),this._popperInstance=null,this._visible=!1,this._initialized=!1,this.init(),b.addInstance("Dropdown",this,this._instanceId,r.override)}return s.prototype.init=function(){this._triggerEl&&this._targetEl&&!this._initialized&&(this._popperInstance=this._createPopperInstance(),this._setupEventListeners(),this._initialized=!0)},s.prototype.destroy=function(){var e=this,t=this._getTriggerEvents();this._options.triggerType==="click"&&t.showEvents.forEach(function(i){e._triggerEl.removeEventListener(i,e._clickHandler)}),this._options.triggerType==="hover"&&(t.showEvents.forEach(function(i){e._triggerEl.removeEventListener(i,e._hoverShowTriggerElHandler),e._targetEl.removeEventListener(i,e._hoverShowTargetElHandler)}),t.hideEvents.forEach(function(i){e._triggerEl.removeEventListener(i,e._hoverHideHandler),e._targetEl.removeEventListener(i,e._hoverHideHandler)})),this._popperInstance.destroy(),this._initialized=!1},s.prototype.removeInstance=function(){b.removeInstance("Dropdown",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype._setupEventListeners=function(){var e=this,t=this._getTriggerEvents();this._clickHandler=function(){e.toggle()},this._options.triggerType==="click"&&t.showEvents.forEach(function(i){e._triggerEl.addEventListener(i,e._clickHandler)}),this._hoverShowTriggerElHandler=function(i){i.type==="click"?e.toggle():setTimeout(function(){e.show()},e._options.delay)},this._hoverShowTargetElHandler=function(){e.show()},this._hoverHideHandler=function(){setTimeout(function(){e._targetEl.matches(":hover")||e.hide()},e._options.delay)},this._options.triggerType==="hover"&&(t.showEvents.forEach(function(i){e._triggerEl.addEventListener(i,e._hoverShowTriggerElHandler),e._targetEl.addEventListener(i,e._hoverShowTargetElHandler)}),t.hideEvents.forEach(function(i){e._triggerEl.addEventListener(i,e._hoverHideHandler),e._targetEl.addEventListener(i,e._hoverHideHandler)}))},s.prototype._createPopperInstance=function(){return Xe(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[this._options.offsetSkidding,this._options.offsetDistance]}}]})},s.prototype._setupClickOutsideListener=function(){var e=this;this._clickOutsideEventListener=function(t){e._handleClickOutside(t,e._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},s.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},s.prototype._handleClickOutside=function(e,t){var i=e.target,r=this._options.ignoreClickOutsideClass,n=!1;if(r){var o=document.querySelectorAll(".".concat(r));o.forEach(function(a){if(a.contains(i)){n=!0;return}})}i!==t&&!t.contains(i)&&!this._triggerEl.contains(i)&&!n&&this.isVisible()&&this.hide()},s.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","click"],hideEvents:["mouseleave"]};case"click":return{showEvents:["click"],hideEvents:[]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["click"],hideEvents:[]}}},s.prototype.toggle=function(){this.isVisible()?this.hide():this.show(),this._options.onToggle(this)},s.prototype.isVisible=function(){return this._visible},s.prototype.show=function(){this._targetEl.classList.remove("hidden"),this._targetEl.classList.add("block"),this._popperInstance.setOptions(function(e){return Ce(Ce({},e),{modifiers:zt(zt([],e.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},s.prototype.hide=function(){this._targetEl.classList.remove("block"),this._targetEl.classList.add("hidden"),this._popperInstance.setOptions(function(e){return Ce(Ce({},e),{modifiers:zt(zt([],e.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._visible=!1,this._removeClickOutsideListener(),this._options.onHide(this)},s}();function Z(){document.querySelectorAll("[data-dropdown-toggle]").forEach(function(s){var e=s.getAttribute("data-dropdown-toggle"),t=document.getElementById(e);if(t){var i=s.getAttribute("data-dropdown-placement"),r=s.getAttribute("data-dropdown-offset-skidding"),n=s.getAttribute("data-dropdown-offset-distance"),o=s.getAttribute("data-dropdown-trigger"),a=s.getAttribute("data-dropdown-delay"),l=s.getAttribute("data-dropdown-ignore-click-outside-class");new Qr(t,s,{placement:i||Me.placement,triggerType:o||Me.triggerType,offsetSkidding:r?parseInt(r):Me.offsetSkidding,offsetDistance:n?parseInt(n):Me.offsetDistance,delay:a?parseInt(a):Me.delay,ignoreClickOutsideClass:l||Me.ignoreClickOutsideClass})}else console.error('The dropdown element with id "'.concat(e,'" does not exist. Please check the data-dropdown-toggle attribute.'))})}typeof window<"u"&&(window.Dropdown=Qr,window.initDropdowns=Z);var qt=function(){return qt=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},qt.apply(this,arguments)},jt={placement:"center",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",backdrop:"dynamic",closable:!0,onHide:function(){},onShow:function(){},onToggle:function(){}},dn={id:null,override:!0},ir=function(){function s(e,t,i){e===void 0&&(e=null),t===void 0&&(t=jt),i===void 0&&(i=dn),this._eventListenerInstances=[],this._instanceId=i.id?i.id:e.id,this._targetEl=e,this._options=qt(qt({},jt),t),this._isHidden=!0,this._backdropEl=null,this._initialized=!1,this.init(),b.addInstance("Modal",this,this._instanceId,i.override)}return s.prototype.init=function(){var e=this;this._targetEl&&!this._initialized&&(this._getPlacementClasses().map(function(t){e._targetEl.classList.add(t)}),this._initialized=!0)},s.prototype.destroy=function(){this._initialized&&(this.removeAllEventListenerInstances(),this._destroyBackdropEl(),this._initialized=!1)},s.prototype.removeInstance=function(){b.removeInstance("Modal",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype._createBackdrop=function(){var e;if(this._isHidden){var t=document.createElement("div");t.setAttribute("modal-backdrop",""),(e=t.classList).add.apply(e,this._options.backdropClasses.split(" ")),document.querySelector("body").append(t),this._backdropEl=t}},s.prototype._destroyBackdropEl=function(){this._isHidden||document.querySelector("[modal-backdrop]").remove()},s.prototype._setupModalCloseEventListeners=function(){var e=this;this._options.backdrop==="dynamic"&&(this._clickOutsideEventListener=function(t){e._handleOutsideClick(t.target)},this._targetEl.addEventListener("click",this._clickOutsideEventListener,!0)),this._keydownEventListener=function(t){t.key==="Escape"&&e.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},s.prototype._removeModalCloseEventListeners=function(){this._options.backdrop==="dynamic"&&this._targetEl.removeEventListener("click",this._clickOutsideEventListener,!0),document.body.removeEventListener("keydown",this._keydownEventListener,!0)},s.prototype._handleOutsideClick=function(e){(e===this._targetEl||e===this._backdropEl&&this.isVisible())&&this.hide()},s.prototype._getPlacementClasses=function(){switch(this._options.placement){case"top-left":return["justify-start","items-start"];case"top-center":return["justify-center","items-start"];case"top-right":return["justify-end","items-start"];case"center-left":return["justify-start","items-center"];case"center":return["justify-center","items-center"];case"center-right":return["justify-end","items-center"];case"bottom-left":return["justify-start","items-end"];case"bottom-center":return["justify-center","items-end"];case"bottom-right":return["justify-end","items-end"];default:return["justify-center","items-center"]}},s.prototype.toggle=function(){this._isHidden?this.show():this.hide(),this._options.onToggle(this)},s.prototype.show=function(){this.isHidden&&(this._targetEl.classList.add("flex"),this._targetEl.classList.remove("hidden"),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._createBackdrop(),this._isHidden=!1,this._options.closable&&this._setupModalCloseEventListeners(),document.body.classList.add("overflow-hidden"),this._options.onShow(this))},s.prototype.hide=function(){this.isVisible&&(this._targetEl.classList.add("hidden"),this._targetEl.classList.remove("flex"),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._destroyBackdropEl(),this._isHidden=!0,document.body.classList.remove("overflow-hidden"),this._options.closable&&this._removeModalCloseEventListeners(),this._options.onHide(this))},s.prototype.isVisible=function(){return!this._isHidden},s.prototype.isHidden=function(){return this._isHidden},s.prototype.addEventListenerInstance=function(e,t,i){this._eventListenerInstances.push({element:e,type:t,handler:i})},s.prototype.removeAllEventListenerInstances=function(){this._eventListenerInstances.map(function(e){e.element.removeEventListener(e.type,e.handler)}),this._eventListenerInstances=[]},s.prototype.getAllEventListenerInstances=function(){return this._eventListenerInstances},s}();function Le(){document.querySelectorAll("[data-modal-target]").forEach(function(s){var e=s.getAttribute("data-modal-target"),t=document.getElementById(e);if(t){var i=t.getAttribute("data-modal-placement"),r=t.getAttribute("data-modal-backdrop");new ir(t,{placement:i||jt.placement,backdrop:r||jt.backdrop})}else console.error("Modal with id ".concat(e," does not exist. Are you sure that the data-modal-target attribute points to the correct modal id?."))}),document.querySelectorAll("[data-modal-toggle]").forEach(function(s){var e=s.getAttribute("data-modal-toggle"),t=document.getElementById(e);if(t){var i=b.getInstance("Modal",e);if(i){var r=function(){i.toggle()};s.addEventListener("click",r),i.addEventListenerInstance(s,"click",r)}else console.error("Modal with id ".concat(e," has not been initialized. Please initialize it using the data-modal-target attribute."))}else console.error("Modal with id ".concat(e," does not exist. Are you sure that the data-modal-toggle attribute points to the correct modal id?"))}),document.querySelectorAll("[data-modal-show]").forEach(function(s){var e=s.getAttribute("data-modal-show"),t=document.getElementById(e);if(t){var i=b.getInstance("Modal",e);if(i){var r=function(){i.show()};s.addEventListener("click",r),i.addEventListenerInstance(s,"click",r)}else console.error("Modal with id ".concat(e," has not been initialized. Please initialize it using the data-modal-target attribute."))}else console.error("Modal with id ".concat(e," does not exist. Are you sure that the data-modal-show attribute points to the correct modal id?"))}),document.querySelectorAll("[data-modal-hide]").forEach(function(s){var e=s.getAttribute("data-modal-hide"),t=document.getElementById(e);if(t){var i=b.getInstance("Modal",e);if(i){var r=function(){i.hide()};s.addEventListener("click",r),i.addEventListenerInstance(s,"click",r)}else console.error("Modal with id ".concat(e," has not been initialized. Please initialize it using the data-modal-target attribute."))}else console.error("Modal with id ".concat(e," does not exist. Are you sure that the data-modal-hide attribute points to the correct modal id?"))})}typeof window<"u"&&(window.Modal=ir,window.initModals=Le);var Et=ir;var Yt=function(){return Yt=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},Yt.apply(this,arguments)},Je={placement:"left",bodyScrolling:!1,backdrop:!0,edge:!1,edgeOffset:"bottom-[60px]",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-30",onShow:function(){},onHide:function(){},onToggle:function(){}},hn={id:null,override:!0},Zr=function(){function s(e,t,i){e===void 0&&(e=null),t===void 0&&(t=Je),i===void 0&&(i=hn),this._eventListenerInstances=[],this._instanceId=i.id?i.id:e.id,this._targetEl=e,this._options=Yt(Yt({},Je),t),this._visible=!1,this._initialized=!1,this.init(),b.addInstance("Drawer",this,this._instanceId,i.override)}return s.prototype.init=function(){var e=this;this._targetEl&&!this._initialized&&(this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.classList.add("transition-transform"),this._getPlacementClasses(this._options.placement).base.map(function(t){e._targetEl.classList.add(t)}),this._handleEscapeKey=function(t){t.key==="Escape"&&e.isVisible()&&e.hide()},document.addEventListener("keydown",this._handleEscapeKey),this._initialized=!0)},s.prototype.destroy=function(){this._initialized&&(this.removeAllEventListenerInstances(),this._destroyBackdropEl(),document.removeEventListener("keydown",this._handleEscapeKey),this._initialized=!1)},s.prototype.removeInstance=function(){b.removeInstance("Drawer",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype.hide=function(){var e=this;this._options.edge?(this._getPlacementClasses(this._options.placement+"-edge").active.map(function(t){e._targetEl.classList.remove(t)}),this._getPlacementClasses(this._options.placement+"-edge").inactive.map(function(t){e._targetEl.classList.add(t)})):(this._getPlacementClasses(this._options.placement).active.map(function(t){e._targetEl.classList.remove(t)}),this._getPlacementClasses(this._options.placement).inactive.map(function(t){e._targetEl.classList.add(t)})),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._options.bodyScrolling||document.body.classList.remove("overflow-hidden"),this._options.backdrop&&this._destroyBackdropEl(),this._visible=!1,this._options.onHide(this)},s.prototype.show=function(){var e=this;this._options.edge?(this._getPlacementClasses(this._options.placement+"-edge").active.map(function(t){e._targetEl.classList.add(t)}),this._getPlacementClasses(this._options.placement+"-edge").inactive.map(function(t){e._targetEl.classList.remove(t)})):(this._getPlacementClasses(this._options.placement).active.map(function(t){e._targetEl.classList.add(t)}),this._getPlacementClasses(this._options.placement).inactive.map(function(t){e._targetEl.classList.remove(t)})),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._options.bodyScrolling||document.body.classList.add("overflow-hidden"),this._options.backdrop&&this._createBackdrop(),this._visible=!0,this._options.onShow(this)},s.prototype.toggle=function(){this.isVisible()?this.hide():this.show()},s.prototype._createBackdrop=function(){var e,t=this;if(!this._visible){var i=document.createElement("div");i.setAttribute("drawer-backdrop",""),(e=i.classList).add.apply(e,this._options.backdropClasses.split(" ")),document.querySelector("body").append(i),i.addEventListener("click",function(){t.hide()})}},s.prototype._destroyBackdropEl=function(){this._visible&&document.querySelector("[drawer-backdrop]").remove()},s.prototype._getPlacementClasses=function(e){switch(e){case"top":return{base:["top-0","left-0","right-0"],active:["transform-none"],inactive:["-translate-y-full"]};case"right":return{base:["right-0","top-0"],active:["transform-none"],inactive:["translate-x-full"]};case"bottom":return{base:["bottom-0","left-0","right-0"],active:["transform-none"],inactive:["translate-y-full"]};case"left":return{base:["left-0","top-0"],active:["transform-none"],inactive:["-translate-x-full"]};case"bottom-edge":return{base:["left-0","top-0"],active:["transform-none"],inactive:["translate-y-full",this._options.edgeOffset]};default:return{base:["left-0","top-0"],active:["transform-none"],inactive:["-translate-x-full"]}}},s.prototype.isHidden=function(){return!this._visible},s.prototype.isVisible=function(){return this._visible},s.prototype.addEventListenerInstance=function(e,t,i){this._eventListenerInstances.push({element:e,type:t,handler:i})},s.prototype.removeAllEventListenerInstances=function(){this._eventListenerInstances.map(function(e){e.element.removeEventListener(e.type,e.handler)}),this._eventListenerInstances=[]},s.prototype.getAllEventListenerInstances=function(){return this._eventListenerInstances},s}();function $e(){document.querySelectorAll("[data-drawer-target]").forEach(function(s){var e=s.getAttribute("data-drawer-target"),t=document.getElementById(e);if(t){var i=s.getAttribute("data-drawer-placement"),r=s.getAttribute("data-drawer-body-scrolling"),n=s.getAttribute("data-drawer-backdrop"),o=s.getAttribute("data-drawer-edge"),a=s.getAttribute("data-drawer-edge-offset");new Zr(t,{placement:i||Je.placement,bodyScrolling:r?r==="true":Je.bodyScrolling,backdrop:n?n==="true":Je.backdrop,edge:o?o==="true":Je.edge,edgeOffset:a||Je.edgeOffset})}else console.error("Drawer with id ".concat(e," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))}),document.querySelectorAll("[data-drawer-toggle]").forEach(function(s){var e=s.getAttribute("data-drawer-toggle"),t=document.getElementById(e);if(t){var i=b.getInstance("Drawer",e);if(i){var r=function(){i.toggle()};s.addEventListener("click",r),i.addEventListenerInstance(s,"click",r)}else console.error("Drawer with id ".concat(e," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(e," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))}),document.querySelectorAll("[data-drawer-dismiss], [data-drawer-hide]").forEach(function(s){var e=s.getAttribute("data-drawer-dismiss")?s.getAttribute("data-drawer-dismiss"):s.getAttribute("data-drawer-hide"),t=document.getElementById(e);if(t){var i=b.getInstance("Drawer",e);if(i){var r=function(){i.hide()};s.addEventListener("click",r),i.addEventListenerInstance(s,"click",r)}else console.error("Drawer with id ".concat(e," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(e," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id"))}),document.querySelectorAll("[data-drawer-show]").forEach(function(s){var e=s.getAttribute("data-drawer-show"),t=document.getElementById(e);if(t){var i=b.getInstance("Drawer",e);if(i){var r=function(){i.show()};s.addEventListener("click",r),i.addEventListenerInstance(s,"click",r)}else console.error("Drawer with id ".concat(e," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(e," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))})}typeof window<"u"&&(window.Drawer=Zr,window.initDrawers=$e);var Kt=function(){return Kt=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},Kt.apply(this,arguments)},es={defaultTabId:null,activeClasses:"text-blue-600 hover:text-blue-600 dark:text-blue-500 dark:hover:text-blue-500 border-blue-600 dark:border-blue-500",inactiveClasses:"dark:border-transparent text-gray-500 hover:text-gray-600 dark:text-gray-400 border-gray-100 hover:border-gray-300 dark:border-gray-700 dark:hover:text-gray-300",onShow:function(){}},un={id:null,override:!0},ts=function(){function s(e,t,i,r){e===void 0&&(e=null),t===void 0&&(t=[]),i===void 0&&(i=es),r===void 0&&(r=un),this._instanceId=r.id?r.id:e.id,this._tabsEl=e,this._items=t,this._activeTab=i?this.getTab(i.defaultTabId):null,this._options=Kt(Kt({},es),i),this._initialized=!1,this.init(),b.addInstance("Tabs",this,this._tabsEl.id,!0),b.addInstance("Tabs",this,this._instanceId,r.override)}return s.prototype.init=function(){var e=this;this._items.length&&!this._initialized&&(this._activeTab||this.setActiveTab(this._items[0]),this.show(this._activeTab.id,!0),this._items.map(function(t){t.triggerEl.addEventListener("click",function(){e.show(t.id)})}))},s.prototype.destroy=function(){this._initialized&&(this._initialized=!1)},s.prototype.removeInstance=function(){this.destroy(),b.removeInstance("Tabs",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype.getActiveTab=function(){return this._activeTab},s.prototype.setActiveTab=function(e){this._activeTab=e},s.prototype.getTab=function(e){return this._items.filter(function(t){return t.id===e})[0]},s.prototype.show=function(e,t){var i,r,n=this;t===void 0&&(t=!1);var o=this.getTab(e);o===this._activeTab&&!t||(this._items.map(function(a){var l,c;a!==o&&((l=a.triggerEl.classList).remove.apply(l,n._options.activeClasses.split(" ")),(c=a.triggerEl.classList).add.apply(c,n._options.inactiveClasses.split(" ")),a.targetEl.classList.add("hidden"),a.triggerEl.setAttribute("aria-selected","false"))}),(i=o.triggerEl.classList).add.apply(i,this._options.activeClasses.split(" ")),(r=o.triggerEl.classList).remove.apply(r,this._options.inactiveClasses.split(" ")),o.triggerEl.setAttribute("aria-selected","true"),o.targetEl.classList.remove("hidden"),this.setActiveTab(o),this._options.onShow(this,o))},s}();function ct(){document.querySelectorAll("[data-tabs-toggle]").forEach(function(s){var e=[],t=null;s.querySelectorAll('[role="tab"]').forEach(function(i){var r=i.getAttribute("aria-selected")==="true",n={id:i.getAttribute("data-tabs-target"),triggerEl:i,targetEl:document.querySelector(i.getAttribute("data-tabs-target"))};e.push(n),r&&(t=n.id)}),new ts(s,e,{defaultTabId:t})})}typeof window<"u"&&(window.Tabs=ts,window.initTabs=ct);var He=function(){return He=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},He.apply(this,arguments)},Xt=function(s,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,n;i<r;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return s.concat(n||Array.prototype.slice.call(e))},Jt={placement:"top",triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},pn={id:null,override:!0},is=function(){function s(e,t,i,r){e===void 0&&(e=null),t===void 0&&(t=null),i===void 0&&(i=Jt),r===void 0&&(r=pn),this._instanceId=r.id?r.id:e.id,this._targetEl=e,this._triggerEl=t,this._options=He(He({},Jt),i),this._popperInstance=null,this._visible=!1,this._initialized=!1,this.init(),b.addInstance("Tooltip",this,this._instanceId,r.override)}return s.prototype.init=function(){this._triggerEl&&this._targetEl&&!this._initialized&&(this._setupEventListeners(),this._popperInstance=this._createPopperInstance(),this._initialized=!0)},s.prototype.destroy=function(){var e=this;if(this._initialized){var t=this._getTriggerEvents();t.showEvents.forEach(function(i){e._triggerEl.removeEventListener(i,e._showHandler)}),t.hideEvents.forEach(function(i){e._triggerEl.removeEventListener(i,e._hideHandler)}),this._removeKeydownListener(),this._removeClickOutsideListener(),this._popperInstance&&this._popperInstance.destroy(),this._initialized=!1}},s.prototype.removeInstance=function(){b.removeInstance("Tooltip",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype._setupEventListeners=function(){var e=this,t=this._getTriggerEvents();this._showHandler=function(){e.show()},this._hideHandler=function(){e.hide()},t.showEvents.forEach(function(i){e._triggerEl.addEventListener(i,e._showHandler)}),t.hideEvents.forEach(function(i){e._triggerEl.addEventListener(i,e._hideHandler)})},s.prototype._createPopperInstance=function(){return Xe(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,8]}}]})},s.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}},s.prototype._setupKeydownListener=function(){var e=this;this._keydownEventListener=function(t){t.key==="Escape"&&e.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},s.prototype._removeKeydownListener=function(){document.body.removeEventListener("keydown",this._keydownEventListener,!0)},s.prototype._setupClickOutsideListener=function(){var e=this;this._clickOutsideEventListener=function(t){e._handleClickOutside(t,e._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},s.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},s.prototype._handleClickOutside=function(e,t){var i=e.target;i!==t&&!t.contains(i)&&!this._triggerEl.contains(i)&&this.isVisible()&&this.hide()},s.prototype.isVisible=function(){return this._visible},s.prototype.toggle=function(){this.isVisible()?this.hide():this.show()},s.prototype.show=function(){this._targetEl.classList.remove("opacity-0","invisible"),this._targetEl.classList.add("opacity-100","visible"),this._popperInstance.setOptions(function(e){return He(He({},e),{modifiers:Xt(Xt([],e.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._setupKeydownListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},s.prototype.hide=function(){this._targetEl.classList.remove("opacity-100","visible"),this._targetEl.classList.add("opacity-0","invisible"),this._popperInstance.setOptions(function(e){return He(He({},e),{modifiers:Xt(Xt([],e.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._removeClickOutsideListener(),this._removeKeydownListener(),this._visible=!1,this._options.onHide(this)},s}();function dt(){document.querySelectorAll("[data-tooltip-target]").forEach(function(s){var e=s.getAttribute("data-tooltip-target"),t=document.getElementById(e);if(t){var i=s.getAttribute("data-tooltip-trigger"),r=s.getAttribute("data-tooltip-placement");new is(t,s,{placement:r||Jt.placement,triggerType:i||Jt.triggerType})}else console.error('The tooltip element with id "'.concat(e,'" does not exist. Please check the data-tooltip-target attribute.'))})}typeof window<"u"&&(window.Tooltip=is,window.initTooltips=dt);var De=function(){return De=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},De.apply(this,arguments)},Gt=function(s,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,n;i<r;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return s.concat(n||Array.prototype.slice.call(e))},At={placement:"top",offset:10,triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},gn={id:null,override:!0},rs=function(){function s(e,t,i,r){e===void 0&&(e=null),t===void 0&&(t=null),i===void 0&&(i=At),r===void 0&&(r=gn),this._instanceId=r.id?r.id:e.id,this._targetEl=e,this._triggerEl=t,this._options=De(De({},At),i),this._popperInstance=null,this._visible=!1,this._initialized=!1,this.init(),b.addInstance("Popover",this,r.id?r.id:this._targetEl.id,r.override)}return s.prototype.init=function(){this._triggerEl&&this._targetEl&&!this._initialized&&(this._setupEventListeners(),this._popperInstance=this._createPopperInstance(),this._initialized=!0)},s.prototype.destroy=function(){var e=this;if(this._initialized){var t=this._getTriggerEvents();t.showEvents.forEach(function(i){e._triggerEl.removeEventListener(i,e._showHandler),e._targetEl.removeEventListener(i,e._showHandler)}),t.hideEvents.forEach(function(i){e._triggerEl.removeEventListener(i,e._hideHandler),e._targetEl.removeEventListener(i,e._hideHandler)}),this._removeKeydownListener(),this._removeClickOutsideListener(),this._popperInstance&&this._popperInstance.destroy(),this._initialized=!1}},s.prototype.removeInstance=function(){b.removeInstance("Popover",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype._setupEventListeners=function(){var e=this,t=this._getTriggerEvents();this._showHandler=function(){e.show()},this._hideHandler=function(){setTimeout(function(){e._targetEl.matches(":hover")||e.hide()},100)},t.showEvents.forEach(function(i){e._triggerEl.addEventListener(i,e._showHandler),e._targetEl.addEventListener(i,e._showHandler)}),t.hideEvents.forEach(function(i){e._triggerEl.addEventListener(i,e._hideHandler),e._targetEl.addEventListener(i,e._hideHandler)})},s.prototype._createPopperInstance=function(){return Xe(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,this._options.offset]}}]})},s.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}},s.prototype._setupKeydownListener=function(){var e=this;this._keydownEventListener=function(t){t.key==="Escape"&&e.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},s.prototype._removeKeydownListener=function(){document.body.removeEventListener("keydown",this._keydownEventListener,!0)},s.prototype._setupClickOutsideListener=function(){var e=this;this._clickOutsideEventListener=function(t){e._handleClickOutside(t,e._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},s.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},s.prototype._handleClickOutside=function(e,t){var i=e.target;i!==t&&!t.contains(i)&&!this._triggerEl.contains(i)&&this.isVisible()&&this.hide()},s.prototype.isVisible=function(){return this._visible},s.prototype.toggle=function(){this.isVisible()?this.hide():this.show(),this._options.onToggle(this)},s.prototype.show=function(){this._targetEl.classList.remove("opacity-0","invisible"),this._targetEl.classList.add("opacity-100","visible"),this._popperInstance.setOptions(function(e){return De(De({},e),{modifiers:Gt(Gt([],e.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._setupKeydownListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},s.prototype.hide=function(){this._targetEl.classList.remove("opacity-100","visible"),this._targetEl.classList.add("opacity-0","invisible"),this._popperInstance.setOptions(function(e){return De(De({},e),{modifiers:Gt(Gt([],e.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._removeClickOutsideListener(),this._removeKeydownListener(),this._visible=!1,this._options.onHide(this)},s}();function ht(){document.querySelectorAll("[data-popover-target]").forEach(function(s){var e=s.getAttribute("data-popover-target"),t=document.getElementById(e);if(t){var i=s.getAttribute("data-popover-trigger"),r=s.getAttribute("data-popover-placement"),n=s.getAttribute("data-popover-offset");new rs(t,s,{placement:r||At.placement,offset:n?parseInt(n):At.offset,triggerType:i||At.triggerType})}else console.error('The popover element with id "'.concat(e,'" does not exist. Please check the data-popover-target attribute.'))})}typeof window<"u"&&(window.Popover=rs,window.initPopovers=ht);var Qt=function(){return Qt=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},Qt.apply(this,arguments)},rr={triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},mn={id:null,override:!0},ss=function(){function s(e,t,i,r,n){e===void 0&&(e=null),t===void 0&&(t=null),i===void 0&&(i=null),r===void 0&&(r=rr),n===void 0&&(n=mn),this._instanceId=n.id?n.id:i.id,this._parentEl=e,this._triggerEl=t,this._targetEl=i,this._options=Qt(Qt({},rr),r),this._visible=!1,this._initialized=!1,this.init(),b.addInstance("Dial",this,this._instanceId,n.override)}return s.prototype.init=function(){var e=this;if(this._triggerEl&&this._targetEl&&!this._initialized){var t=this._getTriggerEventTypes(this._options.triggerType);this._showEventHandler=function(){e.show()},t.showEvents.forEach(function(i){e._triggerEl.addEventListener(i,e._showEventHandler),e._targetEl.addEventListener(i,e._showEventHandler)}),this._hideEventHandler=function(){e._parentEl.matches(":hover")||e.hide()},t.hideEvents.forEach(function(i){e._parentEl.addEventListener(i,e._hideEventHandler)}),this._initialized=!0}},s.prototype.destroy=function(){var e=this;if(this._initialized){var t=this._getTriggerEventTypes(this._options.triggerType);t.showEvents.forEach(function(i){e._triggerEl.removeEventListener(i,e._showEventHandler),e._targetEl.removeEventListener(i,e._showEventHandler)}),t.hideEvents.forEach(function(i){e._parentEl.removeEventListener(i,e._hideEventHandler)}),this._initialized=!1}},s.prototype.removeInstance=function(){b.removeInstance("Dial",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype.hide=function(){this._targetEl.classList.add("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","false"),this._visible=!1,this._options.onHide(this)},s.prototype.show=function(){this._targetEl.classList.remove("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","true"),this._visible=!0,this._options.onShow(this)},s.prototype.toggle=function(){this._visible?this.hide():this.show()},s.prototype.isHidden=function(){return!this._visible},s.prototype.isVisible=function(){return this._visible},s.prototype._getTriggerEventTypes=function(e){switch(e){case"hover":return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]};default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]}}},s}();function ee(){document.querySelectorAll("[data-dial-init]").forEach(function(s){var e=s.querySelector("[data-dial-toggle]");if(e){var t=e.getAttribute("data-dial-toggle"),i=document.getElementById(t);if(i){var r=e.getAttribute("data-dial-trigger");new ss(s,e,i,{triggerType:r||rr.triggerType})}else console.error("Dial with id ".concat(t," does not exist. Are you sure that the data-dial-toggle attribute points to the correct modal id?"))}else console.error("Dial with id ".concat(s.id," does not have a trigger element. Are you sure that the data-dial-toggle attribute exists?"))})}typeof window<"u"&&(window.Dial=ss,window.initDials=ee);var Zt=function(){return Zt=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},Zt.apply(this,arguments)},ns={minValue:null,maxValue:null,onIncrement:function(){},onDecrement:function(){}},fn={id:null,override:!0},os=function(){function s(e,t,i,r,n){e===void 0&&(e=null),t===void 0&&(t=null),i===void 0&&(i=null),r===void 0&&(r=ns),n===void 0&&(n=fn),this._instanceId=n.id?n.id:e.id,this._targetEl=e,this._incrementEl=t,this._decrementEl=i,this._options=Zt(Zt({},ns),r),this._initialized=!1,this.init(),b.addInstance("InputCounter",this,this._instanceId,n.override)}return s.prototype.init=function(){var e=this;this._targetEl&&!this._initialized&&(this._inputHandler=function(t){{var i=t.target;/^\d*$/.test(i.value)||(i.value=i.value.replace(/[^\d]/g,"")),e._options.maxValue!==null&&parseInt(i.value)>e._options.maxValue&&(i.value=e._options.maxValue.toString()),e._options.minValue!==null&&parseInt(i.value)<e._options.minValue&&(i.value=e._options.minValue.toString())}},this._incrementClickHandler=function(){e.increment()},this._decrementClickHandler=function(){e.decrement()},this._targetEl.addEventListener("input",this._inputHandler),this._incrementEl&&this._incrementEl.addEventListener("click",this._incrementClickHandler),this._decrementEl&&this._decrementEl.addEventListener("click",this._decrementClickHandler),this._initialized=!0)},s.prototype.destroy=function(){this._targetEl&&this._initialized&&(this._targetEl.removeEventListener("input",this._inputHandler),this._incrementEl&&this._incrementEl.removeEventListener("click",this._incrementClickHandler),this._decrementEl&&this._decrementEl.removeEventListener("click",this._decrementClickHandler),this._initialized=!1)},s.prototype.removeInstance=function(){b.removeInstance("InputCounter",this._instanceId)},s.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},s.prototype.getCurrentValue=function(){return parseInt(this._targetEl.value)||0},s.prototype.increment=function(){this._options.maxValue!==null&&this.getCurrentValue()>=this._options.maxValue||(this._targetEl.value=(this.getCurrentValue()+1).toString(),this._options.onIncrement(this))},s.prototype.decrement=function(){this._options.minValue!==null&&this.getCurrentValue()<=this._options.minValue||(this._targetEl.value=(this.getCurrentValue()-1).toString(),this._options.onDecrement(this))},s}();function ut(){document.querySelectorAll("[data-input-counter]").forEach(function(s){var e=s.id,t=document.querySelector('[data-input-counter-increment="'+e+'"]'),i=document.querySelector('[data-input-counter-decrement="'+e+'"]'),r=s.getAttribute("data-input-counter-min"),n=s.getAttribute("data-input-counter-max");s?b.instanceExists("InputCounter",s.getAttribute("id"))||new os(s,t||null,i||null,{minValue:r?parseInt(r):null,maxValue:n?parseInt(n):null}):console.error('The target element with id "'.concat(e,'" does not exist. Please check the data-input-counter attribute.'))})}typeof window<"u"&&(window.InputCounter=os,window.initInputCounters=ut);function as(){et(),tt(),it(),rt(),Z(),Le(),$e(),ct(),dt(),ht(),ee(),ut()}typeof window<"u"&&(window.initFlowbite=as);var vn=new Tr("load",[et,tt,it,rt,Z,Le,$e,ct,dt,ht,ee,ut]);vn.init();var sr=class{appRoot;useHash;pathname;ctxHash;searchParams;originalHref;originalHash;cargo={};constructor(e,t,i,r){this.appRoot=e,this.useHash=t;let n;if(this.originalHref=i,this.originalHash=r,this.useHash){n=new URL(i.replace("#",""));let o=r.indexOf("?");o>-1?this.ctxHash=r.substring(0,o):this.ctxHash=r}else n=new URL(i),this.ctxHash=this.originalHash;this.pathname=n.pathname.substring(this.appRoot.length),this.pathname===""&&(this.pathname="/"),this.searchParams=n.searchParams}},D=class s{static currentUrlRoute;appRoot;useHash;cssSelector;handlers=new Array;prevRouteHandler;prevAnchorClickHref;activeRouteHandler;onroutechange;onrouteerror;constructor(e,t,i="a.spa-nav"){this.appRoot=e,this.useHash=t,this.cssSelector=i}addRouteHandler(e,t=-1){t===-1?this.handlers.push(e):this.handlers.splice(t,0,e)}async start(){document.addEventListener("click",e=>{let t=e.target;!t.matches(this.cssSelector)&&(!t.parentElement||(t=t.parentElement,!t.matches(this.cssSelector)))||(this.prevAnchorClickHref=t.href,window.history.pushState({},"",this.prevAnchorClickHref),this.activeRouteHandler.setScrollPosition(window.scrollX,window.scrollY),e.preventDefault(),this._onHashChange(2))}),window.addEventListener("popstate",e=>{this.activeRouteHandler&&this.activeRouteHandler.setScrollPosition(window.scrollX,window.scrollY)}),window.addEventListener("hashchange",async e=>{window.location.href!==this.prevAnchorClickHref&&await this._onHashChange(1),this.prevAnchorClickHref=null}),await this._onHashChange(0)}async _onHashChange(e){if(s.currentUrlRoute=new sr(this.appRoot,this.useHash,window.location.href,window.location.hash),await this._routeRequest(s.currentUrlRoute))this.onroutechange&&(await this.onroutechange(this.prevRouteHandler,this.activeRouteHandler,s.currentUrlRoute,e),this.prevRouteHandler=this.activeRouteHandler);else{let i=`No router|default router registered for: ${window.location.href}`;this.onrouteerror&&await this.onrouteerror(window.location.href,i)}}async _routeRequest(e){let t=!1;for(let i=0;i<this.handlers.length;i++)if(await this.handlers[i].canHandle(e)){this.activeRouteHandler=this.handlers[i];try{await this.handlers[i].handle(e),t=!0;break}catch(n){console.error(n)}}return t}static async loadTemplate(e){let t=await fetch(e),i;return t.ok&&(i=await t.text()),[i,t]}};var pt=class{elementEventMap=new Map;register(e,t,i){let r=this.elementEventMap.get(e);r||(r=new Map,this.elementEventMap.set(e,r));let n=r.get(t);n||(n=[],r.set(t,n)),n.push(i),e.addEventListener(t,i)}dispose(e){let t=this.elementEventMap.get(e);if(t){let i=Array.from(t.keys());for(let r=0;r<i.length;r++){let n=t.get(i[r]);if(n){for(let o=0;o<n.length;o++)e.removeEventListener(i[r],n[o]);n=[]}t.delete(i[r])}this.elementEventMap.delete(e)}}disposeAll(){this.elementEventMap.forEach((e,t,i)=>{e.forEach((r,n,o)=>{r.forEach((a,l)=>{t.removeEventListener(n,a)}),r.length=0}),e.clear()}),this.elementEventMap.clear()}};var N=class{static SELECTED_CSS="border-l-4 border-blue-600";eventRegistry=new pt;isViewLoaded=!1;$PageSection;pageSectionId;$menuItem;menuItemId;hashLocation;templateFile;scrollYPos;visitations=0;app;shell;constructor(e,t,i,r,n,o){this.app=e,this.shell=t,this.pageSectionId=i,this.$PageSection=document.getElementById(this.pageSectionId),this.menuItemId=r,this.menuItemId&&(this.$menuItem=document.getElementById(this.menuItemId)),this.hashLocation=n,this.templateFile=o,e.router.addRouteHandler(this),e.pagesControllers.push(this)}async asyncConstructor(){}async canHandle(e){return this.hashLocation===e.pathname}async handle(e){this.isViewLoaded||(await this.setup(),this.visitations=0)}setScrollPosition(e,t){this.scrollYPos=t}onTrackListIndexChange(e,t,i){}async setup(){let[e,t]=await D.loadTemplate(this.templateFile),i=document.createElement("div");i.innerHTML=e;let r=this.$PageSection.parentElement;this.$PageSection.remove(),r.appendChild(i.children[0]),this.$PageSection=document.getElementById(this.pageSectionId),this.isViewLoaded=!0}async tearDown(){this.isViewLoaded=!1,this.eventRegistry.disposeAll()}async onEnter(e){this.visitations++,this.$PageSection.classList.remove("hidden"),this.shell.view.selectMenuItem(this.$menuItem),await this._onShow(e)}async _onShow(e){this.moveToScrollPosition(e)}moveToScrollPosition(e){window.scroll({left:0,top:this.scrollYPos,behavior:"smooth"})}async onExit(){this.$PageSection.classList.add("hidden")}isVisible(){return!this.$PageSection.classList.contains("hidden")}getTrackSelections(){return[]}async onAfterOfflineProcessing(e){}setLocationHash(e,t){t&&this.$menuItem&&(this.$menuItem.hash=e),location.hash=e}};var nr=["cursorLinePosition","highlightLineRanges","markTextRanges","startAudio","stopAudio"];var J=class s{static THREAD_TYPES=["Window","DedicatedWorkerGlobalScope","ServiceWorkerGlobalScope","SharedWorkerGlobalScope"];static THREAD_TYPE=self.constructor.name;static THREAD_TYPE_IDX=s.THREAD_TYPES.indexOf(s.THREAD_TYPE);static THREAD_ID;static IS_MOBILE_PLATFORM;static _debounceTimer;static deepClone(e){if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.map(i=>s.deepClone(i));let t={};for(let i in e)e.hasOwnProperty(i)&&(t[i]=s.deepClone(e[i]));return t}static debounce(e,t){clearTimeout(s._debounceTimer),s._debounceTimer=setTimeout(e,t)}static _setIsMobilePlatform(){if(s.IS_MOBILE_PLATFORM!==void 0)return;let e=navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i),t="ontouchstart"in(s.THREAD_TYPE_IDX===0?window:self),i="accelerometer"in(s.THREAD_TYPE_IDX===0?window:self);s.IS_MOBILE_PLATFORM=!!(e||t||i),console.log(`Thread#[${s.THREAD_TYPE_IDX}].IS_MOBILE=${s.IS_MOBILE_PLATFORM}`)}static _setThreadId(){if(s.THREAD_TYPE_IDX===0)s.THREAD_ID=s.THREAD_TYPE;else if(s.THREAD_TYPE_IDX===2){let e="/indeterminant-scriptURL";"serviceWorker"in self&&"scriptURL"in self.serviceWorker&&(e=self.serviceWorker.scriptURL),s.THREAD_ID=`sw${e.substring(e.lastIndexOf("/"))}`}else if(s.THREAD_ID=self.name,!s.THREAD_ID)throw new Error("IllegalState: All web workers & shared workers must be named via the constructor!")}static{s._setThreadId(),s._setIsMobilePlatform()}};var ve=class{async read(e,t){let i=localStorage.getItem(e);return i===null&&(i=t),i}async write(e,t){localStorage.setItem(e,t)}async commit(){}async clear(e){localStorage.removeItem(e)}},ei=class{data;async write(e,t){this.data=t}async clear(e){this.data=""}},Ge=class s extends ei{async read(e,t){if(!s.isReadAvailable())throw new Error("IllegalState: Platform does not support reading from clipboard");return this.data=await s.readText(),this.data}async commit(){await s.writeText(this.data),await this.clear(null)}static isReadAvailable(){return"readText"in navigator.clipboard}static async readText(){return await navigator.clipboard.readText()}static async writeText(e){await navigator.clipboard.writeText(e)}},ti=class extends ei{$inputFile;baseFilename;fileExtension;mimeType;onContentLoaded;constructor(e,t="suttaplayer-file",i="application/json",r="json"){super(),this.$inputFile=document.getElementById(e),this.baseFilename=t,this.fileExtension=r,this.mimeType=i,this._registerListener()}async commit(){let e=new Blob([this.data],{type:this.mimeType}),t=URL.createObjectURL(e),i=document.createElement("a");i.href=t;let r=new Date().toLocaleString().replaceAll(" ","_");i.download=`${this.baseFilename}-${r}.${this.fileExtension}`,i.click(),await this.clear(null)}async read(e,t){if(this.data===void 0)throw new Error("IllegalState: No file has been uploaded");return this.data}_registerListener(){this.$inputFile.addEventListener("change",async e=>{let t=this.$inputFile.files[0];this.data=await t.text(),this.onContentLoaded&&this.onContentLoaded(this.data?this.data.length:0)})}},ae=class s{delegate;replaceAllIds;constructor(e,t=!1){this.delegate=e,this.replaceAllIds=t}async commit(){await this.delegate.commit()}async read(e,t){let i=t,r=await this.delegate.read(e,t);return r&&this.replaceAllIds&&(r=s.replaceIds(r)),r!==t&&(i=JSON.parse(r)),i}async write(e,t){if(t===void 0)return;let i=JSON.stringify(t);await this.delegate.write(e,i)}async clear(e){this.delegate.clear(e)}static replaceIds(e){let t=/"id":\s*"([\w\d]{8}-[\w\d]{4}-[\w\d]{4}-[\w\d]{4}-[\w\d]{12})"/gm,i,r=e;for(;(i=t.exec(e))!==null;)i.index===t.lastIndex&&t.lastIndex++,i.forEach((n,o,a)=>{if(o===1){let l=It.new();r=r.replaceAll(n,l)}});return r}},Qe=class extends ae{data;async read(e,t){let i=t;if(this.data)return this.data[e]?this.data[e]:t;this.data=await super.read("multi-part-container",t);let r=this.data[e];return r||(r=this._getMiscSingletonEntry()),r}_getMiscSingletonEntry(){let e=[];for(let t in this.data)e.push(t);return e.length===1?this.data[e[0]]:null}async write(e,t){t!==void 0&&(this.data||(this.data={}),this.data[e]=J.deepClone(t))}async commit(){await super.write("multi-part-container",this.data),super.commit()}},It=class{static new(){return crypto.randomUUID()}};var A=class s{static VER="x.y.z";static VER_TUPLE=[-1,-1,-1];version=s.VER;id=It.new();type=this.constructor.name;transients=["transients"];constructor(e){e&&(this.id=e)}key(){return this.type}async save(e){this.version=s.VER;let[t,i]=this._saveToSavePoint(),r=this.key();await e.write(r,this),this._restoreFromSavePoint(t,i)}async restore(e){let t=this.key(),i=await e.read(t,this);await this.migrateBeforeAssignment(e,i),Object.assign(this,i)}async migrateBeforeAssignment(e,t){}async remove(e){let t=this.key();await e.clear(t)}_saveToSavePoint(){let e=this,t=this.transients,i=[];for(let r=0;r<t.length;r++){let n=t[r];i.push(e[n]),delete e[n]}return[t,i]}_restoreFromSavePoint(e,t){let i=this;for(let r=0;r<e.length;r++){let n=e[r];i[n]=t[r]}}static toVersionTuple(e){let t=[-1,-1,-1];return e.split(".").forEach((i,r,n)=>{t[r]=parseInt(i)}),t}static toVersionInt(e){return parseInt(e.replaceAll(".",""))}};var Q=class{trackRef="";cursorLinePosition;highlightLineRanges;markTextRanges;startAudio;stopAudio;notes;assignFrom(e){return this.trackRef=e.trackRef,this.cursorLinePosition=e.cursorLinePosition,this.highlightLineRanges=e.highlightLineRanges,this.markTextRanges=e.markTextRanges,this.startAudio=e.startAudio,this.stopAudio=e.stopAudio,this.notes=e.notes,this}assignTo(e){return e||(e={}),e.trackRef=this.trackRef,e.cursorLinePosition=this.cursorLinePosition,e.highlightLineRanges=this.highlightLineRanges,e.markTextRanges=this.markTextRanges,e.startAudio=this.startAudio,e.stopAudio=this.stopAudio,e.notes=this.notes,e}toString(e){let t="",i=[...nr],r=[this.cursorLinePosition,this.highlightLineRanges,this.markTextRanges,this.startAudio,this.stopAudio];e===!1&&this.trackRef&&(i.splice(0,0,"trackRef"),r.splice(0,0,this.trackRef));for(let n=0;n<r.length;n++)t=this._formatAsHtml(i[n],r[n],t);return t}_formatAsHtml(e,t,i){return t!==void 0&&(t=t.length>10?t.substring(0,7)+"...":t,i+=`${i?",&nbsp;":""}<i>${e}</i>: ${t}`),i}static toHref(e){let t=new URLSearchParams;nr.forEach((n,o,a)=>{e[n]!==void 0&&t.set(n,e[n])});let i=`#${e.trackRef}`,r=t.toString().replaceAll("%2C",",");return r&&(i+=`?${r}`),i}},G=class s extends A{static KEY_PREFIX="pl.";static DEFAULT_NEW_NAME="New playlist";type="PlaylistModel";_selectedItemIndex=-2;stereoType="P";name=s.DEFAULT_NEW_NAME;selectedPlaylistItem;items=[];transients=["transients","selectedPlaylistItem"];constructor(e,t,i){super(e),t&&(this.stereoType=t),i&&(this.name=i)}isNew(){return this._selectedItemIndex===-2}key(){return s.KEY_PREFIX+this.id}async save(e){this._selectedItemIndex===-2&&this.items.length===0?this._selectedItemIndex=-1:this._selectedItemIndex=this.items.indexOf(this.selectedPlaylistItem),this.name||(this.name=this.id),await super.save(e)}async restore(e){await super.restore(e);for(let t=0;t<this.items.length;t++){let i=new Q;i.assignFrom(this.items[t]),this.items[t]=i}this._selectedItemIndex>=0&&(this.selectedPlaylistItem=this.items[this._selectedItemIndex])}setSelectionItem(e){this._selectedItemIndex=e,this.selectedPlaylistItem=this._selectedItemIndex<=-1?null:this.items[this._selectedItemIndex]}getSelectionItem(){return this._selectedItemIndex}reset(){this._selectedItemIndex=-2}load(e,t){this.reset(),this.items=e,t>=0&&this.setSelectionItem(t)}},gt=class extends A{type="PlayListsModel";_selectedListIndex=-1;listIds=[];idNamesMap={};tracks=[];newPlaylist=new G;selectedPlaylist=this.newPlaylist;transients=["transients","selectedPlaylist","tracks","newPlaylist"];async save(e){let t=this._selectedListIndex>-1?this.listIds[this._selectedListIndex]:void 0;this._sort(),this.selectedPlaylist?.isNew()||(this.idNamesMap[this.selectedPlaylist.id]=this.selectedPlaylist.name),t!==void 0&&(this._selectedListIndex=this.listIds.indexOf(t)),await super.save(e)}async migrateBeforeAssignment(e,t){let i=A.toVersionInt(t.version),r=A.toVersionInt(A.VER);if(i<r&&t._listIds){t.listIds=t._listIds,delete t._listIds,delete t.useTransfer;for(let n=0;n<t.listIds.length;n++){let o=t.listIds[n],a=new G(o);await a.restore(e),t.idNamesMap||(t.idNamesMap={}),t.idNamesMap[o]=a.name}}}async loadList(e,t){if(t===this.newPlaylist.id)return this.newPlaylist;let i=await this._fromIdToObject(e,t);return this.idNamesMap[i.id]=i.name,i}getSelectedId(){return this._selectedListIndex>-1?this.listIds[this._selectedListIndex]:this.newPlaylist.id}setSelectedIndex(e){let t;return this._selectedListIndex=e,this._selectedListIndex===-1?(this.selectedPlaylist=this.newPlaylist,t=this.selectedPlaylist.id):t=this.listIds[e],t}getSelectedIndex(){return this._selectedListIndex}addNewPlaylist(){this.addPlaylist(this.newPlaylist),this.newPlaylist=new G}addPlaylist(e){this.listIds.push(e.id),this.idNamesMap[e.id]=e.name}async removePlaylist(e,t){if(t===-1)return;t===this._selectedListIndex&&this.setSelectedIndex(-1);let r=new G(this.listIds[t]);return await r.remove(e),this.listIds.splice(t,1),delete this.idNamesMap[r.id],await this.save(e),t>-1}_sort(){this.listIds.sort((e,t)=>{let i=this.idNamesMap[e],r=this.idNamesMap[t];return i.localeCompare(r)})}async _fromIdToObject(e,t){let i=new G(t);return await i.restore(e),i}};var Rt=class{static defer(){let e,t,i=new Promise((n,o)=>{e=n,t=o}),r=i;return r.resolve=e,r.reject=t,i}};var ii=class s{static _resolvedPromise=Promise.resolve(void 0);static _promiseHashMap=new Map;api=NaN;_rpcIdxFuncMap=new Map;_rpcFuncIdxMap=new Map;_orderedTransferredPortMaps=[];_namedTransferredPortMaps=new Map;bindRpcFunc(e,t,i){let r=this._rpcIdxFuncMap.size;this._rpcIdxFuncMap.set(r,{thisArg:e,run:t,...i}),this._rpcFuncIdxMap.set(t,r)}_prepareMessage(e,t){let i={headers:{request:{id:J.THREAD_ID,context:this.__getName__(),portId:"<required>"}},api:this.api,rpc:this._rpcFuncIdxMap.get(e)};if(Number.isNaN(i.api)||i.rpc===void 0)throw new Error(`IllegalArgument: [${JSON.stringify(i)}]; indeterminate API/RPC target!`);let r=this._rpcIdxFuncMap.get(i.rpc);if(!r.hasNoArgs){if(t===void 0)throw new Error(`IllegalArgument: [${JSON.stringify(i)}] requires argument to be set before post!`);i.args=t}return r.hasReturn&&(i.returnPromise=!0),i}_bindMethods(e=!0){this._rpcIdxFuncMap.clear(),this._rpcFuncIdxMap.clear(),e&&this._bindSystemFuncs()}_bindSystemFuncs(){this.bindRpcFunc(this,this.__teardown__,{hasNoArgs:!0}),this.bindRpcFunc(this,this.__transferPorts__,{hasServerTransferredPorts:!0}),this.bindRpcFunc(this,this.__getTransferredPorts__,{hasReturn:!0}),this.bindRpcFunc(this,this.__deleteTransferredPorts__)}async _handleRpc(e){if(e.data?.api!==this.api||e.data?.rpc===void 0||this._returnRpcResultIfResolved(e))return;this._registerTransferredPorts(e);let t=this._rpcIdxFuncMap.get(e.data.rpc);if(e.rpcInvoked=t,t)await this._invokeRpcMethod(e);else throw new Error(`IllegalArgument: rpc[${e.data.rpc}] not supported on Context[${this.__getName__()}]`)}_returnRpcResultIfResolved(e){let t=!1,i=e.data.promiseHash;if(i){let r=s._promiseHashMap.get(i);if(r)e.data.promiseHash=void 0,s._promiseHashMap.delete(i),r.resolve(e.data),t=!0;else if(e.data.resp)throw new Error(`IllegalState: ${J.THREAD_ID} received misdirected promiseHash[${i}]`)}return t}_registerTransferredPorts(e){for(let t=0;t<e.ports.length;t++)this._orderedTransferredPortMaps.push(e.ports[t]),e.ports[t].onmessage=async i=>{await this._onMessageChannelMessage(i)},e.ports[t].rpcPortId="altWorkerMC"}_unregisterTransferredPort(e){let t=this._orderedTransferredPortMaps.indexOf(e);t>-1&&(e.close(),e.onmessage=null,this._orderedTransferredPortMaps.splice(t,1))}async _invokeRpcMethod(e){let t=e.rpcInvoked,i=e.target||self,r=t.hasClientPromiseAwait?Rt.defer():void 0,n=[];t.hasNoArgs||n.push(e.data.args),t.hasClientPromiseAwait&&n.push(r),t.hasServerTransferredPorts&&n.push(e.ports),t.hasMessageEvent&&n.push(e),n.push(i);let o;if(t.thisArg?(t.runBound===void 0&&(t.runBound=t.run.bind(t.thisArg)),o=await t.runBound(...n)):o=await t.run(...n),r&&(o=await r),t.hasReturn){let a={...e.data,resp:o};a.headers.response={id:J.THREAD_ID,context:this.__getName__(),portId:i.rpcPortId},i.postMessage(a)}}_postMessage(e,t,i){let r=this._preparePostMessageReturnPromise(t);return i=this._preparePostMessageOptions(i),t.headers.request.portId=e.rpcPortId,e.postMessage(t,i),this._alertMessageDispatched(),r}_preparePostMessageReturnPromise(e){let t=s._resolvedPromise;return e.returnPromise&&(e.promiseHash=crypto.randomUUID(),e.returnPromise=void 0,t=Rt.defer(),s._promiseHashMap.set(e.promiseHash,t)),t}_preparePostMessageOptions(e){return e}_alertMessageDispatched(){}},or=class{isActive=!1;port;constructor(e){this.port=e}setup(){}teardown(){this.port.close()}setRpcPortId(e){this.port.rpcPortId||(this.port.rpcPortId=e)}preparePostMessageOptions(e){return e}getRecipient(){return this.port}alertMessageDispatched(){}setEventListener(e,t,i){this.port.onmessage=t}},we=class{_worker;_messageChannel;_mcResponder;constructor(e,t){this._worker=e,e instanceof ServiceWorker&&(t=!0),t&&(this._messageChannel=new MessageChannel)}setup(){this._messageChannel&&(this._mcResponder=new or(this._messageChannel.port1),this._mcResponder.setup())}teardown(){this._mcResponder&&this._mcResponder.teardown(),this._worker instanceof Worker&&(this._worker.onmessage=null)}setRpcPortId(e){this._mcResponder&&this._mcResponder.setRpcPortId(e.replace("DEFAULT","altWorkerMC")),"port"in this._worker&&(this._worker.port.rpcPortId=e),this._worker.rpcPortId=e}preparePostMessageOptions(e){return this._mcResponder&&!this._mcResponder.isActive&&(e?e=[this._messageChannel.port2,...e]:e=[this._messageChannel.port2],this._messageChannel=null),e}getRecipient(){return this._mcResponder&&this._mcResponder.isActive?this._mcResponder.getRecipient():"port"in this._worker?this._worker.port:this._worker}alertMessageDispatched(){this._mcResponder&&!this._mcResponder.isActive&&(this._mcResponder.isActive=!0)}setEventListener(e,t,i){this._worker.onmessage=t,this._mcResponder&&this._mcResponder.setEventListener(e,t,i)}};var le=class extends ii{_responder;constructor(e){super(),this._responder=e,this._responder.setRpcPortId("DEFAULT")}async __teardown__(){let e=this._prepareMessage(this.__teardown__);await this._postMessage(this._getRecipient(),e)}async __transferPorts__(e,t){let i=this._prepareMessage(this.__transferPorts__,e);e.portIds.forEach((r,n,o)=>{this._namedTransferredPortMaps.set(r,t[n])}),await this._postMessage(this._getRecipient(),i,t)}async __getTransferredPorts__(){let e=this._prepareMessage(this.__getTransferredPorts__);return{portIds:(await this._postMessage(this._getRecipient(),e)).resp.portIds}}async __deleteTransferredPorts__(e){let t=this._prepareMessage(this.__deleteTransferredPorts__,e);await this._postMessage(this._getRecipient(),t),e.portIds.forEach((i,r,n)=>{this._namedTransferredPortMaps.delete(i)})}startClient(){this._responder.setup(),this._responder.setEventListener("message",async e=>{await this._handleRpc(e)}),this._bindMethods(),console.log(`${J.THREAD_ID}>${this.__getName__()} started: waiting for messages...`)}async stopClient(){let e=Array.from(this._namedTransferredPortMaps.keys());await this.__deleteTransferredPorts__({portIds:e}),await this.__teardown__(),this._responder.teardown(),this._responder.setEventListener("message",null),this._bindMethods(!1)}_preparePostMessageOptions(e){return this._responder.preparePostMessageOptions(e)}_getRecipient(){return this._responder.getRecipient()}_alertMessageDispatched(){this._responder.alertMessageDispatched()}async _onMessageChannelMessage(e){await this._handleRpc(e)}};var ri=class{static bindRpc(e){let t=e;t.api||(t.api=1),t.bindRpcFunc(t,e.setup),t.bindRpcFunc(t,e.teardown,{hasNoArgs:!0}),t.bindRpcFunc(t,e.downloadSelections),t.bindRpcFunc(t,e.deleteSelections),t.bindRpcFunc(t,e.onProgressUpdate),t.bindRpcFunc(t,e.onFinished)}},si=class{static bindRpc(e){let t=e;t.api||(t.api=2),t.bindRpcFunc(t,e.downloadTrack,{hasReturn:!0}),t.bindRpcFunc(t,e.deleteTrack,{hasReturn:!0}),t.bindRpcFunc(t,e.onProcessed)}};var ni=class extends le{__getName__(){return"OfflineAudioManagerWorkerClient"}onProgressUpdate_;onProgressUpdate=async e=>{await this.onProgressUpdate_(e)};onFinished_;onFinished=async e=>{await this.onFinished_(e)};async setup(e){let t=this._prepareMessage(this.setup,e);await this._postMessage(this._getRecipient(),t)}async teardown(){let e=this._prepareMessage(this.teardown);await this._postMessage(this._getRecipient(),e)}async downloadSelections(e){let t=this._prepareMessage(this.downloadSelections,e);await this._postMessage(this._getRecipient(),t)}async deleteSelections(e){let t=this._prepareMessage(this.deleteSelections,e);await this._postMessage(this._getRecipient(),t)}_bindMethods(){super._bindMethods(),ri.bindRpc(this)}};var oi=class extends le{__getName__(){return"OfflineAudioWorkerClient"}onProcessed_;onProcessed=async e=>{await this.onProcessed_(e)};async downloadTrack(e){let t=this._prepareMessage(this.downloadTrack,e);return(await this._postMessage(this._getRecipient(),t)).resp}async deleteTrack(e){let t=this._prepareMessage(this.deleteTrack,e);return(await this._postMessage(this._getRecipient(),t)).resp}_bindMethods(){super._bindMethods(),si.bindRpc(this)}};var ai=class{app;model;view;bookmarks=[];eventRegistry=new pt;coordinator;offlineTrackRefJson={};clipboardStore=new Ge;fileStore;constructor(e){this.app=e,this.model=e.model.shell,this.view=new ar(this),this.fileStore=new ti("fileTransferManageActionShellPgInput")}launch(){this.view.bind(),this._registerModelListeners(),this._registerAudioControlListeners(),this._registerMediaButtonListeners(),this._registerSettingsMenuListeners(),this._registerOfflineCacheListeners(),this.view.initialiseView()}terminate(){}setBookmark(e){this.addBookmarks([e])}addBookmarks(e){this.clearBookmarks(),this.bookmarks.splice(0,0,...e),this.showMessage(`${e.length} bookmark(s) copied!`)}clearBookmarks(){this.bookmarks.length=0}showMessage(e,t=3e3){this.view.showMessage(e,t)}hideMessage(){this.view.hideMessage()}showPrompt(e,t){this.view.showPrompt(e,t)}async _processOfflineSelections(e){let t=this.app.router.activeRouteHandler.getTrackSelections();if(t.length===0){this.showMessage("No offline processing selections made!");return}await this._setupCoordinator(t,e),await this.coordinator.process()}async _setupCoordinator(e,t){this.coordinator=new lr(this,e,t),await this.coordinator.setup()}async _teardownCoordinator(){if(this.view.refreshOfflineElements(!1),Object.keys(this.offlineTrackRefJson).length>0){await this.app.albumStoreWorkerClient.updateTrackCacheInfo({trackRefsIsInCache:this.offlineTrackRefJson});for(let e=0;e<this.app.pagesControllers.length;e++)await this.app.pagesControllers[e].onAfterOfflineProcessing(this.offlineTrackRefJson)}this.offlineTrackRefJson={},this.coordinator&&(await this.coordinator.teardown(),this.coordinator=null)}_registerModelListeners(){this.model.onAudioPlayEnd=async()=>{let e=!1;if(this.app.model.audioSettings.playNext)e=this.model.playNext();else if(this.app.model.audioSettings.repeat){let[t]=this.model.adjustTimeWithinStartStopRangesIfReqd(0,this.app.model.audioSettings.applyStopStartRange);this.model.onAudioResetTimeTo(t)}else this.model.onAudioResetTimeTo(this.model.currentTime);return e},this.model.onAudioResetTimeTo=e=>{e&&(this.view.$controlShellPgAudio.currentTime=e)},this.model.onAudioStateChange=(e,t)=>{(t===1||t===4||t===5)&&this.view.refreshPlayPause(),e<3&&t<3||this.view.refreshAudioPlaybackControls(),t===3&&this.view.refreshPlaylistControls()},this.model.onAudioTimeChange=e=>{this.view.$currentTimeShellPgInput.value=`${e}`},this.model.onAudioTrackConfigChange=()=>{this.view.refreshStartStopRange()},this.model.onAudioTrackSrcChange=async(e,t)=>{await this.model.setAudioState(0),this.view.$controlShellPgAudio.src=e,this.view.$trackRefShellPgSpan.textContent=this.model.playlist.selectedPlaylistItem.trackRef,await this.model.setAudioState(1),this.view.$controlShellPgAudio.currentTime=this.model.startTime,this.view.$currentTimeShellPgInput.value=String(this.model.startTime),this.view.refreshStartStopRange()},this.model.onMountChange=e=>{this.view.refreshMountedPlaylist()},this.model.onPlayToggle=async e=>{e?this.view.$controlShellPgAudio.pause():await this.view.$controlShellPgAudio.play()},this.model.onSkipWithinTrack=e=>{let t=this.view.$controlShellPgAudio.currentTime;this.view.$controlShellPgAudio.currentTime=t+e},this.model.onSyncTextWithAudioIfReqd=(e,t)=>{if(this.app.model.textSettings.autoScrollWithAudio&&this.app.trackPage.isVisible()){let[i,r]=this.app.model.track.estimateTextSyncPosition(t);this.app.trackPage.scrollToLineWithPerc(i+r)}},this.model.onTrackIndexChange=(e,t,i)=>{this.view.refreshPlaylistControls(),this.model.playlistController.onTrackListIndexChange(e,t,i);let r=Q.toHref(this.model.playlist.selectedPlaylistItem);this.app.trackPage.$menuItem.href=r,this.app.trackPage.isVisible()&&(location.hash=r)}}_registerAudioControlListeners(){this.view.$controlShellPgAudio.onloadedmetadata=async()=>{await this.model.setAudioState(2)},this.view.$controlShellPgAudio.onloadeddata=async()=>{await this.model.setAudioState(3)},this.view.$controlShellPgAudio.onplay=async()=>{await this.model.setAudioState(4)},this.view.$controlShellPgAudio.onpause=async()=>{await this.model.setAudioState(5)},this.view.$controlShellPgAudio.onended=async()=>{await this.model.setAudioState(6)},this.view.$controlShellPgAudio.ontimeupdate=async()=>{this.model.preventOnTimeUpdate||await this.model.receiveTimeUpdate(this.view.$controlShellPgAudio.currentTime,this.app.model.audioSettings.applyStopStartRange),this.model.preventOnTimeUpdate=!1}}_registerMediaButtonListeners(){this.eventRegistry.register(this.view.$prevTrackShellPgBtn,"click",e=>{this.model.playPrevious()}),this.eventRegistry.register(this.view.$skipBackShellPgBtn,"click",e=>{let t=parseFloat(this.view.$skipSizeShellPgInput.value);isNaN(t)||this.model.skipWithinTrack(-t)}),this.eventRegistry.register(this.view.$playPauseToggleShellPgBtn,"click",async e=>{await this.model.playToggle(this.model.audioState===4)}),this.eventRegistry.register(this.view.$skipForwardShellPgBtn,"click",e=>{let t=parseFloat(this.view.$skipSizeShellPgInput.value);isNaN(t)||this.model.skipWithinTrack(t)}),this.eventRegistry.register(this.view.$nextTrackShellPgBtn,"click",e=>{this.model.playNext()}),this.eventRegistry.register(this.view.$currentTimeShellPgInput,"change",e=>{let t=parseFloat(this.view.$currentTimeShellPgInput.value);isNaN(t)||(this.view.$controlShellPgAudio.currentTime=t)})}_registerSettingsMenuListeners(){this.eventRegistry.register(this.view.$playbackRateShellPgInput,"change",e=>{this.app.model.audioSettings.playbackRate=parseFloat(this.view.$playbackRateShellPgInput.value),this.view.refreshPlaybackRate()}),this.eventRegistry.register(this.view.$startAudioShellPgBtn,"click",e=>{this.app.trackPage.isVisible()?this.app.trackPage.toggleAudioStart(!1):this.showMessage("Switch to sutta text page 1st to change start from time")}),this.eventRegistry.register(this.view.$stopAudioShellPgBtn,"click",e=>{this.app.trackPage.isVisible()?this.app.trackPage.toggleAudioStop(!1):this.showMessage("Switch to sutta text page 1st to change stop at time")}),this.eventRegistry.register(this.view.$autoPlayShellPgInput,"change",e=>{this.app.model.audioSettings.autoPlay=this.view.$autoPlayShellPgInput.checked,this.view.$controlShellPgAudio.autoplay=this.app.model.audioSettings.autoPlay}),this.eventRegistry.register(this.view.$playNextShellPgInput,"change",e=>{this.app.model.audioSettings.playNext=this.view.$playNextShellPgInput.checked,this.app.model.audioSettings.playNext&&(this.view.$repeatShellPgInput.checked=!1,this.app.model.audioSettings.repeat=!1)}),this.eventRegistry.register(this.view.$repeatShellPgInput,"change",e=>{this.app.model.audioSettings.repeat=this.view.$repeatShellPgInput.checked,this.view.$controlShellPgAudio.loop=this.app.model.audioSettings.repeat,this.app.model.audioSettings.repeat&&(this.view.$playNextShellPgInput.checked=!1,this.app.model.audioSettings.playNext=!1)}),this.eventRegistry.register(this.view.$skipSizeShellPgInput,"change",e=>{let t=parseFloat(this.view.$skipSizeShellPgInput.value);isNaN(t)&&(t=.25),this.app.model.audioSettings.skipSize=t,this.view.$currentTimeShellPgInput.step=String(t)}),this.eventRegistry.register(this.view.$applyStopStartShellPgInput,"change",e=>{this.app.model.audioSettings.applyStopStartRange=this.view.$applyStopStartShellPgInput.checked,this.view.refreshStartStopRange()}),this.eventRegistry.register(this.view.$scrollToTopShellPgA,"click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})}),this.eventRegistry.register(this.view.$findInPageShellPgForm,"submit",e=>{e.preventDefault(),this.app.model.textSettings.findInPageCriteria=this.view.$findInPageShellPgInput.value,"find"in window?window.find(this.app.model.textSettings.findInPageCriteria):this.showMessage("Platform does not support find text in page")}),this.eventRegistry.register(this.view.$copyUrlShellPgA,"click",async e=>{e.preventDefault(),await navigator.clipboard.writeText(location.href),this.showMessage("URL copied to clipboard")}),this.eventRegistry.register(this.view.$gotoPasteUrlShellPgA,"click",async e=>{if(e.preventDefault(),Ge.isReadAvailable()){let t=await navigator.clipboard.readText();location.href=t}else this.showMessage("Platform does not support reading from clipboard")}),this.eventRegistry.register(this.view.$useTransferManageActionShellPgSelect,"change",async e=>{this.app.model.generalSettings.useTransfer=parseInt(this.view.$useTransferManageActionShellPgSelect.value),this.view.refreshUploadFileFromModel()}),this.eventRegistry.register(this.view.$darkThemeShellPgBtn,"click",e=>{this.app.model.generalSettings.darkTheme=!this.app.model.generalSettings.darkTheme,this.view.refreshDarkTheme()}),this.eventRegistry.register(this.view.$resetAppShellPgBtn,"click",e=>{this.showPrompt(`Are you sure you want to reset app v${li.VERSION} and lose downloaded audio?`,async t=>{await this.app.reset()})}),this.fileStore.onContentLoaded=e=>{this.showMessage(`Content of length [${e}] loaded`)}}_registerOfflineCacheListeners(){this.eventRegistry.register(this.view.$downloadSelsShellPgA,"click",async e=>{e.preventDefault(),await this._processOfflineSelections(!0)}),this.eventRegistry.register(this.view.$deleteSelsShellPgA,"click",async e=>{e.preventDefault(),await this._processOfflineSelections(!1)}),this.eventRegistry.register(this.view.$abortOfflineShellPgBtn,"click",async e=>{this.view.$abortOfflineShellPgBtn.textContent="Aborted",await this._teardownCoordinator()})}},ar=class{toast;prompt;lastSbTimeoutHdl;$trackRefShellPgSpan=document.getElementById("trackRefShellPgSpan");$controlShellPgAudio=document.getElementById("controlShellPgAudio");$prevTrackShellPgBtn=document.getElementById("prevTrackShellPgBtn");$playPauseToggleShellPgBtn=document.getElementById("playPauseToggleShellPgBtn");$nextTrackShellPgBtn=document.getElementById("nextTrackShellPgBtn");$steroTypeShellPgDiv=document.getElementById("steroTypeShellPgDiv");$playToggleShellSvg=document.getElementById("playToggleShellSvg");$pauseToggleShellSvg=document.getElementById("pauseToggleShellSvg");$playbackRateShellPgLabel=document.getElementById("playbackRateShellPgLabel");$playbackRateShellPgInput=document.getElementById("playbackRateShellPgInput");$skipBackShellPgBtn=document.getElementById("skipBackShellPgBtn");$currentTimeShellPgInput=document.getElementById("currentTimeShellPgInput");$skipForwardShellPgBtn=document.getElementById("skipForwardShellPgBtn");$skipSizeShellPgInput=document.getElementById("skipSizeShellPgInput");$applyStopStartShellPgInput=document.getElementById("applyStopStartShellPgInput");$startAudioShellPgBtn=document.getElementById("startAudioShellPgBtn");$stopAudioShellPgBtn=document.getElementById("stopAudioShellPgBtn");$autoPlayShellPgInput=document.getElementById("autoPlayShellPgInput");$playNextShellPgInput=document.getElementById("playNextShellPgInput");$repeatShellPgInput=document.getElementById("repeatShellPgInput");$scrollToTopShellPgA=document.getElementById("scrollToTopShellPgA");$findInPageShellPgForm=document.getElementById("findInPageShellPgForm");$findInPageShellPgInput=document.getElementById("findInPageShellPgInput");$copyUrlShellPgA=document.getElementById("copyUrlShellPgA");$gotoPasteUrlShellPgA=document.getElementById("gotoPasteUrlShellPgA");$useTransferManageActionShellPgSelect=document.getElementById("useTransferManageActionShellPgSelect");$fileTransferManageActionShellPgInput=document.getElementById("fileTransferManageActionShellPgInput");$darkThemeShellPgBtn=document.getElementById("darkThemeShellPgBtn");$resetAppShellPgBtn=document.getElementById("resetAppShellPgBtn");$toastShellPgDiv=document.getElementById("toastShellPgDiv");$toastMsgShellPgDiv=document.getElementById("toastMsgShellPgDiv");$toastCloseShellPgBtn=document.getElementById("toastCloseShellPgBtn");$promptShellPgDiv=document.getElementById("promptShellPgDiv");$promptShellPgH3=document.getElementById("promptShellPgH3");$closePromptShellPgBtn=document.getElementById("closePromptShellPgBtn");$okayPromptShellPgBtn=document.getElementById("okayPromptShellPgBtn");$cancelPromptShellPgBtn=document.getElementById("cancelPromptShellPgBtn");$abortOfflineShellPgBtn=document.getElementById("abortOfflineShellPgBtn");$progrOfflineShellPgDiv=document.getElementById("progrOfflineShellPgDiv");$downloadSelsShellPgA=document.getElementById("downloadSelsShellPgA");$deleteSelsShellPgA=document.getElementById("deleteSelsShellPgA");$offlineInfoShellPgDiv=document.getElementById("offlineInfoShellPgDiv");$prevMenuShellPgA;promptHandler;shell;constructor(e){this.shell=e}bind(){$e();let e={transition:"transition-opacity",duration:1e3,timing:"ease-out",onHide:(i,r)=>{}};this.toast=new Ui(this.$toastShellPgDiv,this.$toastCloseShellPgBtn,e),Le();let t={placement:"center",backdrop:"dynamic",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!0,onHide:()=>{this.promptHandler=null},onShow:()=>{},onToggle:()=>{}};this.prompt=new Et(this.$promptShellPgDiv,t),this.shell.eventRegistry.register(this.$closePromptShellPgBtn,"click",i=>{this.prompt.toggle()}),this.shell.eventRegistry.register(this.$cancelPromptShellPgBtn,"click",i=>{this.prompt.toggle()}),this.shell.eventRegistry.register(this.$okayPromptShellPgBtn,"click",i=>{this.prompt.toggle(),this.promptHandler&&this.promptHandler(i)})}selectMenuItem(e){e&&(e.parentElement.className=N.SELECTED_CSS),this.$prevMenuShellPgA&&(this.$prevMenuShellPgA.parentElement.className=""),this.$prevMenuShellPgA=e}showMessage(e,t=3e3){this._clearMessageTimeout(),this.$toastMsgShellPgDiv.innerHTML=e,this.toast._targetEl.classList.remove("hidden"),this.toast._targetEl.classList.remove("opacity-0"),t>0&&(this.lastSbTimeoutHdl=setTimeout(()=>{this.hideMessage()},t))}hideMessage(){this.$toastMsgShellPgDiv.innerHTML="",this.toast.hide(),this._clearMessageTimeout()}_clearMessageTimeout(){this.lastSbTimeoutHdl||(clearTimeout(this.lastSbTimeoutHdl),this.lastSbTimeoutHdl=null)}showPrompt(e,t){this.$promptShellPgH3.innerHTML=e,this.promptHandler=t,this.$okayPromptShellPgBtn.onclick=t,this.prompt.show()}initialiseView(){this.$controlShellPgAudio.autoplay=this.shell.app.model.audioSettings.autoPlay,this.$autoPlayShellPgInput.checked=this.shell.app.model.audioSettings.autoPlay,this.$playNextShellPgInput.checked=this.shell.app.model.audioSettings.playNext,this.$repeatShellPgInput.checked=this.shell.app.model.audioSettings.repeat,this.$skipSizeShellPgInput.value=String(this.shell.app.model.audioSettings.skipSize),this.$applyStopStartShellPgInput.checked=this.shell.app.model.audioSettings.applyStopStartRange,this.$useTransferManageActionShellPgSelect.selectedIndex=this.shell.app.model.generalSettings.useTransfer,this.$currentTimeShellPgInput.step=this.$skipSizeShellPgInput.value,this.refreshMountedPlaylist(),this.refreshPlaybackRate(),this.refreshPlaylistControls(),this.refreshAudioPlaybackControls(),this.refreshPlayPause(),this.refreshUploadFileFromModel(),this.refreshDarkTheme()}refreshMountedPlaylist(){this.$steroTypeShellPgDiv.textContent=this.shell.model.playlist?.stereoType??"-"}refreshPlaybackRate(){let e=this.shell.app.model.audioSettings.playbackRate;this.$controlShellPgAudio.playbackRate=e,this.$playbackRateShellPgInput.value=String(e),this.$playbackRateShellPgLabel.textContent=`Rate: x${e}`}refreshStartStopRange(){this.$applyStopStartShellPgInput.checked?(this.$currentTimeShellPgInput.min=String(this.shell.model.startTime),this.$currentTimeShellPgInput.max=String(this.shell.model.stopTime),this.$startAudioShellPgBtn.textContent=this.shell.model.startTime.toFixed(2),this.$stopAudioShellPgBtn.textContent=this.shell.model.stopTime.toFixed(2),this.$controlShellPgAudio.currentTime<this.shell.model.startTime?this.$controlShellPgAudio.currentTime=this.shell.model.startTime:this.$controlShellPgAudio.currentTime>this.shell.model.stopTime&&(this.$controlShellPgAudio.currentTime=this.shell.model.stopTime)):(this.$currentTimeShellPgInput.min="0",this.$currentTimeShellPgInput.max=String(this.shell.model.trackModel.trackRecord.duration))}refreshPlaylistControls(){this.$prevTrackShellPgBtn.disabled=!this.shell.model.hasPrevious(),this.$nextTrackShellPgBtn.disabled=!this.shell.model.hasNext()}refreshAudioPlaybackControls(){let e=this.shell.model.audioState<3;this.$skipBackShellPgBtn.disabled=e,this.$playPauseToggleShellPgBtn.disabled=e,this.$skipForwardShellPgBtn.disabled=e,this.$applyStopStartShellPgInput.disabled=e}refreshPlayPause(){this.shell.model.audioState===4?(this.$playToggleShellSvg.classList.add("hidden"),this.$pauseToggleShellSvg.classList.remove("hidden")):(this.$playToggleShellSvg.classList.remove("hidden"),this.$pauseToggleShellSvg.classList.add("hidden"))}refreshOfflineElements(e){[this.$downloadSelsShellPgA,this.$deleteSelsShellPgA].forEach((i,r,n)=>{e?i.classList.add("pointer-events-none"):i.classList.remove("pointer-events-none")}),this.$abortOfflineShellPgBtn.disabled=!e}refreshUploadFileFromModel(){this.shell.app.model.generalSettings.useTransfer===0?this.$fileTransferManageActionShellPgInput.classList.add("hidden"):this.$fileTransferManageActionShellPgInput.classList.remove("hidden")}refreshDarkTheme(){let e=this.shell.app.model.generalSettings.darkTheme,t=document.getElementById("darkThemeToggleShellPgSvg"),i=document.getElementById("lightThemeToggleShellPgSvg");t.classList.add("hidden"),i.classList.add("hidden"),e?(t.classList.remove("hidden"),document.documentElement.classList.add("dark")):(i.classList.remove("hidden"),document.documentElement.classList.remove("dark"))}},lr=class s{static MAX_WORKERS=5;trackRefs;isDownloadMode;shell;offlineAudioManagerWorkerClient;offlineAudioWorkerClients=[];constructor(e,t,i){this.shell=e,this.trackRefs=t,this.isDownloadMode=i}async setup(){let e=this.shell.app.appConfig.offlineAudioManagerWorker,t=new Worker(e.scriptURL,{...e,name:"offlineAudioManagerWorker"});this.offlineAudioManagerWorkerClient=new ni(new we(t)),this.offlineAudioManagerWorkerClient.startClient();let i=[],r=[];for(let n=0;n<s.MAX_WORKERS;n++){let o=new MessageChannel,a=`cat_oamw_oaw_${n}`;i.push(a),r.push(o.port2);let l=this.shell.app.appConfig.offlineAudioWorker_n,c=new Worker(l.scriptURL,{...l,name:`offlineAudioWorker_${n}`}),u=new oi(new we(c));u.startClient(),await u.__transferPorts__({portIds:[a]},[o.port1]),this.offlineAudioWorkerClients.push(u)}await this.offlineAudioManagerWorkerClient.__transferPorts__({portIds:i},r),await this.offlineAudioManagerWorkerClient.setup({portIds:i}),this._registerWorkerListeners()}async teardown(){this._unregisterWorkerListeners();for(let e=0;e<s.MAX_WORKERS;e++)await this.offlineAudioWorkerClients[e].stopClient();await this.offlineAudioManagerWorkerClient.teardown(),await this.offlineAudioManagerWorkerClient.stopClient(),this.trackRefs=null,this.shell=null,this.offlineAudioWorkerClients.length=0,this.offlineAudioManagerWorkerClient=null}_registerWorkerListeners(){this.offlineAudioManagerWorkerClient.onProgressUpdate_=async e=>{let t=parseInt(`${e.progress*100}`);this.shell.view.$progrOfflineShellPgDiv.style.width=`${t}%`},this.offlineAudioManagerWorkerClient.onFinished_=async e=>{this.shell.view.refreshOfflineElements(!1),this.shell.view.$abortOfflineShellPgBtn.textContent="Finished",this.shell.view.$offlineInfoShellPgDiv.innerText=`Processed: ${e.count}`,this.shell.view.$progrOfflineShellPgDiv.style.width="0%",this.shell.showMessage("Offline processing finished"),await this.shell._teardownCoordinator()};for(let e=0;e<s.MAX_WORKERS;e++)this.offlineAudioWorkerClients[e].onProcessed_=async t=>{this.shell.view.$offlineInfoShellPgDiv.innerText=t.trackRef,this.shell.offlineTrackRefJson[t.trackRef]=t.isInCache}}_unregisterWorkerListeners(){this.offlineAudioManagerWorkerClient.onProgressUpdate_=null,this.offlineAudioManagerWorkerClient.onFinished_=null;for(let e=0;e<s.MAX_WORKERS;e++)this.offlineAudioWorkerClients[e].onProcessed_=null}async process(){this.shell.offlineTrackRefJson={},this.shell.view.$abortOfflineShellPgBtn.textContent="Abort",this.shell.view.refreshOfflineElements(!0),this.isDownloadMode?this.offlineAudioManagerWorkerClient.downloadSelections({selections:this.trackRefs}):this.offlineAudioManagerWorkerClient.deleteSelections({selections:this.trackRefs})}};var ci=class extends N{constructor(e,t,i,r){super(e,t,i,r,"sectionId/404","./templates/E404.html")}async canHandle(e){return!0}};var Eu=Fi(hi(),1);Prism.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},Prism.languages.markup.tag.inside["attr-value"].inside.entity=Prism.languages.markup.entity,Prism.languages.markup.doctype.inside["internal-subset"].inside=Prism.languages.markup,Prism.hooks.add("wrap",function(s){s.type==="entity"&&(s.attributes.title=s.content.replace(/&amp;/,"&"))}),Object.defineProperty(Prism.languages.markup.tag,"addInlined",{value:function(s,e){var t={};t["language-"+e]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:Prism.languages[e]},t.cdata=/^<!\[CDATA\[|\]\]>$/i;var i={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:t}};i["language-"+e]={pattern:/[\s\S]+/,inside:Prism.languages[e]};var r={};r[s]={pattern:RegExp("(<__[^>]*>)(?:<!\\[CDATA\\[(?:[^\\]]|\\](?!\\]>))*\\]\\]>|(?!<!\\[CDATA\\[)[^])*?(?=</__>)".replace(/__/g,function(){return s}),"i"),lookbehind:!0,greedy:!0,inside:i},Prism.languages.insertBefore("markup","cdata",r)}}),Object.defineProperty(Prism.languages.markup.tag,"addAttribute",{value:function(s,e){Prism.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(`(^|["'\\s])(?:`+s+`)\\s*=\\s*(?:"[^"]*"|'[^']*'|[^\\s'">=]+(?=[\\s>]))`,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[e,"language-"+e],inside:Prism.languages[e]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup,Prism.languages.xml=Prism.languages.extend("markup",{}),Prism.languages.ssml=Prism.languages.xml,Prism.languages.atom=Prism.languages.xml,Prism.languages.rss=Prism.languages.xml;(function(s){function e(l){return l=l.replace(/<inner>/g,function(){return`(?:\\\\.|[^\\\\
\r]|(?:
|\r
?)(?![\r
]))`}),RegExp("((?:^|[^\\\\])(?:\\\\{2})*)(?:"+l+")")}var t="(?:\\\\.|``(?:[^`\r\n]|`(?!`))+``|`[^`\r\n]+`|[^\\\\|\r\n`])+",i=`\\|?__(?:\\|__)+\\|?(?:(?:
|\r
?)|(?![^]))`.replace(/__/g,function(){return t}),r=`\\|?[ 	]*:?-{3,}:?[ 	]*(?:\\|[ 	]*:?-{3,}:?[ 	]*)+\\|?(?:
|\r
?)`;s.languages.markdown=s.languages.extend("markup",{}),s.languages.insertBefore("markdown","prolog",{"front-matter-block":{pattern:/(^(?:\s*[\r\n])?)---(?!.)[\s\S]*?[\r\n]---(?!.)/,lookbehind:!0,greedy:!0,inside:{punctuation:/^---|---$/,"front-matter":{pattern:/\S+(?:\s+\S+)*/,alias:["yaml","language-yaml"],inside:s.languages.yaml}}},blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},table:{pattern:RegExp("^"+i+r+"(?:"+i+")*","m"),inside:{"table-data-rows":{pattern:RegExp("^("+i+r+")(?:"+i+")*$"),lookbehind:!0,inside:{"table-data":{pattern:RegExp(t),inside:s.languages.markdown},punctuation:/\|/}},"table-line":{pattern:RegExp("^("+i+")"+r+"$"),lookbehind:!0,inside:{punctuation:/\||:?-{3,}:?/}},"table-header-row":{pattern:RegExp("^"+i+"$"),inside:{"table-header":{pattern:RegExp(t),alias:"important",inside:s.languages.markdown},punctuation:/\|/}}}},code:[{pattern:/((?:^|\n)[ \t]*\n|(?:^|\r\n?)[ \t]*\r\n?)(?: {4}|\t).+(?:(?:\n|\r\n?)(?: {4}|\t).+)*/,lookbehind:!0,alias:"keyword"},{pattern:/^```[\s\S]*?^```$/m,greedy:!0,inside:{"code-block":{pattern:/^(```.*(?:\n|\r\n?))[\s\S]+?(?=(?:\n|\r\n?)^```$)/m,lookbehind:!0},"code-language":{pattern:/^(```).+/,lookbehind:!0},punctuation:/```/}}],title:[{pattern:/\S.*(?:\n|\r\n?)(?:==+|--+)(?=[ \t]*$)/m,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])(?:[\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:e("\\b__(?:(?!_)<inner>|_(?:(?!_)<inner>)+_)+__\\b|\\*\\*(?:(?!\\*)<inner>|\\*(?:(?!\\*)<inner>)+\\*)+\\*\\*"),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^..)[\s\S]+(?=..$)/,lookbehind:!0,inside:{}},punctuation:/\*\*|__/}},italic:{pattern:e("\\b_(?:(?!_)<inner>|__(?:(?!_)<inner>)+__)+_\\b|\\*(?:(?!\\*)<inner>|\\*\\*(?:(?!\\*)<inner>)+\\*\\*)+\\*"),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^.)[\s\S]+(?=.$)/,lookbehind:!0,inside:{}},punctuation:/[*_]/}},strike:{pattern:e("(~~?)(?:(?!~)<inner>)+\\2"),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^~~?)[\s\S]+(?=\1$)/,lookbehind:!0,inside:{}},punctuation:/~~?/}},"code-snippet":{pattern:/(^|[^\\`])(?:``[^`\r\n]+(?:`[^`\r\n]+)*``(?!`)|`[^`\r\n]+`(?!`))/,lookbehind:!0,greedy:!0,alias:["code","keyword"]},url:{pattern:e('!?\\[(?:(?!\\])<inner>)+\\](?:\\([^\\s)]+(?:[	 ]+"(?:\\\\.|[^"\\\\])*")?\\)|[ 	]?\\[(?:(?!\\])<inner>)+\\])'),lookbehind:!0,greedy:!0,inside:{operator:/^!/,content:{pattern:/(^\[)[^\]]+(?=\])/,lookbehind:!0,inside:{}},variable:{pattern:/(^\][ \t]?\[)[^\]]+(?=\]$)/,lookbehind:!0},url:{pattern:/(^\]\()[^\s)]+/,lookbehind:!0},string:{pattern:/(^[ \t]+)"(?:\\.|[^"\\])*"(?=\)$)/,lookbehind:!0}}}}),["url","bold","italic","strike"].forEach(function(l){["url","bold","italic","strike","code-snippet"].forEach(function(c){l!==c&&(s.languages.markdown[l].inside.content.inside[c]=s.languages.markdown[c])})}),s.hooks.add("after-tokenize",function(l){l.language!=="markdown"&&l.language!=="md"||function c(u){if(u&&typeof u!="string")for(var y=0,_=u.length;y<_;y++){var P=u[y];if(P.type==="code"){var h=P.content[1],d=P.content[3];if(h&&d&&h.type==="code-language"&&d.type==="code-block"&&typeof h.content=="string"){var p=h.content.replace(/\b#/g,"sharp").replace(/\b\+\+/g,"pp"),g="language-"+(p=(/[a-z][\w-]*/i.exec(p)||[""])[0].toLowerCase());d.alias?typeof d.alias=="string"?d.alias=[d.alias,g]:d.alias.push(g):d.alias=[g]}}else c(P.content)}}(l.tokens)}),s.hooks.add("wrap",function(l){if(l.type==="code-block"){for(var c="",u=0,y=l.classes.length;u<y;u++){var _=l.classes[u],P=/language-(.+)/.exec(_);if(P){c=P[1];break}}var h=s.languages[c];if(h)l.content=s.highlight(l.content.replace(n,"").replace(/&(\w{1,8}|#x?[\da-f]{1,8});/gi,function(p,g){var m;return(g=g.toLowerCase())[0]==="#"?(m=g[1]==="x"?parseInt(g.slice(2),16):Number(g.slice(1)),a(m)):o[g]||p}),h,c);else if(c&&c!=="none"&&s.plugins.autoloader){var d="md-"+new Date().valueOf()+"-"+Math.floor(1e16*Math.random());l.attributes.id=d,s.plugins.autoloader.loadLanguages(c,function(){var p=document.getElementById(d);p&&(p.innerHTML=s.highlight(p.textContent,s.languages[c],c))})}}});var n=RegExp(s.languages.markup.tag.pattern.source,"gi"),o={amp:"&",lt:"<",gt:">",quot:'"'},a=String.fromCodePoint||String.fromCharCode;s.languages.md=s.languages.markdown})(Prism);var wn=window.Prism,ui=class extends N{constructor(e,t,i,r){super(e,t,i,r,"/about","./templates/about.html")}async setup(){await super.setup();let[e,t]=await D.loadTemplate("./README.md");e=e+`
[Contact Us](mailto:ashinw@gmail.com)`;let i=document.getElementById("aboutPageCode");i.textContent=e,wn.highlightElement(i,!1)}};var K=class s{static DIACRITICS_CHR=["\u0101","\u012B","\u016B","\u1E41","\u1E43","\u1E47","\u1E45","\xF1","\u1E63","\u1E6D","\u1E0D","\u1E37","\u1E25"];static DIACRITICS_ALT=["a","i","u","m","m","n","n","n","s","t","d","l","h"];static allIndexesOf(e,t,i=!0){let r=[],n=t.length-1,o=-1,a=0;for(i&&(e=e.toLowerCase(),t=t.toLowerCase());(o=e.indexOf(t,a))>-1;)r.push([o,o+n]),a=o+1;return r}static allIndexOfUsingRegEx(e,t,i="gm"){let r=new RegExp(t,i),n,o=[];for(;(n=r.exec(e))!==null;)n.index===r.lastIndex&&r.lastIndex++,o.push([n.index,n.index+n[0].length-1]);return o}static allLinePositions(e,t){let i=0,r=0,n=[];for(let o=0;o<t.length;o++){let l=e.substring(i,t[o][0]).match(/\n/gm),c=l?l.length:0;o===0&&c++,c+=r,n.push(c),i=t[o][0]+1,r=c}return n}static surroundingTrim(e,t,i){let r=e.length;if(i>=r)return e;let n=Math.floor(i/2),o=t-n,a=t+n;return o<0&&(o=0,a=i),a>r-1&&(a=r,o=Math.max(0,a-i)),e.substring(o,a).trim()}static removeDiacritics(e){for(let t=0;t<s.DIACRITICS_CHR.length;t++)e=e.replaceAll(s.DIACRITICS_CHR[t],s.DIACRITICS_ALT[t]);return e}static replaceAllSequence(e,t){let i=e;for(let r=0;r<t.length;r++)i=i.replaceAll(t[r][0],t[r][1]);return i}static lineLengths(e,t){let i=e.split(`
`),r=[];t&&(t.length=0,t.push(0));for(let n=0;n<i.length;n++)r.push(i[n].length),t&&t.push(t[n]+r[n]+1);return r}static convertToRegExIfValid(e){let t={patternOrSearchExpr:e,ignoreDiacritics:!0,regExFlags:void 0},i=e.lastIndexOf("/");if(!e.startsWith("/")||i<=0)return t;let r=e.substring(1,i),n=e.substring(i+1);if(!/^[gmisdyvuD]*$/.test(n))return t;n.indexOf("D")>-1&&(t.ignoreDiacritics=!1,n=n.replace("D",""));try{let o=new RegExp(r,n);return t.patternOrSearchExpr=r,t.regExFlags=n,t}catch{return t}}static{[s.DIACRITICS_CHR,s.DIACRITICS_ALT].forEach((t,i,r)=>{t.forEach((n,o,a)=>{a.push(n.toUpperCase())})})}};var pi=class{static removeLeadingZeros(e){let t=!0,i=[];for(let r of e)(r!==0||!t)&&(t=!1,i.push(r));return i}};var Oe=class s{static secToHhMmSsMmmSegs(e){let t=[0,0,0],i=Math.floor(e),r=Math.floor((e-i)*1e3)/1e3,n=i/(60*60);n>1&&(t[0]=Math.floor(n));let o=(n-t[0])*60;return o>1&&(t[1]=Math.floor(o)),t[2]=Math.ceil((o-t[1])*60)+r,t}static secToHhMmSsMmm(e,t=!0){let i=s.secToHhMmSsMmmSegs(e);t&&(i=pi.removeLeadingZeros(i));let r=i.join(":");return r||(r="0"),r}static HhMmSsMmmToSec(e){let t=e.split(":"),i=0;for(let r=t.length-1,n=0;r>-1;r--,n++)i+=parseFloat(t[r])*Math.pow(60,n);return i}static secToMm(e,t=!0){let i=e/60;return t&&(i=Math.ceil(i)),i}};var Pe=class extends A{type="CatalogModel";selectedAlbum=0;transients=["transients","tracks","playlist"];tracks=[];playlist=new G(void 0,"C","Catalog tracks playlist");static toHref(e){return`#catalog?ref=${e}`}};var Pn="dhamma-initiative.github.io",cr=`https://${Pn}`;var ce=class{static queryTrackTextUrl(e){return`${cr}/${e}.txt`}static queryTrackHtmlAudioSrcRef(e){return`${cr}/${e}.wav.mp3`}static parseTrackRefElements(e){let t=e.replace(/^.*[\\\/]/,""),i=e.substring(0,e.length-t.length);return i.startsWith("/")&&(i=i.substring(1)),i.endsWith("/")&&(i=i.substring(0,i.length-1)),[i,t]}static jsonToQueryString(e,t){let i=new URLSearchParams;return Object.getOwnPropertyNames(e).forEach((o,a,l)=>{e[o]!==void 0&&(!t||t&&t[o]!==e[o])&&i.set(o,e[o])}),i.toString().replaceAll("%2C",",")}static getSearchParamValueAsFloat(e,t){let i=parseFloat(e);return isNaN(i)?t:i}};var ie=class{static removeAllChildren(e){for(;e.firstChild;)e.firstChild.remove()}static isElementInViewport(e){let t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}static getElementScreenCenterScrollTo(e,t=1){let i=e.scrollHeight,n=e.getBoundingClientRect().top+window.scrollY+i*t,o=window.innerHeight||document.documentElement.clientHeight;return n-o/2}};var dr=class{_delegate;constructor(e){this._delegate=e}_prepareFilter(){this._delegate&&this._delegate._prepareFilter()}applyToTrack(e){let t=!0;return this.isCheckRequired()&&(t=this.isMatched(e)),t&&this._delegate&&(t=this._delegate.applyToTrack(e)),t}apply(e,t){this._prepareFilter();for(let i=0;i<e.length;i++){let r=this.applyToTrack(e[i]);t(i,e[i],r)}}},xt=class s extends dr{options;constructor(e,t){super(e),t?this.options=t:this.resetOptions()}resetOptions(){this.options=J.deepClone(this.getEmptyOptions()),this._delegate instanceof s&&this._delegate.resetOptions()}},gi=class s extends xt{static EMPTY_FILTER={_9_19_29_39_49_50p:[!1,!1,!1,!1,!1,!1]};getEmptyOptions(){return s.EMPTY_FILTER}isCheckRequired(){return this.options._9_19_29_39_49_50p.indexOf(!0)>-1}isMatched(e){let t=Math.ceil(e.duration/60),i=Math.min(Math.floor(t/10),5);return this.options._9_19_29_39_49_50p[i]}},mi=class s extends xt{static EMPTY_FILTER={cached_nonCached:[!1,!1]};getEmptyOptions(){return s.EMPTY_FILTER}isCheckRequired(){return this.options.cached_nonCached.indexOf(!0)>-1}isMatched(e){let t=e.isAudioCached?0:1;return!!this.options.cached_nonCached[t]}},fi=class s extends xt{static EMPTY_FILTER={title:"",ignoreDiacritics:!0,useRegEx:!1,regExFlags:""};getEmptyOptions(){return s.EMPTY_FILTER}isCheckRequired(){return this.options.title.length>0}isMatched(e){let t=this.options.cargo,i=`${e.trackRef} ${e.title}`,r=!1;if(this.options.ignoreDiacritics&&(i=K.removeDiacritics(i)),this.options.useRegEx)r=i.match(t)!==null;else{i=i.toLowerCase();let n=this.options.title.toLowerCase();r=i.indexOf(n)>-1}return r}_prepareFilter(){super._prepareFilter();let e=null;this.options.ignoreDiacritics&&(this.options.title=K.removeDiacritics(this.options.title)),this.options.useRegEx&&(e=new RegExp(this.options.title,this.options.regExFlags)),this.options.cargo=e}};var j=class s{static SELECTED_CSS="border-l-4 border-blue-600";static NON_SELECTED_CSS="border-b dark:border-gray-700";static CACHE_STATUS_COLOR_CSS=["bg-red-500","bg-green-500"];shell;eventRegistry;albumConfig;tracksConfig;filterConfig;audioCacheFilter=new mi(null);duraIntvFilter=new gi(this.audioCacheFilter);titleFilter=new fi(this.duraIntvFilter);constructor(e,t,i,r,n){this.shell=e,this.eventRegistry=t,this.albumConfig=i,this.albumConfig.albumsPgSelectId&&(this.albumConfig.$albumsPgSelect=document.getElementById(this.albumConfig.albumsPgSelectId)),this.tracksConfig=r,this.tracksConfig.$tracksPgTbody=document.getElementById(this.tracksConfig.tracksPgTbodyId),this.tracksConfig.$selectAllTracksPgInput=document.getElementById(this.tracksConfig.selectAllTracksPgInputId),this.filterConfig=n,this.filterConfig.$critSrchPgForm=document.getElementById(this.filterConfig.titleFilterPgFormId),this.filterConfig.$critSrchPgInput=document.getElementById(this.filterConfig.titleFilterPgInputId),this.filterConfig.$resetFilterPgBtn=document.getElementById(this.filterConfig.resetFilterPgBtnId),this.filterConfig.$filterDrpDnPgDiv=document.getElementById(this.filterConfig.filterDrpDnPgDivId)}refreshTrackCacheInfo(e){for(let t=0;t<this.tracksConfig.trackRows.length;t++){let i=this.tracksConfig.trackRows[t];if(e[i.trackRef]!==void 0){i.isAudioCached=e[i.trackRef];let r=this.tracksConfig.$tracksPgTbody.querySelector(`span[data-cache-flag-trackref="${i.trackRef}"]`);r.classList.remove(s.CACHE_STATUS_COLOR_CSS[0]),r.classList.remove(s.CACHE_STATUS_COLOR_CSS[1]);let n=s.CACHE_STATUS_COLOR_CSS[i.isAudioCached?1:0];r.classList.add(n)}}}registerListeners(){this.eventRegistry.register(this.filterConfig.$critSrchPgForm,"submit",e=>{e.preventDefault(),this._onFilterTextElemChange(e),this.applyFilter()}),this.eventRegistry.register(this.tracksConfig.$selectAllTracksPgInput,"change",e=>{this.selectAll(this.tracksConfig.$selectAllTracksPgInput.checked)}),this.eventRegistry.register(this.filterConfig.$resetFilterPgBtn,"click",e=>{this.titleFilter.resetOptions(),this._resetFilterViews(),this.applyFilter()}),this.eventRegistry.register(this.filterConfig.$filterDrpDnPgDiv,"change",e=>{this._onFilterDrpDnElemChange(e)}),this.tracksConfig.trackRowClickClosestElemType&&this.eventRegistry.register(this.tracksConfig.$tracksPgTbody,"click",e=>{this._onTableRowClick(e)})}_onTableRowClick(e){let t=e.target;t instanceof HTMLTableRowElement||(t=t.closest(this.tracksConfig.trackRowClickClosestElemType)),t&&t.localName===this.tracksConfig.trackRowClickClosestElemType?this.tracksConfig.onTrackRowClick(e,t):(t=e.target.closest("tr"),t&&this.tracksConfig.onTrackRowClick(e,t))}_onFilterDrpDnElemChange(e){if(e.target instanceof HTMLInputElement&&e.target.type==="checkbox"){let t=e.target.getAttribute("data-filter-dur"),i=t?this.duraIntvFilter.options._9_19_29_39_49_50p:this.audioCacheFilter.options.cached_nonCached;t||(t=e.target.getAttribute("data-filter-cache")),i[parseInt(t)]=e.target.checked,this.applyFilter()}}_onFilterTextElemChange(e){let t=this.filterConfig.$critSrchPgInput.value,i=K.convertToRegExIfValid(t);this.titleFilter.options.useRegEx=i.regExFlags!==void 0,this.titleFilter.options.regExFlags=i.regExFlags,this.titleFilter.options.title=i.patternOrSearchExpr}showHideTableRow(e,t){let i=document.getElementById(e);return t?i.classList.remove("hidden"):i.classList.add("hidden"),i}uncheckFilteredOutSelections(e,t){let i=document.getElementById(e);!t&&i.checked&&(i.checked=!1)}applyFilter(e){let t=e??this.tracksConfig.trackRows;this.titleFilter.apply(t,(i,r,n)=>{e&&(i=this.tracksConfig.trackRows.length-1);let o=`${i}.${this.tracksConfig.rowTableId}`,a=this.showHideTableRow(o,n),l=parseInt(a.getAttribute("data-cols"));if(l)for(let c=0;c<l;c++){let u=`${i}.${c}.${this.tracksConfig.rowColTableId}`,y=this.showHideTableRow(u,n),_=`${i}.${c}.${this.tracksConfig.rowColCheckboxId}`;this.uncheckFilteredOutSelections(_,n)}else{let c=`${i}.${this.tracksConfig.rowCheckboxId}`;this.uncheckFilteredOutSelections(c,n)}})}_resetFilterViews(){this.filterConfig.$critSrchPgInput.value=this.titleFilter.options.title,this.filterConfig.$filterDrpDnPgDiv.querySelectorAll("input[data-filter-dur]").forEach((e,t)=>{let i=parseInt(e.getAttribute("data-filter-dur"));e.checked=this.duraIntvFilter.options._9_19_29_39_49_50p[i]}),this.filterConfig.$filterDrpDnPgDiv.querySelectorAll("input[data-filter-cache]").forEach((e,t)=>{let i=parseInt(e.getAttribute("data-filter-cache"));e.checked=this.audioCacheFilter.options.cached_nonCached[i]})}selectAll(e){this.tracksConfig.$tracksPgTbody.childNodes.forEach((t,i)=>{if(t instanceof HTMLTableRowElement&&t.getAttribute("data-tr-type")==="body"){let n=t.getAttribute("data-row"),o=t.getAttribute("data-col");if(!t.classList.contains("hidden")){let a=o?`${n}.${o}.${this.tracksConfig.rowColCheckboxId}`:`${n}.${this.tracksConfig.rowCheckboxId}`,l=document.getElementById(a);l.checked=e}}})}getRowColSelections(){let e=this.tracksConfig.$tracksPgTbody.querySelectorAll('input[type="checkbox"]:checked');return Array.from(e).map(r=>{let n=[parseInt(r.getAttribute("data-row"))];return this.tracksConfig.rowColCheckboxId&&n.push(parseInt(r.getAttribute("data-col"))),n}).filter(r=>r!==null)}loadAlbums(){let e=this.shell.app.catalog;for(let t=0;t<e.length;t++){let i=document.createElement("option");i.value=e[t].id,i.setAttribute("data-album-index",String(e[t].index)),i.setAttribute("data-album-size",String(e[t].size)),i.innerHTML=e[t].name,this.albumConfig.$albumsPgSelect.append(i)}}};var vi=class extends N{model;view;filterAdapter;constructor(e,t,i,r){super(e,t,i,r,"/catalog","./templates/catalog.html"),this.model=this.app.model.catalog}onTrackListIndexChange(e,t,i){let r=Pe.toHref(this.model.playlist.selectedPlaylistItem.trackRef);this.app.catalogPage.$menuItem.href=r,this.view.selectTableRowTrack(this.model.playlist.getSelectionItem(),void 0)}async setup(){await super.setup(),this._setupFilterAdapter(),this.view=new mt(this),await this.view.loadTableRowTemplates(),this._registerListeners(),await this._initialiseView()}async _onShow(e){let t=e.urlRoute.searchParams.get("ref");t?await this.view.select(t):this.view.selectTableRowTrack(this.model.playlist.getSelectionItem(),void 0),super._onShow(e)}getTrackSelections(){let e=[];return this.filterAdapter.getRowColSelections().forEach((i,r,n)=>{let o=this.model.tracks[i[0]].trackRef;e.push(o)}),e}async onAfterOfflineProcessing(e){this.isViewLoaded&&this.filterAdapter.refreshTrackCacheInfo(e)}async refreshView(){await this.view.loadTableRowTracks(this.model.selectedAlbum,!0),this.view.selectTableRowTrack(this.model.playlist.getSelectionItem(),void 0)}_setupFilterAdapter(){this.filterAdapter=new j(this.shell,this.eventRegistry,mt.ALBUM_CFG,mt.TRACKS_CFG,mt.FILTER_CFG),this.filterAdapter.tracksConfig.trackRows=this.model.tracks,this.filterAdapter.tracksConfig.onTrackRowClick=(e,t)=>{let i=t.getAttribute("data-trackref");this.view.selectTableRowTrack(void 0,i),e.target.localName==="a"&&this.app.model.shell.mount(this.model.playlist,this),i&&this.setLocationHash(Pe.toHref(i),!0)}}async _initialiseView(){ee();let e=window.FlowbiteInstances._instances.Dial.actionsDrpDnCatPgDiv;this.eventRegistry.register(e._triggerEl,"click",i=>{e.toggle()});let t=window.FlowbiteInstances._instances.Dial.filterDrpDnCatPgDiv;this.eventRegistry.register(t._triggerEl,"click",i=>{t.toggle()}),Z(),this.filterAdapter.loadAlbums(),this.filterAdapter.albumConfig.$albumsPgSelect.selectedIndex=this.model.selectedAlbum,await this.refreshView()}_registerListeners(){this.filterAdapter.registerListeners(),this.eventRegistry.register(this.filterAdapter.albumConfig.$albumsPgSelect,"change",e=>{let t=this.app.catalog[this.filterAdapter.albumConfig.$albumsPgSelect.selectedIndex].id,i=Pe.toHref(t);this.setLocationHash(i,!0)}),this.eventRegistry.register(this.view.$copyActionCatPgA,"click",e=>{e.preventDefault(),this._onCopySelectionsClick(e)}),this.eventRegistry.register(this.view.$gotoActiveActionCatPgA,"click",e=>{e.preventDefault(),this._onGotoActiveSelectionClick(e)}),this.eventRegistry.register(this.view.$randomActionCatPgA,"click",async e=>{e.preventDefault(),this._onSelectRandomTrackClick(e)})}_onCopySelectionsClick(e){let t=this.filterAdapter.getRowColSelections();if(t.length===0){this.shell.showMessage("No selections have been made!");return}let i=[];t.forEach((r,n,o)=>{let a=this.model.tracks[r[0]].trackRef;i.push({trackRef:a})}),this.shell.addBookmarks(i)}_onGotoActiveSelectionClick(e){this.view.$prevSelectionTr&&(this.scrollYPos=ie.getElementScreenCenterScrollTo(this.view.$prevSelectionTr),this.moveToScrollPosition({urlRoute:D.currentUrlRoute,restorePosition:!0}))}async _onSelectRandomTrackClick(e){let t=Math.floor(Math.random()*(this.app.catalog.length-1)),i=Math.floor(Math.random()*(this.app.catalog[t].size-1)),n=(await this.app.albumStoreWorkerClient.selectAllTracksForAlbumWhere({albumIdx:t})).tracks[i].trackRef;await this.view.select(n)}},mt=class s{static ROW_TMPL_HTML;static ALBUM_CFG={albumsPgSelectId:"albumsCatPgSelect"};static TRACKS_CFG={tracksPgTbodyId:"tracksCatPgTbody",rowTableId:"trackCatPgTr",rowCheckboxId:"trackCatPgInput",rowColTableId:null,rowColCheckboxId:null,selectAllTracksPgInputId:"selectAllTracksCatPgInput",trackRowClickClosestElemType:"tr"};static FILTER_CFG={titleFilterPgFormId:"titleFilterCatPgForm",titleFilterPgInputId:"titleFilterCatPgInput",resetFilterPgBtnId:"resetFilterCatPgBtn",filterDrpDnPgDivId:"filterDrpDnCatPgDiv"};$copyActionCatPgA=document.getElementById("copyActionCatPgA");$gotoActiveActionCatPgA=document.getElementById("gotoActiveActionCatPgA");$randomActionCatPgA=document.getElementById("randomActionCatPgA");$prevSelectionTr;controller;prevAlbIdx=-1;constructor(e){this.controller=e}async select(e){let t=this.controller.filterAdapter.albumConfig.$albumsPgSelect.querySelector(`option[value="${e}"]`);if(!t){let i=ce.parseTrackRefElements(e);t=this.controller.filterAdapter.albumConfig.$albumsPgSelect.querySelector(`option[value="${i[0]}"]`)}if(t){let i=parseInt(t.getAttribute("data-album-index"));this.controller.model.selectedAlbum!==i&&(this.controller.model.selectedAlbum=i,this.controller.filterAdapter.albumConfig.$albumsPgSelect.selectedIndex=i,await this.loadTableRowTracks(i),this.controller.filterAdapter.applyFilter())}this.selectTableRowTrack(void 0,e)||this.selectTableRowTrack(this.controller.model.playlist.getSelectionItem(),void 0)}selectTableRowTrack(e,t){let i=t?`tr[data-trackref="${t}"]`:`tr[data-row="${e}"]`,r=this.controller.filterAdapter.tracksConfig.$tracksPgTbody.querySelector(i);return r&&(t&&(e=parseInt(r.getAttribute("data-row"))),this.$prevSelectionTr&&(this.$prevSelectionTr.className=j.NON_SELECTED_CSS),this.$prevSelectionTr=r,this.$prevSelectionTr.className=j.SELECTED_CSS,this.controller.model.playlist.setSelectionItem(e),!ie.isElementInViewport(this.$prevSelectionTr)&&this.controller.visitations===1&&this.controller.setScrollPosition(void 0,ie.getElementScreenCenterScrollTo(this.$prevSelectionTr))),r!==null}async loadTableRowTemplates(){let[e,t]=await D.loadTemplate("./templates/catalog.tracksCatPgTbody.trackCatPgTr.html");s.ROW_TMPL_HTML=e}async loadTableRowTracks(e,t=!1){let i=await this.controller.shell.app.albumStoreWorkerClient.selectAllTracksForAlbumWhere({albumIdx:e,forceRefresh:t});this._setTrackSource(i.tracks),ie.removeAllChildren(this.controller.filterAdapter.tracksConfig.$tracksPgTbody);for(let r=0;r<i.tracks.length;r++){let n=this._prepareRow(i.tracks[r]),o=document.createElement("tr");this.controller.filterAdapter.tracksConfig.$tracksPgTbody.append(o),o.outerHTML=n;let a=new Q;a.trackRef=i.tracks[r].trackRef}this.$prevSelectionTr=null,this.prevAlbIdx=e,this.controller.visitations=1}_setTrackSource(e){this.controller.model.tracks=e,this.controller.filterAdapter.tracksConfig.trackRows=e,this.controller.model.playlist.load(e,-1)}_prepareRow(e){let t=[["$ROW",`${e.index}`],["$TRACKREF",e.trackRef],["$TITLE",e.title],["$CACHE_STATUS_COLOR",j.CACHE_STATUS_COLOR_CSS[e.isAudioCached?1:0]],["$DUR",`${Oe.secToMm(e.duration)}`]];return K.replaceAllSequence(s.ROW_TMPL_HTML,t)}};var hp=Fi(hi(),1);var _n=window.Prism,yi=class extends N{constructor(e,t,i,r){super(e,t,i,r,"/help","./templates/help.html")}async setup(){await super.setup();let[e,t]=await D.loadTemplate("./templates/help-intro.md"),i=document.getElementById("helpPageCode");i.textContent=e,_n.highlightElement(i,!1)}};var cs;(function(s){"use strict";var e=function(){function i(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(i.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(r){this._dropEffect=r},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(r){this._effectAllowed=r},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),i.prototype.clearData=function(r){r!=null?delete this._data[r]:this._data=null},i.prototype.getData=function(r){return this._data[r]||""},i.prototype.setData=function(r,n){this._data[r]=n},i.prototype.setDragImage=function(r,n,o){var a=t._instance;a._imgCustom=r,a._imgOffset={x:n,y:o}},i}();s.DataTransfer=e;var t=function(){function i(){if(this._lastClick=0,i._instance)throw"DragDropTouch instance already created.";var r=!1;if(document.addEventListener("test",function(){},{get passive(){return r=!0,!0}}),"ontouchstart"in document){var n=document,o=this._touchstart.bind(this),a=this._touchmove.bind(this),l=this._touchend.bind(this),c=r?{passive:!1,capture:!1}:!1;n.addEventListener("touchstart",o,c),n.addEventListener("touchmove",a,c),n.addEventListener("touchend",l),n.addEventListener("touchcancel",l)}}return i.getInstance=function(){return i._instance},i.prototype._touchstart=function(r){var n=this;if(this._shouldHandle(r)){if(Date.now()-this._lastClick<i._DBLCLICK&&this._dispatchEvent(r,"dblclick",r.target)){r.cancelable&&r.preventDefault(),this._reset();return}this._reset();var o=this._closestDraggable(r.target);o&&!this._dispatchEvent(r,"mousemove",r.target)&&!this._dispatchEvent(r,"mousedown",r.target)&&(this._dragSource=o,this._ptDown=this._getPoint(r),this._lastTouch=r,r.cancelable&&r.preventDefault(),setTimeout(function(){n._dragSource==o&&n._img==null&&n._dispatchEvent(r,"contextmenu",o)&&n._reset()},i._CTXMENU),i._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout(function(){n._isDragEnabled=!0,n._touchmove(r)},i._PRESSHOLDAWAIT)))}},i.prototype._touchmove=function(r){if(this._shouldCancelPressHoldMove(r)){this._reset();return}if(this._shouldHandleMove(r)||this._shouldHandlePressHoldMove(r)){var n=this._getTarget(r);if(this._dispatchEvent(r,"mousemove",n)){this._lastTouch=r,r.cancelable&&r.preventDefault();return}this._dragSource&&!this._img&&this._shouldStartDragging(r)&&(this._dispatchEvent(r,"dragstart",this._dragSource),this._createImage(r),this._dispatchEvent(r,"dragenter",n)),this._img&&(this._lastTouch=r,r.cancelable&&r.preventDefault(),n!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(r,"dragenter",n),this._lastTarget=n),this._moveImage(r),this._isDropZone=this._dispatchEvent(r,"dragover",n))}},i.prototype._touchend=function(r){if(this._shouldHandle(r)){if(this._dispatchEvent(this._lastTouch,"mouseup",r.target)){r.cancelable&&r.preventDefault();return}this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",r.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(r.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},i.prototype._shouldHandle=function(r){return r&&!r.defaultPrevented&&r.touches&&r.touches.length<2},i.prototype._shouldHandleMove=function(r){return!i._ISPRESSHOLDMODE&&this._shouldHandle(r)},i.prototype._shouldHandlePressHoldMove=function(r){return i._ISPRESSHOLDMODE&&this._isDragEnabled&&r&&r.touches&&r.touches.length},i.prototype._shouldCancelPressHoldMove=function(r){return i._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(r)>i._PRESSHOLDMARGIN},i.prototype._shouldStartDragging=function(r){var n=this._getDelta(r);return n>i._THRESHOLD||i._ISPRESSHOLDMODE&&n>=i._PRESSHOLDTHRESHOLD},i.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new e,clearInterval(this._pressHoldInterval)},i.prototype._getPoint=function(r,n){return r&&r.touches&&(r=r.touches[0]),{x:n?r.pageX:r.clientX,y:n?r.pageY:r.clientY}},i.prototype._getDelta=function(r){if(i._ISPRESSHOLDMODE&&!this._ptDown)return 0;var n=this._getPoint(r);return Math.abs(n.x-this._ptDown.x)+Math.abs(n.y-this._ptDown.y)},i.prototype._getTarget=function(r){for(var n=this._getPoint(r),o=document.elementFromPoint(n.x,n.y);o&&getComputedStyle(o).pointerEvents=="none";)o=o.parentElement;return o},i.prototype._createImage=function(r){this._img&&this._destroyImage();var n=this._imgCustom||this._dragSource;if(this._img=n.cloneNode(!0),this._copyStyle(n,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var o=n.getBoundingClientRect(),a=this._getPoint(r);this._imgOffset={x:a.x-o.left,y:a.y-o.top},this._img.style.opacity=i._OPACITY.toString()}this._moveImage(r),document.body.appendChild(this._img)},i.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},i.prototype._moveImage=function(r){var n=this;requestAnimationFrame(function(){if(n._img){var o=n._getPoint(r,!0),a=n._img.style;a.position="absolute",a.pointerEvents="none",a.zIndex="999999",a.left=Math.round(o.x-n._imgOffset.x)+"px",a.top=Math.round(o.y-n._imgOffset.y)+"px"}})},i.prototype._copyProps=function(r,n,o){for(var a=0;a<o.length;a++){var l=o[a];r[l]=n[l]}},i.prototype._copyStyle=function(r,n){if(i._rmvAtts.forEach(function(y){n.removeAttribute(y)}),r instanceof HTMLCanvasElement){var o=r,a=n;a.width=o.width,a.height=o.height,a.getContext("2d").drawImage(o,0,0)}for(var l=getComputedStyle(r),c=0;c<l.length;c++){var u=l[c];u.indexOf("transition")<0&&(n.style[u]=l[u])}n.style.pointerEvents="none";for(var c=0;c<r.children.length;c++)this._copyStyle(r.children[c],n.children[c])},i.prototype._dispatchEvent=function(r,n,o){if(r&&o){var a=document.createEvent("Event"),l=r.touches?r.touches[0]:r;return a.initEvent(n,!0,!0),a.button=0,a.which=a.buttons=1,this._copyProps(a,r,i._kbdProps),this._copyProps(a,l,i._ptProps),a.dataTransfer=this._dataTransfer,o.dispatchEvent(a),a.defaultPrevented}return!1},i.prototype._closestDraggable=function(r){for(;r;r=r.parentElement)if(r.hasAttribute("draggable")&&r.draggable)return r;return null},i}();t._instance=new t,t._THRESHOLD=5,t._OPACITY=.5,t._DBLCLICK=500,t._CTXMENU=900,t._ISPRESSHOLDMODE=!1,t._PRESSHOLDAWAIT=400,t._PRESSHOLDMARGIN=25,t._PRESSHOLDTHRESHOLD=0,t._rmvAtts="id,class,style,draggable".split(","),t._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),t._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),s.DragDropTouch=t})(cs||(cs={}));var wi=class extends N{model;newPlaylistItem;view;filterAdapter;jsonLocalStore=new ae(new ve);constructor(e,t,i,r){super(e,t,i,r,"/playlist","./templates/playlist.html"),this.model=this.app.model.playlists}getTrackSelections(){let e=[],[t,i]=this._getBookmarkSelections();return i.forEach((r,n,o)=>{e.indexOf(r.trackRef)===-1&&e.push(r.trackRef)}),e}async onAfterOfflineProcessing(e){this.isViewLoaded&&this.filterAdapter.refreshTrackCacheInfo(e)}onTrackListIndexChange(e,t,i){let r=this.view.getTableRow(i);this.view.selectListItem(null,r,!1),this.app.model.shell.playlist.setSelectionItem(this.model.selectedPlaylist.getSelectionItem())}async setup(){await super.setup(),this._setupFilterAdapter(),this.view=new ft(this),await this.view.loadTableRowTemplates(),this._registerListeners(),this._registerDragDrop(),await this._initialiseView()}_setupFilterAdapter(){this.filterAdapter=new j(this.shell,this.eventRegistry,ft.ALBUM_CFG,ft.TRACKS_CFG,ft.FILTER_CFG),this.filterAdapter.tracksConfig.trackRows=[...this.model.tracks],this.filterAdapter.tracksConfig.onTrackRowClick=(e,t)=>{let i=e.target.localName==="a";this.view.selectListItem(e,t,i),i&&this.app.model.shell.mount(this.model.selectedPlaylist,this)}}async _initialiseView(){ee();let e=window.FlowbiteInstances._instances.Dial.actionsDrpDnPlayPgDiv;this.eventRegistry.register(e._triggerEl,"click",r=>{e.toggle()});let t=window.FlowbiteInstances._instances.Dial.filterDrpDnPlayPgDiv;this.eventRegistry.register(t._triggerEl,"click",r=>{t.toggle()});let i=window.FlowbiteInstances._instances.Dial.manageDrpDnPlayPgDiv;this.eventRegistry.register(i._triggerEl,"click",r=>{i.toggle()}),Z(),await this._refreshView()}async _refreshView(){this.view.refreshPlaylistsSelectElement();let e=this.model.getSelectedId();this.view.restoreListFromModel(e),this.model.selectedPlaylist=await this.model.loadList(this.jsonLocalStore,e),await this.view.loadTableRowPlaylist()}_registerListeners(){this.filterAdapter.registerListeners(),this.eventRegistry.register(this.view.$playlistPlayPgSelect,"change",async e=>{let t=this.model.setSelectedIndex(parseInt(this.view.$playlistPlayPgSelect.value));this.model.selectedPlaylist=await this.model.loadList(this.jsonLocalStore,t),await this.view.loadTableRowPlaylist()}),this.eventRegistry.register(this.view.$listEntryPlayPgForm,"submit",async e=>{e.preventDefault(),await this._onSaveSubmit()}),this.eventRegistry.register(this.view.$removeManageActionPlayPgA,"click",e=>{e.preventDefault(),this._onRemovePlaylistClick()}),this.eventRegistry.register(this.view.$purgeAllManageActionPlayPgA,"click",e=>{e.preventDefault(),this._onPurgeAllPlaylistsClick()}),this.eventRegistry.register(this.view.$newItemActionPlayPgA,"click",e=>{e.preventDefault(),this._onNewlistClick()}),this.eventRegistry.register(this.view.$editItemActionPlayPgA,"click",e=>{e.preventDefault(),this._onEditListClick()}),this.eventRegistry.register(this.view.$copyActionPlayPgA,"click",e=>{e.preventDefault(),this._onCopySelectionsClick()}),this.eventRegistry.register(this.view.$gotoActiveActionPlayPgA,"click",e=>{e.preventDefault(),this._onGotoActiveSelectionClick(e)}),this.eventRegistry.register(this.view.$pasteActionPlayPgA,"click",async e=>{e.preventDefault(),await this._onPasteBookmarksClick()}),this.eventRegistry.register(this.view.$importManageActionPlayPgA,"click",async e=>{e.preventDefault(),await this._onImportFromClick()}),this.eventRegistry.register(this.view.$exportManageActionPlayPgA,"click",async e=>{e.preventDefault(),await this._onExportToClick()}),this.eventRegistry.register(this.view.$restoreAllManageActionPlayPgA,"click",async e=>{e.preventDefault(),await this._onRestoreAllFromClick()}),this.eventRegistry.register(this.view.$backupAllManageActionPlayPgA,"click",async e=>{e.preventDefault(),await this._onBackupAllToClick()}),this.eventRegistry.register(this.view.$deleteActionPlayPgA,"click",async e=>{e.preventDefault(),await this._onDeleteSelectionsClick()}),this.eventRegistry.register(this.view.$saveModalEditPlayPgBtn,"click",async e=>{await this._onModalSaveClick()}),this.eventRegistry.register(this.view.$pasteBookmarkEditPlayPgBtn,"click",e=>{this._onModalPasteClick()}),this.eventRegistry.register(this.view.$closeModalPlayPgBtn,"click",e=>{this.view.updTrklistEntryPlayPg.toggle()})}async _onImportFromClick(){let e=await this._getBasePersistenceSourceForRead();if(e===null)return;let t=new Qe(e),i=new G,r=i.id;try{await i.restore(t),i.id=r,this.model.addPlaylist(i),this.model.setSelectedIndex(this.model.listIds.length-1),await this.model.save(this.jsonLocalStore),await i.save(this.jsonLocalStore),await this.jsonLocalStore.commit(),this.model.selectedPlaylist=await this.model.loadList(this.jsonLocalStore,r),await this._refreshView()}catch(n){console.error(n),this._showPersistenceMessage("Playlist in ${source} is invalid for import");return}this._showPersistenceMessage(`Playlist[${i.name}] was imported from \${source}`)}async _getBasePersistenceSourceForRead(){let e=null;return this.app.model.generalSettings.useTransfer===0?Ge.isReadAvailable()?e=this.shell.clipboardStore:this._showPersistenceMessage("Platform does not support reading from ${source}"):e=this.shell.fileStore,e}_showPersistenceMessage(e){let t=this.app.model.generalSettings.useTransfer===0?"clipboard":"file",i=e.replaceAll("${source}",t);this.app.shell.showMessage(i)}async _onRestoreAllFromClick(){let e=await this._getBasePersistenceSourceForRead();if(e===null)return;let t=this.app.model.generalSettings.useTransfer===0?"clipboard":"file",i=this.app.model.generalSettings.useTransfer;this.shell.showPrompt(`Are you sure you want to restore backup from ${t}?`,async r=>{let n=new Qe(e,!0),o=new gt;try{await o.restore(n);for(let a=0;a<o.listIds.length;a++){let l=await o.loadList(n,o.listIds[a]);this.model.addPlaylist(l),await l.save(this.jsonLocalStore),await this.jsonLocalStore.commit()}if(o.listIds.length>0){let a=this.model.listIds.indexOf(o.listIds[0]);this.model.setSelectedIndex(a)}await this.model.save(this.jsonLocalStore),await this.jsonLocalStore.commit()}catch(a){console.error(a),this._showPersistenceMessage("Playlists in ${source} are invalid for restoration");return}await this._refreshView(),this._showPersistenceMessage("Playlists were restored from ${source}")})}async _onBackupAllToClick(){if(this.model.listIds.length===0){this.app.shell.showMessage("There are no playlists to export");return}let e=this.app.model.generalSettings.useTransfer===0?this.shell.clipboardStore:this.shell.fileStore,t=new Qe(e);try{this.app.model.generalSettings.useTransfer===1&&(this.shell.fileStore.baseFilename="suttaplayer-backup"),await this.model.save(t);for(let i=0;i<this.model.listIds.length;i++)await(await this.model.loadList(this.jsonLocalStore,this.model.listIds[i])).save(t);await t.commit()}catch{this.app.shell.showMessage("Content is invalid for import");return}this._showPersistenceMessage("All Playlists were backed up to ${source}")}async _onExportToClick(){if(!this.model.selectedPlaylist){this.app.shell.showMessage("Select a playlist to export first");return}let e=this.app.model.generalSettings.useTransfer===0?this.shell.clipboardStore:this.shell.fileStore,t=new Qe(e),i=this.model.selectedPlaylist;this.app.model.generalSettings.useTransfer===1&&(this.shell.fileStore.baseFilename=`suttaplayer-${i.name}`),await i.save(t),await t.commit(),this._showPersistenceMessage(`Playlist[${i.name}] was export to \${source}`)}_onModalPasteClick(){let e=this.shell.bookmarks[Math.max(0,this.shell.bookmarks.length-1)];e&&this.view.restoreListItem(e)}async _onModalSaveClick(){let e=this.newPlaylistItem??this.model.selectedPlaylist.selectedPlaylistItem;if(this.view.saveListItemToModel(e),(await this.app.albumStoreWorkerClient.selectTrackWhere({trackRef:e.trackRef})).track===void 0){let i=`${e.trackRef} is an invalid track reference`;throw this.shell.showMessage(i,0),new Error(i)}this.newPlaylistItem&&(this.model.selectedPlaylist.items.push(e),this.model.selectedPlaylist.selectedPlaylistItem=e),await this._saveSelectedPlaylist(),await this.view.loadTableRowPlaylist(),this.view.updTrklistEntryPlayPg.toggle()}async _onDeleteSelectionsClick(){let[e,t]=this._getBookmarkSelections();if(e.length===0){this.shell.showMessage("No selections have been made to delete!");return}this.shell.showPrompt(`Are you sure you want to delete the ${e.length} selections?`,async i=>{for(let r=e.length-1;r>-1;r--)this.model.selectedPlaylist.items.splice(e[r][0],1);await this._saveSelectedPlaylist(),await this.view.loadTableRowPlaylist()})}async _onPasteBookmarksClick(){if(this.shell.bookmarks.length===0){this.shell.showMessage("No bookmarks copied to paste");return}this.shell.bookmarks.forEach((t,i,r)=>{let n=new Q;n.assignFrom(t),this.model.selectedPlaylist.items.push(n)});let e=await this._saveSelectedPlaylist();this.shell.bookmarks.length>0&&this.shell.showMessage(`${this.shell.bookmarks.length} saved bookmark(s) added!`),e?await this._refreshView():await this.view.loadTableRowPlaylist()}_onCopySelectionsClick(){let[e,t]=this._getBookmarkSelections();if(e.length===0){this.shell.showMessage("No selections have been made!");return}this.shell.addBookmarks(t)}_onGotoActiveSelectionClick(e){this.view.$prevSelectionTr&&(this.scrollYPos=ie.getElementScreenCenterScrollTo(this.view.$prevSelectionTr),this.moveToScrollPosition({urlRoute:D.currentUrlRoute,restorePosition:!0}))}_onEditListClick(){if(!this.model.selectedPlaylist?.selectedPlaylistItem){this.shell.showMessage("Click on a row 1st to select the playlist item");return}this.view.restoreListItem(this.model.selectedPlaylist.selectedPlaylistItem),this.view.updTrklistEntryPlayPg.toggle()}_onNewlistClick(){this.newPlaylistItem=new Q,this.view.restoreListItem(this.newPlaylistItem),this.view.updTrklistEntryPlayPg.toggle()}_onRemovePlaylistClick(){this.shell.showPrompt(`Are you sure you want to remove [${this.model.selectedPlaylist.name}]`,async e=>{let t=this.model.selectedPlaylist;if(t.isNew()&&t===this.model.newPlaylist)return;let i=new ae(new ve);await this.model.removePlaylist(i,this.model.getSelectedIndex()),await this.model.save(i),await this._refreshView()})}_onPurgeAllPlaylistsClick(){this.shell.showPrompt("Are you sure you want to purge ALL playlists? Consider doing a backup before purge!",async e=>{let t=new ae(new ve);for(let i=this.model.listIds.length-1;i>-1;i--)await this.model.removePlaylist(t,i);await this.model.save(t),await this._refreshView()})}async _onSaveSubmit(){if(!this.view.$listEntryPlayPgInput.value){this.shell.showMessage("Playlist name is required and used for sorting");return}await this._saveSelectedPlaylist(),this.view.refreshPlaylistsSelectElement()}async _saveSelectedPlaylist(){this.model.selectedPlaylist.name=this.view.$listEntryPlayPgInput.value;let e=this.model.selectedPlaylist.isNew();e&&this.model.addNewPlaylist();let t=new ae(new ve);return await this.model.selectedPlaylist.save(t),this.model.setSelectedIndex(this.model.listIds.indexOf(this.model.selectedPlaylist.id)),await this.model.save(t),e}_registerDragDrop(){this.eventRegistry.register(this.filterAdapter.tracksConfig.$tracksPgTbody,"dragstart",e=>{this.view.handleDragStart(e)}),this.eventRegistry.register(this.filterAdapter.tracksConfig.$tracksPgTbody,"dragover",e=>(e.preventDefault(),this.view.handleDragOver(e))),this.eventRegistry.register(this.filterAdapter.tracksConfig.$tracksPgTbody,"drop",async e=>{await this._onDrop(e)})}async _onDrop(e){e.preventDefault(),await this.view.handleDrop(e)&&await this._saveSelectedPlaylist()}_getBookmarkSelections(){let e=this.filterAdapter.getRowColSelections(),t=[];for(let i=0;i<e.length;i++){let r=this.model.selectedPlaylist.items[e[i][0]];t.push(r)}return[e,t]}},ft=class s{static ROW_TMPL_HTML;static ALBUM_CFG={albumsPgSelectId:null};static TRACKS_CFG={tracksPgTbodyId:"tracksPlayPgTbody",rowTableId:"trackPlayPgTr",rowCheckboxId:"trackPlayPgInput",rowColTableId:null,rowColCheckboxId:null,selectAllTracksPgInputId:"selectAllTracksPlayPgInput",trackRowClickClosestElemType:"tr"};static FILTER_CFG={titleFilterPgFormId:"titleFilterPlayPgForm",titleFilterPgInputId:"titleFilterPlayPgInput",resetFilterPgBtnId:"resetFilterPlayPgBtn",filterDrpDnPgDivId:"filterDrpDnPlayPgDiv"};$playlistPlayPgSelect=document.getElementById("playlistPlayPgSelect");$listEntryPlayPgForm=document.getElementById("listEntryPlayPgForm");$listEntryPlayPgInput=document.getElementById("listEntryPlayPgInput");$importManageActionPlayPgA=document.getElementById("importManageActionPlayPgA");$exportManageActionPlayPgA=document.getElementById("exportManageActionPlayPgA");$restoreAllManageActionPlayPgA=document.getElementById("restoreAllManageActionPlayPgA");$backupAllManageActionPlayPgA=document.getElementById("backupAllManageActionPlayPgA");$removeManageActionPlayPgA=document.getElementById("removeManageActionPlayPgA");$purgeAllManageActionPlayPgA=document.getElementById("purgeAllManageActionPlayPgA");$newItemActionPlayPgA=document.getElementById("newItemActionPlayPgA");$editItemActionPlayPgA=document.getElementById("editItemActionPlayPgA");$copyActionPlayPgA=document.getElementById("copyActionPlayPgA");$gotoActiveActionPlayPgA=document.getElementById("gotoActiveActionPlayPgA");$pasteActionPlayPgA=document.getElementById("pasteActionPlayPgA");$deleteActionPlayPgA=document.getElementById("deleteActionPlayPgA");$draggableTr=document.getElementById("draggableTr");$updTrklistEntryModalPlayPgDiv=document.getElementById("updTrklistEntryModalPlayPgDiv");$closeModalPlayPgBtn=document.getElementById("closeModalPlayPgBtn");$trackRefEditPlayPgInput=document.getElementById("trackRefEditPlayPgInput");$linePosEditPlayPgInput=document.getElementById("linePosEditPlayPgInput");$mtRangesEditPlayPgInput=document.getElementById("mtRangesEditPlayPgInput");$hlRangesEditPlayPgInput=document.getElementById("hlRangesEditPlayPgInput");$startAudioEditPlayPgInput=document.getElementById("startAudioEditPlayPgInput");$stopAudioEditPlayPgInput=document.getElementById("stopAudioEditPlayPgInput");$notesEditPlayPgTextArea=document.getElementById("notesEditPlayPgTextArea");$saveModalEditPlayPgBtn=document.getElementById("saveModalEditPlayPgBtn");$pasteBookmarkEditPlayPgBtn=document.getElementById("pasteBookmarkEditPlayPgBtn");$prevSelectionTr;$dragImgEl;updTrklistEntryPlayPg=new Et(this.$updTrklistEntryModalPlayPgDiv,{placement:"center",backdrop:"dynamic",closable:!0,onShow:e=>{},onHide:e=>{},onToggle:e=>{}});controller;constructor(e){this.controller=e}async loadTableRowTemplates(){let[e,t]=await D.loadTemplate("./templates/playlist.tracksPlayPgTbody.trackPlayPgTr.html");s.ROW_TMPL_HTML=e}restoreListFromModel(e){this.$listEntryPlayPgInput.value=this.controller.model.idNamesMap[e]}restoreListItem(e){this.$trackRefEditPlayPgInput.value=e.trackRef??"",this.$linePosEditPlayPgInput.value=`${e.cursorLinePosition??""}`,this.$mtRangesEditPlayPgInput.value=e.markTextRanges??"",this.$hlRangesEditPlayPgInput.value=e.highlightLineRanges??"",this.$startAudioEditPlayPgInput.value=`${e.startAudio??""}`,this.$stopAudioEditPlayPgInput.value=`${e.stopAudio??""}`,this.$notesEditPlayPgTextArea.value=e.notes??""}saveListItemToModel(e){e.trackRef=this.$trackRefEditPlayPgInput.value.trim().length>0?this.$trackRefEditPlayPgInput.value.trim():void 0,e.cursorLinePosition=isNaN(parseFloat(this.$linePosEditPlayPgInput.value))?void 0:parseFloat(this.$linePosEditPlayPgInput.value),e.markTextRanges=this.$mtRangesEditPlayPgInput.value.trim().length>0?this.$mtRangesEditPlayPgInput.value.trim():void 0,e.highlightLineRanges=this.$hlRangesEditPlayPgInput.value.trim().length>0?this.$hlRangesEditPlayPgInput.value.trim():void 0,e.startAudio=isNaN(parseFloat(this.$startAudioEditPlayPgInput.value))?void 0:parseFloat(this.$startAudioEditPlayPgInput.value),e.stopAudio=isNaN(parseFloat(this.$stopAudioEditPlayPgInput.value))?void 0:parseFloat(this.$stopAudioEditPlayPgInput.value),e.notes=this.$notesEditPlayPgTextArea.value.trim().length>0?this.$notesEditPlayPgTextArea.value.trim():void 0}getTableRow(e){return this.controller.filterAdapter.tracksConfig.$tracksPgTbody.querySelector(`tr[data-row="${e}"]`)}selectListItem(e,t,i){let r=parseInt(t.getAttribute("data-row"));if(this.controller.model.selectedPlaylist.setSelectionItem(r),this.$prevSelectionTr){if(this._refreshDraggable(this.$prevSelectionTr,!1),this.$prevSelectionTr===t&&!i){this.$prevSelectionTr.className=j.NON_SELECTED_CSS,this.$prevSelectionTr=null;return}this.$prevSelectionTr.className=j.NON_SELECTED_CSS}(async()=>{let n=new ae(new ve);await this.controller.model.selectedPlaylist.save(n)})(),this.$prevSelectionTr=t,this._refreshDraggable(this.$prevSelectionTr,!0),this.$prevSelectionTr.className=j.SELECTED_CSS}refreshPlaylistsSelectElement(){let e=Array.from(this.$playlistPlayPgSelect.options).filter(i=>i.value!=="-1").forEach(i=>i.remove()),t=this.controller.model.listIds;for(let i=0;i<t.length;i++){let r=document.createElement("option");r.value=i.toString(),r.setAttribute("data-id",t[i]),r.innerHTML=this.controller.model.idNamesMap[t[i]],this.$playlistPlayPgSelect.append(r)}this.$playlistPlayPgSelect.selectedIndex=this.controller.model.getSelectedIndex()+1}async loadTableRowPlaylist(){let e=this.controller.model.selectedPlaylist;this.$listEntryPlayPgInput.value=e.name,ie.removeAllChildren(this.controller.filterAdapter.tracksConfig.$tracksPgTbody),this.controller.filterAdapter.tracksConfig.trackRows.length=0,this.$prevSelectionTr=null;let t=e.getSelectionItem();for(let i=0,r=0;i<e.items.length;i++){let n=e.items[i],o=await this.controller.app.albumStoreWorkerClient.selectTrackWhere({trackRef:n.trackRef});if(o.track===void 0){e.items.splice(i,1),t===i?(t=-1,e.setSelectionItem(t)):i<t&&(t--,e.setSelectionItem(t));continue}this.controller.filterAdapter.tracksConfig.trackRows.push(o.track);let a=this._prepareRow(r,n,o.track),l=document.createElement("tr");this.controller.filterAdapter.tracksConfig.$tracksPgTbody.append(l),l.outerHTML=a,r===t&&(this.$prevSelectionTr=document.getElementById(`${r}.trackPlayPgTr`),this.$prevSelectionTr.className=N.SELECTED_CSS,this._refreshDraggable(this.$prevSelectionTr,!0)),r++}}handleDragStart(e){let t=e.target;if(this.$draggableTr=t.closest("tr"),this.$draggableTr?.getAttribute("data-row")!==null){this.$dragImgEl&&this.$dragImgEl.remove();let i=this.$draggableTr.getBoundingClientRect(),r=e.clientX-i.left,n=e.clientY-i.top;e.dataTransfer.effectAllowed="move";let o=this.$draggableTr.querySelector('td[data-td-type="body"]');this.$dragImgEl=o.cloneNode(!0),this.$dragImgEl.draggable=!1,this.$dragImgEl.style.top="-1000px",this.$dragImgEl.querySelector('div[data-div-type="dragHandle"]').remove(),document.body.appendChild(this.$dragImgEl),e.dataTransfer.setDragImage(this.$dragImgEl,r,n)}}handleDragOver(e){return e.dataTransfer.dropEffect="move",!1}async handleDrop(e){this.$dragImgEl&&this.$dragImgEl.remove();let t=e.target.closest("tr");if(t===this.$draggableTr)return this.$draggableTr=null,!1;if(this.$draggableTr&&t instanceof HTMLTableRowElement){let i=parseInt(this.$draggableTr.getAttribute("data-row")),r=parseInt(t.getAttribute("data-row"));i<r&&r--;let n=this.controller.model.tracks.splice(i,1);this.controller.model.tracks.splice(r,0,n[0]);let o=this.controller.model.selectedPlaylist.items.splice(i,1);return this.controller.model.selectedPlaylist.items.splice(r,0,o[0]),this.$draggableTr.parentNode.insertBefore(this.$draggableTr,t),this._reorganiseTablesRows(i,r),this.$draggableTr=null,this.controller.model.selectedPlaylist.setSelectionItem(r),!0}return!1}_reorganiseTablesRows(e,t){let i=Math.min(e,t),r=Math.max(e,t),n=this.controller.filterAdapter.tracksConfig.$tracksPgTbody;for(let o=i;o<=r;o++){let a=n.children[o],l=o.toString();a.id=`${o}.trackPlayPgTr`,a.setAttribute("data-row",l);let c=a.querySelector("input[data-row]");c.id=`${o}.trackPlayPgInput`,c.setAttribute("data-row",l);let u=a.querySelector("label");u.setAttribute("for",`${o}.trackPlayPgInput`),u.setAttribute("data-row",l)}}_refreshDraggable(e,t){let i=e.querySelector('td div[data-div-type="dragHandle"]');i.draggable=t,t?i.classList.remove("hidden"):i.classList.add("hidden")}_prepareRow(e,t,i){let r=Q.toHref(t),n=[["$ROW",`${e}`],["$TRACKREF",t.trackRef],["$TRACK_QUERYSTR_HREF",r],["$TITLE",i.title],["$CACHE_STATUS_COLOR",j.CACHE_STATUS_COLOR_CSS[i.isAudioCached?1:0]],["$DUR",`${Oe.secToMm(i.duration)}`],["$PROPERTIES_QS",t.toString(!0)]];return K.replaceAllSequence(s.ROW_TMPL_HTML,n)}};var Pi=class{static bindRpc(e){let t=e;t.api||(t.api=3),t.bindRpcFunc(t,e.setup),t.bindRpcFunc(t,e.teardown,{hasNoArgs:!0}),t.bindRpcFunc(t,e.search),t.bindRpcFunc(t,e.onQueryState,{hasNoArgs:!0,hasReturn:!0}),t.bindRpcFunc(t,e.onPaused),t.bindRpcFunc(t,e.onUnpausedAwait,{hasNoArgs:!0,hasClientPromiseAwait:!0,hasReturn:!0}),t.bindRpcFunc(t,e.onProgressUpdate),t.bindRpcFunc(t,e.onFinished)}},_i=class{static bindRpc(e){let t=e;t.api||(t.api=3),t.bindRpcFunc(t,e.setup),t.bindRpcFunc(t,e.teardown,{hasNoArgs:!0}),t.bindRpcFunc(t,e.search,{hasReturn:!0}),t.bindRpcFunc(t,e.onSearch),t.bindRpcFunc(t,e.onMatch)}};var bi=class extends le{__getName__(){return"SearchTextManagerWorkerClient"}onQueryState_;onQueryState=async()=>await this.onQueryState_();onPaused_;onPaused=async e=>{await this.onPaused_(e)};onUnpausedAwait_;onUnpausedAwait=async e=>await this.onUnpausedAwait_(e);onProgressUpdate_;onProgressUpdate=async e=>{await this.onProgressUpdate_(e)};onFinished_;onFinished=async e=>{await this.onFinished_(e)};async setup(e){let t=this._prepareMessage(this.setup,e);await this._postMessage(this._getRecipient(),t)}async teardown(){let e=this._prepareMessage(this.teardown);await this._postMessage(this._getRecipient(),e)}async search(e){let t=this._prepareMessage(this.search,e);await this._postMessage(this._getRecipient(),t)}_bindMethods(){super._bindMethods(),Pi.bindRpc(this)}};var ki=class extends le{__getName__(){return"SearchTextWorkerClient"}onSearch_;onSearch=async e=>{await this.onSearch_(e)};onMatch_;onMatch=async e=>{await this.onMatch_(e)};async setup(e){let t=this._prepareMessage(this.setup,e);await this._postMessage(this._getRecipient(),t)}async teardown(){let e=this._prepareMessage(this.teardown);await this._postMessage(this._getRecipient(),e)}async search(e){let t=this._prepareMessage(this.search,e);return(await this._postMessage(this._getRecipient(),t)).resp}_bindMethods(){super._bindMethods(),_i.bindRpc(this)}};var Ct={selectedAlbum:0,searchAllAlbums:!1,criteria:"",applyAndBetweenTerms:!0,andDelimiter:";"},vt=class extends A{type="SearchModel";selectedAlbum=Ct.selectedAlbum;searchAllAlbums=Ct.searchAllAlbums;criteria=Ct.criteria;applyAndBetweenTerms=Ct.applyAndBetweenTerms;andDelimiter=Ct.andDelimiter;transients=["transients","coordinatorState","tracks","trackMatches","matchCount","playlist"];coordinatorState;tracks=[];trackMatches=[];matchCount=0;playlist=new G(void 0,"S","Search results playlist");fromSearchParams(e){let t=parseInt(e.get("selectedAlbum")),i=e.get("searchAllAlbums"),r=e.get("criteria"),n=e.get("applyAndBetweenTerms"),o=e.get("andDelimiter");return Number.isNaN(t)||(this.selectedAlbum=t),i&&(this.searchAllAlbums=i==="true"),r&&(this.criteria=r),n&&(this.applyAndBetweenTerms=n==="true"),o&&(this.andDelimiter=o),this}toJson(){return{selectedAlbum:this.selectedAlbum,searchAllAlbums:this.searchAllAlbums,criteria:this.criteria,applyAndBetweenTerms:this.applyAndBetweenTerms,andDelimiter:this.andDelimiter}}static toHref(e){return`#search?${ce.jsonToQueryString(e)}`}};var Si=class extends N{model;view;filterAdapter;coordinator;constructor(e,t,i,r){super(e,t,i,r,"/search","./templates/search.html"),this.model=this.app.model.search,this.model.coordinatorState={isStarted:!1,isPaused:!1,unPauseAwait:null}}getTrackSelections(){let e=[];return this._getSearchResultSelections().forEach((i,r,n)=>{e.indexOf(i.trackRef)===-1&&e.push(i.trackRef)}),e}async onAfterOfflineProcessing(e){this.isViewLoaded&&this.filterAdapter.refreshTrackCacheInfo(e)}onTrackListIndexChange(e,t,i){this.view.selectTableHeaderRow(null,"body",!0)}async _onShow(e){e.urlRoute.searchParams.size>0&&(this.model.fromSearchParams(e.urlRoute.searchParams),this.view.restoreFromModel()),this.model.playlist.getSelectionItem()>-1&&this.view.selectTableHeaderRow(null,"body",!0),super._onShow(e)}async setup(){await super.setup(),this._setupFilterAdapter(),this.view=new yt(this),await this.view.loadTableRowTemplates(),this._registerListeners(),this._initialiseView()}onSearch=async e=>{this.view.$searchInfoSrchPgDiv.innerText=e.trackRef};onMatch=async e=>{this.model.tracks.push(e.track),this.model.trackMatches.push(e.matches),this.model.matchCount+=e.matches.length;let t=new Q;t.assignFrom({...e.matches[0].bookmark,trackRef:e.track.trackRef}),this.model.playlist.items.push(t);let i=this.model.tracks.length-1;this.view.createTableRowMatchEntries(i,e.track,e.matches),this.filterAdapter.applyFilter([e.track])};onQueryState=async()=>({isPaused:this.model.coordinatorState.isPaused});onPaused=async e=>{e.isPaused&&this.shell.showMessage("Search paused")};onUnpausedAwait=async e=>{this.model.coordinatorState.unPauseAwait=e;let t=await this.model.coordinatorState.unPauseAwait;return this.model.coordinatorState.unPauseAwait=null,t};onProgressUpdate=async e=>{let t=parseInt(`${e.progress*100}`);this.view.$progrSearchSrchPgDiv.style.width=`${t}%`};onFinished=async e=>{this.view.resetSearchProgress(this.model),this._prepareSrchResultTallyMessage("Finished"),await this._teardownCoordinator(),this.shell.showMessage("Search finished")};_setupFilterAdapter(){this.filterAdapter=new j(this.shell,this.eventRegistry,yt.ALBUM_CFG,yt.TRACKS_CFG,yt.FILTER_CFG),this.filterAdapter.tracksConfig.trackRows=this.model.tracks,this.filterAdapter.tracksConfig.onTrackRowClick=(e,t)=>{this.view.onTableRowClick(e,t)}}_initialiseView(){ee();let e=window.FlowbiteInstances._instances.Dial.actionsDrpDnSrchPgDiv;this.eventRegistry.register(e._triggerEl,"click",i=>{e.toggle()});let t=window.FlowbiteInstances._instances.Dial.filterDrpDnSrchPgDiv;this.eventRegistry.register(t._triggerEl,"click",i=>{t.toggle()}),Z(),this.filterAdapter.loadAlbums(),this.filterAdapter.albumConfig.$albumsPgSelect.selectedIndex=this.model.selectedAlbum,this.view.restoreFromModel()}_registerListeners(){this.filterAdapter.registerListeners(),this.eventRegistry.register(this.filterAdapter.albumConfig.$albumsPgSelect,"change",e=>{this.model.selectedAlbum=this.filterAdapter.albumConfig.$albumsPgSelect.selectedIndex}),this.eventRegistry.register(this.view.$allAlbumsSrchPgInput,"change",e=>{this.model.searchAllAlbums=this.view.$allAlbumsSrchPgInput.checked}),this.eventRegistry.register(this.view.$critSrchPgDiv,"change",e=>{this._onCritSrchPgDivChange(e)}),this.eventRegistry.register(this.view.$critSrchPgForm,"submit",async e=>{e.preventDefault(),await this._onSearchSubmit(e)}),this.eventRegistry.register(this.view.$pauseToggleSrchPgA,"click",e=>{e.preventDefault(),this.model.coordinatorState.isPaused=!this.model.coordinatorState.isPaused,this.model.coordinatorState.unPauseAwait&&this.model.coordinatorState.unPauseAwait.resolve({isPaused:this.model.coordinatorState.isPaused})}),this.eventRegistry.register(this.view.$abortSearchSrchPgBtn,"click",async e=>{this.coordinator&&(this._prepareSrchResultTallyMessage("Aborted"),await this._teardownCoordinator())}),this.eventRegistry.register(this.view.$copyActionSrchPgA,"click",e=>{e.preventDefault(),this._onCopySelectionsClick(e)}),this.eventRegistry.register(this.view.$gotoActiveActionSrchPgA,"click",e=>{e.preventDefault(),this._onGotoActiveSelectionClick(e)})}_prepareSrchResultTallyMessage(e){let t=this.model.tracks.length,i=`${this.model.matchCount} results in ${t} files`;this.model.coordinatorState.isPaused=!1,this.view.$pauseToggleSrchPgA.classList.add("hidden"),this.view.$abortSearchSrchPgBtn.textContent=e,this.view.$searchInfoSrchPgDiv.textContent=i}_onCritSrchPgDivChange(e){this.view.saveToModel()}_onCopySelectionsClick(e){let t=this._getSearchResultSelections();if(t.length===0){this.shell.showMessage("No selections have been made!");return}this.shell.addBookmarks(t)}_onGotoActiveSelectionClick(e){this.view.$prevSelectionTr&&(this.scrollYPos=ie.getElementScreenCenterScrollTo(this.view.$prevSelectionTr),this.moveToScrollPosition({urlRoute:D.currentUrlRoute,restorePosition:!0}))}async _onSearchSubmit(e){if(this.model.coordinatorState.isStarted){this.shell.showMessage("Search currently in execution");return}this.model.coordinatorState.isStarted=!0,this.view.$pauseToggleSrchPgA.classList.remove("hidden"),this.view.$abortSearchSrchPgBtn.textContent="Abort",await this._startSearch();let t=vt.toHref(this.model.toJson());this.setLocationHash(t,!0)}_getSearchResultSelections(){let e=this.filterAdapter.getRowColSelections(),t=[];for(let i=0;i<e.length;i++){let r=this.model.trackMatches[e[i][0]][e[i][1]],n={trackRef:this.model.tracks[e[i][0]].trackRef,...r.bookmark};t.push(n)}return t}async _startSearch(){this.model.tracks.length=0,this.model.trackMatches.length=0,this.model.matchCount=0,this.model.playlist.items.length=0,this.model.playlist.setSelectionItem(-1),ie.removeAllChildren(this.filterAdapter.tracksConfig.$tracksPgTbody),await this._setupCoordinator();let e=this.view.createSearchTextScope(),t=this.view.createSearchTextCriteria();await this.coordinator.search(e,t)}async _setupCoordinator(){this.coordinator=new hr(this),await this.coordinator.setup()}async _teardownCoordinator(){this.coordinator&&(await this.coordinator.teardown(),this.coordinator=null),this.view.resetSearchProgress(this.model)}},yt=class s{static ROW_MATCH_TMPL_HTML;static ROW_HEADER_TMPL_HTML;static ALBUM_CFG={albumsPgSelectId:"albumsSrchPgSelect"};static TRACKS_CFG={tracksPgTbodyId:"resultSrchPgTbody",rowTableId:"trackRsltHdrSrchPgTr",rowCheckboxId:null,rowColTableId:"matchRsltSrchPgTr",rowColCheckboxId:"matchRsltSrchPgInput",selectAllTracksPgInputId:"selectAllResultsSrchPgInput",trackRowClickClosestElemType:"button"};static FILTER_CFG={titleFilterPgFormId:"titleFilterSrchPgForm",titleFilterPgInputId:"titleFilterSrchPgInput",resetFilterPgBtnId:"resetFilterSrchPgBtn",filterDrpDnPgDivId:"filterDrpDnSrchPgDiv"};static convertToQueryString=new Q;$allAlbumsSrchPgInput=document.getElementById("allAlbumsSrchPgInput");$critSrchPgForm=document.getElementById("critSrchPgForm");$critSrchPgDiv=document.getElementById("critSrchPgDiv");$critSrchPgInput=document.getElementById("critSrchPgInput");$applyAndSrchPgInput=document.getElementById("applyAndSrchPgInput");$andDelimiterSrchPgInput=document.getElementById("andDelimiterSrchPgInput");$abortSearchSrchPgBtn=document.getElementById("abortSearchSrchPgBtn");$searchInfoSrchPgDiv=document.getElementById("searchInfoSrchPgDiv");$progrSearchSrchPgDiv=document.getElementById("progrSearchSrchPgDiv");$copyActionSrchPgA=document.getElementById("copyActionSrchPgA");$gotoActiveActionSrchPgA=document.getElementById("gotoActiveActionSrchPgA");$pauseToggleSrchPgA=document.getElementById("pauseToggleSrchPgA");$prevSelectionTr;controller;constructor(e){this.controller=e}async loadTableRowTemplates(){let[e,t]=await D.loadTemplate("./templates/search.resultSrchPgTbody.trackRsltHdrSrchPgTr.html");s.ROW_HEADER_TMPL_HTML=e;let[i,r]=await D.loadTemplate("./templates/search.resultSrchPgTbody.matchRsltSrchPgTr.html");s.ROW_MATCH_TMPL_HTML=i}createTableRowMatchEntries(e,t,i){let r=document.createElement("tr");this.controller.filterAdapter.tracksConfig.$tracksPgTbody.append(r),r.outerHTML=this._prepareHeaderRow(e,i.length,t);for(let n=0;n<i.length;n++){let o=document.createElement("tr");this.controller.filterAdapter.tracksConfig.$tracksPgTbody.append(o),o.outerHTML=this._prepareMatchRow(e,n,t,i[n])}}onTableRowClick(e,t){if(!(e.target instanceof HTMLInputElement&&e.target.type==="checkbox"))if(t instanceof HTMLButtonElement)this.toggleTableHeaderExpandCollapse(t);else{let i=t.getAttribute("data-tr-type"),r=e.target.localName==="a";this.selectTableHeaderRow(t,i,r),r&&this.controller.app.model.shell.mount(this.controller.model.playlist,this.controller)}}selectTableHeaderRow(e,t,i=!1){let r=-1,n=!1;if(e?r=parseInt(e.getAttribute("data-row")):(r=this.controller.model.playlist.getSelectionItem(),n=!0),t==="body"&&(i=!0,e=this.controller.filterAdapter.tracksConfig.$tracksPgTbody.querySelector(`tr[data-tr-type="head"][data-row="${r}"]`)),this.controller.model.playlist.getSelectionItem()!==r||n)this.$prevSelectionTr&&(this.$prevSelectionTr.className=j.NON_SELECTED_CSS),this.$prevSelectionTr=e,this.$prevSelectionTr.className=j.SELECTED_CSS,this.controller.model.playlist.setSelectionItem(r);else if(!i){let o=e.getAttribute("data-checked")==="1";e.setAttribute("data-checked",o?"0":"1"),this.controller.filterAdapter.tracksConfig.$tracksPgTbody.querySelectorAll(`input[type="checkbox"][data-row="${r}"]`).forEach((a,l)=>{a.checked=!o})}}toggleTableHeaderExpandCollapse(e){if(!(e.id&&e.id.endsWith(".trackRsltHdrSrchPgBtn")))return;let t=e.getAttribute("data-btn-state")!=="+",i=parseInt(e.id.replace(".trackRsltHdrSrchPgBtn",""));e.setAttribute("data-btn-state",t?"+":"-");let r=this.controller.model.trackMatches[i];for(let n=0;n<r.length;n++){let o=`${i}.${n}.${this.controller.filterAdapter.tracksConfig.rowColTableId}`,a=`${i}.${n}.${this.controller.filterAdapter.tracksConfig.rowColCheckboxId}`;t||this.controller.filterAdapter.uncheckFilteredOutSelections(a,t),this.controller.filterAdapter.showHideTableRow(o,t)}}restoreFromModel(){this.$allAlbumsSrchPgInput.checked=this.controller.model.searchAllAlbums,this.$critSrchPgInput.value=this.controller.model.criteria,this.$applyAndSrchPgInput.checked=this.controller.model.applyAndBetweenTerms,this.$andDelimiterSrchPgInput.value=this.controller.model.andDelimiter}saveToModel(){this.controller.model.criteria=this.$critSrchPgInput.value,this.controller.model.applyAndBetweenTerms=this.$applyAndSrchPgInput.checked,this.controller.model.andDelimiter=this.$andDelimiterSrchPgInput.value,this.controller.model.applyAndBetweenTerms&&!this.controller.model.andDelimiter&&(this.controller.shell.showMessage("A delimiter representing 'and' is required"),this.$applyAndSrchPgInput.checked=!1,this.controller.model.applyAndBetweenTerms=!1)}resetSearchProgress(e){e.coordinatorState.isStarted=!1,this.$progrSearchSrchPgDiv.style.width="0%"}createSearchTextScope(){return{startFromAlbumIndex:this.controller.filterAdapter.albumConfig.$albumsPgSelect.selectedIndex,searchAllAlbums:this.$allAlbumsSrchPgInput.checked}}createSearchTextCriteria(){let e=K.convertToRegExIfValid(this.$critSrchPgInput.value),t=e.regExFlags!==void 0;return{searchFor:e.patternOrSearchExpr,ignoreDiacritics:e.ignoreDiacritics,applyAndBetweenTerms:!t&&this.$applyAndSrchPgInput.checked,andDelimiter:this.$andDelimiterSrchPgInput.value,useRegEx:t,regExFlags:e.regExFlags}}_prepareHeaderRow(e,t,i){let r=[["$ROW",`${e}`],["$COLS",`${t}`],["$TRACKREF",i.trackRef],["$TITLE",i.title],["$CACHE_STATUS_COLOR",j.CACHE_STATUS_COLOR_CSS[i.isAudioCached?1:0]],["$DUR",`${Oe.secToMm(i.duration)}`]];return K.replaceAllSequence(s.ROW_HEADER_TMPL_HTML,r)}_prepareMatchRow(e,t,i,r){let n=Q.toHref({trackRef:i.trackRef,...r.bookmark}),o=[["$ROW",`${e}`],["$COL",`${t}`],["$TRACKREF",i.trackRef],["$LINENUM",`${r.displayTeaser.lineNumber}`],["$TRACK_QUERYSTR_HREF",n],["$TEASER",r.displayTeaser.teaser]];return K.replaceAllSequence(s.ROW_MATCH_TMPL_HTML,o)}},hr=class s{static MAX_WORKERS=5;page;searchTextManagerWorkerClient;searchTextWorkerClients=[];albumStorePortIds=[];constructor(e){this.page=e}async setup(){let e=this.page.app.appConfig.searchTextManagerWorker,t=new Worker(e.scriptURL,{...e,name:"searchTextManagerWorker"});this.searchTextManagerWorkerClient=new bi(new we(t)),this.searchTextManagerWorkerClient.startClient();let i=[],r=new MessageChannel;this.albumStorePortIds.push("srch_asw_stmw"),i.push(r.port2);let n=[],o=[];for(let a=0;a<s.MAX_WORKERS;a++){let l=new MessageChannel,c=`srch_asw_stw_${a}`;this.albumStorePortIds.push(c),i.push(l.port2);let u=new MessageChannel,y=`srch_stmw_stw_${a}`;n.push(y),o.push(u.port2);let _=this.page.app.appConfig.searchTextWorker_n,P=new Worker(_.scriptURL,{..._,name:`searchTextWorker_${a}`}),h=new ki(new we(P));this.searchTextWorkerClients.push(h),h.startClient(),await h.__transferPorts__({portIds:[c,y]},[l.port1,u.port1]),await h.setup({albumStorePortId:c})}await this.page.shell.app.albumStoreWorkerClient.__transferPorts__({portIds:this.albumStorePortIds},i),await this.searchTextManagerWorkerClient.__transferPorts__({portIds:[this.albumStorePortIds[0],...n]},[r.port1,...o]),await this.searchTextManagerWorkerClient.setup({albumStorePortId:this.albumStorePortIds[0],portIds:n}),this._registerWorkerListeners()}async teardown(){this._unregisterWorkerListeners();for(let e=0;e<s.MAX_WORKERS;e++)await this.searchTextWorkerClients[e].teardown(),await this.searchTextWorkerClients[e].stopClient();await this.searchTextManagerWorkerClient.teardown(),await this.searchTextManagerWorkerClient.stopClient(),this.page=null,this.albumStorePortIds.length=0,this.searchTextManagerWorkerClient=null,this.searchTextWorkerClients.length=0,this.searchTextWorkerClients=null}async search(e,t){await this.searchTextManagerWorkerClient.search({scope:e,criteria:t})}_registerWorkerListeners(){this.searchTextManagerWorkerClient.onQueryState_=this.page.onQueryState,this.searchTextManagerWorkerClient.onPaused_=this.page.onPaused,this.searchTextManagerWorkerClient.onUnpausedAwait_=this.page.onUnpausedAwait,this.searchTextManagerWorkerClient.onProgressUpdate_=this.page.onProgressUpdate,this.searchTextManagerWorkerClient.onFinished_=this.page.onFinished;for(let e=0;e<s.MAX_WORKERS;e++)this.searchTextWorkerClients[e].onSearch_=this.page.onSearch,this.searchTextWorkerClients[e].onMatch_=this.page.onMatch}_unregisterWorkerListeners(){this.searchTextManagerWorkerClient.onQueryState_=null,this.searchTextManagerWorkerClient.onPaused_=null,this.searchTextManagerWorkerClient.onUnpausedAwait_=null,this.searchTextManagerWorkerClient.onProgressUpdate_=null,this.searchTextManagerWorkerClient.onFinished_=null;for(let e=0;e<s.MAX_WORKERS;e++)this.searchTextWorkerClients[e].onSearch_=null,this.searchTextWorkerClients[e].onMatch_=null}};var Ti=class{static forEach(e,t,i){let r="",n=!1,o="";for(let a=0;a<e.length;a++){let l=e.charAt(a),c=t.includes(a);n===c?o+=l:(r+=i(o,n),o=l),n=c}return o&&(r+=i(o,n)),r}},Ie=class{selections;constructor(e){this.selections=new Set(e)}toggle(e){let t=this.selections.has(e);return t?this.selections.delete(e):this.selections.add(e),!t}toString(){if(this.selections.size===0)return"";let e=Array.from(this.selections).sort((o,a)=>o-a),t=[],i=[e[0]];function r(){i.length===1?t.push(`${i[0]}`):i.length>1&&t.push(`${i[0]}-${i[i.length-1]}`)}for(let o=1;o<e.length;o++)e[o-1]+1===e[o]?i.push(e[o]):(r(),i=[e[o]]);return r(),t.join(",")}toNumbers(){let e=Array.from(this.selections);return e.sort(),this.selections=new Set(e),e}fromString(e){this.selections.clear();let t=e.split(",");for(let i=0;i<t.length;i++)if(t[i]){let r=t[i].split("-"),n=[];for(let o=0;o<r.length;o++)n.push(parseInt(r[o]));if(n.length===1)this.selections.add(n[0]);else for(let o=n[0];o<n[1]+1;o++)this.selections.add(o)}return this}fromNumbers(e){let t=[];return e.forEach((i,r,n)=>{let o=String(i);o=o.replace(",","-"),t.push(o)}),this.fromString(t.toString())}};var Ei=class s{static markupContent(e,t,i){return t&&(e=s._markupHeaders(e)),i&&(e=this._markupTextRanges(e,i)),e}static _markupHeaders(e){let t=e.indexOf(`
`),i=e.substring(0,t);i="# "+i;let r=e.indexOf(`
`,t+1),n=e.substring(t+1,r).trim();n.length>0&&(n="## "+n);let o=e.substring(r+1);return e=`${i}
${n}
${o}`,e}static _markupTextRanges(e,t){let i=new Ie;return i.fromString(t),i.selections.size>0&&(e=Ti.forEach(e,i.toNumbers(),(r,n)=>n?`==${r}==`:r)),e}};var pg=Fi(hi(),1);(function(){if(typeof Prism<"u"&&typeof document<"u"){var s="line-numbers",e=/\n(?!$)/g,t=Prism.plugins.lineNumbers={getLine:function(n,o){if(n.tagName==="PRE"&&n.classList.contains(s)){var a=n.querySelector(".line-numbers-rows");if(a){var l=parseInt(n.getAttribute("data-start"),10)||1,c=l+(a.children.length-1);o<l&&(o=l),o>c&&(o=c);var u=o-l;return a.children[u]}}},resize:function(n){r([n])},assumeViewportIndependence:!0},i=void 0;window.addEventListener("resize",function(){t.assumeViewportIndependence&&i===window.innerWidth||(i=window.innerWidth,r(Array.prototype.slice.call(document.querySelectorAll("pre.line-numbers"))))}),Prism.hooks.add("complete",function(n){if(n.code){var o=n.element,a=o.parentNode;if(a&&/pre/i.test(a.nodeName)&&!o.querySelector(".line-numbers-rows")&&Prism.util.isActive(o,s)){o.classList.remove(s),a.classList.add(s);var l,c=n.code.match(e),u=c?c.length+1:1,y=new Array(u+1).join("<span></span>");(l=document.createElement("span")).setAttribute("aria-hidden","true"),l.className="line-numbers-rows",l.innerHTML=y,a.hasAttribute("data-start")&&(a.style.counterReset="linenumber "+(parseInt(a.getAttribute("data-start"),10)-1)),n.element.appendChild(l),r([a]),Prism.hooks.run("line-numbers",n)}}}),Prism.hooks.add("line-numbers",function(n){n.plugins=n.plugins||{},n.plugins.lineNumbers=!0})}function r(n){if((n=n.filter(function(a){var l,c=(l=a,l?window.getComputedStyle?getComputedStyle(l):l.currentStyle||null:null)["white-space"];return c==="pre-wrap"||c==="pre-line"})).length!=0){var o=n.map(function(a){var l=a.querySelector("code"),c=a.querySelector(".line-numbers-rows");if(l&&c){var u=a.querySelector(".line-numbers-sizer"),y=l.textContent.split(e);u||((u=document.createElement("span")).className="line-numbers-sizer",l.appendChild(u)),u.innerHTML="0",u.style.display="block";var _=u.getBoundingClientRect().height;return u.innerHTML="",{element:a,lines:y,lineHeights:[],oneLinerHeight:_,sizer:u}}}).filter(Boolean);o.forEach(function(a){var l=a.sizer,c=a.lines,u=a.lineHeights,y=a.oneLinerHeight;u[c.length-1]=void 0,c.forEach(function(_,P){if(_&&_.length>1){var h=l.appendChild(document.createElement("span"));h.style.display="block",h.textContent=_}else u[P]=y})}),o.forEach(function(a){for(var l=a.sizer,c=a.lineHeights,u=0,y=0;y<c.length;y++)c[y]===void 0&&(c[y]=l.children[u++].getBoundingClientRect().height)}),o.forEach(function(a){var l=a.sizer,c=a.element.querySelector(".line-numbers-rows");l.style.display="none",l.innerHTML="",a.lineHeights.forEach(function(u,y){c.children[y].style.height=u+"px"})})}}})();var O=window.Prism,Ai=class s{static LINE_NUMBERS_CLASS="line-numbers";static LINKABLE_LINE_NUMBERS_CLASS="linkable-line-numbers";static NEW_LINE_EXP=/\n(?!$)/g;static _isLineHeightRounded;$currentPreElem;static $$(e,t){return Array.prototype.slice.call((t||document).querySelectorAll(e))}static hasClass(e,t){return e.classList.contains(t)}static isLineHeightRounded(){if(typeof s._isLineHeightRounded<"u")return s._isLineHeightRounded;let e=document.createElement("div");return e.style.fontSize="13px",e.style.lineHeight="1.5",e.style.padding="0",e.style.border="0",e.innerHTML="&nbsp;<br />&nbsp;",document.body.appendChild(e),s._isLineHeightRounded=e.offsetHeight===38,document.body.removeChild(e),s._isLineHeightRounded}static getContentBoxTopOffset(e,t){let i=getComputedStyle(e),r=getComputedStyle(t);function n(o){return+o.substring(0,o.length-2)}return t.offsetTop+n(r.borderTopWidth)+n(r.paddingTop)-n(i.paddingTop)}static isActiveFor(e){return!e||!/pre/i.test(e.nodeName)?!1:!!(e.hasAttribute("data-line")||e.id&&O.util.isActive(e,s.LINKABLE_LINE_NUMBERS_CLASS))}highlightLines(e,t,i){t=typeof t=="string"?t:e.getAttribute("data-line")||"";let r=t.replace(/\s+/g,"").split(",").filter(Boolean),n=+e.getAttribute("data-line-offset")||0,a=(s.isLineHeightRounded()?parseInt:parseFloat)(getComputedStyle(e).lineHeight),l=O.util.isActive(e,s.LINE_NUMBERS_CLASS),c=e.querySelector("code"),u=l?e:c||e,y=[],_=c.textContent.match(s.NEW_LINE_EXP),P=_?_.length+1:1,h=!c||u==c?0:s.getContentBoxTopOffset(e,c);if(this.$currentPreElem=e,r.forEach(d=>{let p=d.split("-"),g=+p[0],m=+p[1]||g;if(m=Math.min(P+n,m),m<g)return;let v=e.querySelector('.line-highlight[data-range="'+d+'"]')||document.createElement("div");this._addRangeInitMutations(y,v,d,i),l&&O.plugins.lineNumbers?this._addRangeLineNumberMutations(e,g,m,h,y,v):this._addRangeNonLineNumberMutations(y,v,g,m,n,a,h),this._addRangeFinMutations(y,v,e,u)}),l&&O.util.isActive(e,s.LINKABLE_LINE_NUMBERS_CLASS)&&e.id){s.hasClass(e,s.LINKABLE_LINE_NUMBERS_CLASS)||y.push(()=>{e.classList.add(s.LINKABLE_LINE_NUMBERS_CLASS)});let d=parseInt(e.getAttribute("data-start")||"1");s.$$(".line-numbers-rows > span",e).forEach((p,g)=>{let m=g+d;p.id=`_ln${m}`,p.setAttribute("data-ln",String(m))})}return()=>{y.forEach(d=>d())}}_addRangeInitMutations(e,t,i,r){e.push(()=>{t.setAttribute("aria-hidden","true"),t.setAttribute("data-range",i),t.className=(r||"")+" line-highlight"})}_addRangeFinMutations(e,t,i,r){e.push(()=>{t.style.width=i.scrollWidth+"px"}),e.push(()=>{r.appendChild(t)})}_addRangeLineNumberMutations(e,t,i,r,n,o){let a=O.plugins.lineNumbers.getLine(e,t),l=O.plugins.lineNumbers.getLine(e,i);if(a){let c=a.offsetTop+r+"px";n.push(()=>{o.style.top=c})}if(l){let c=l.offsetTop-a.offsetTop+l.offsetHeight+"px";n.push(()=>{o.style.height=c})}}_addRangeNonLineNumberMutations(e,t,i,r,n,o,a){e.push(()=>{t.setAttribute("data-start",String(i)),r>i&&t.setAttribute("data-end",String(r)),t.style.top=(i-n-1)*o+a+"px",t.textContent=new Array(r-i+2).join(` 
`)})}static highlightLinesIfRqd(e){e||(e=O.plugins.lineHighlight.$currentPreElem),s.$$(".temporary.line-highlight").forEach(i=>{i.parentNode.removeChild(i)});let t=e.urlRoute.searchParams.get("highlightLineRanges");if(t){let i=t;i=(i.match(/([\d,-]+)$/)||[""])[0],e.hasAttribute("data-line")||e.setAttribute("data-line",""),O.plugins.lineHighlight.highlightLines(e,i,"temporary ")()}}static registerHooks(){let e=0;O.hooks.add("before-sanity-check",t=>{let i=t.element.parentElement;if(!s.isActiveFor(i))return;let r=0;s.$$(".line-highlight",i).forEach(n=>{r+=n.textContent.length,n.parentNode.removeChild(n)}),r&&/^(?: \n)+$/.test(t.code.slice(-r))&&(t.code=t.code.slice(0,-r))}),O.hooks.add("complete",function t(i){let r=i.element.parentElement;if(!s.isActiveFor(r))return;clearTimeout(e);let n=O.plugins.lineNumbers,o=i.plugins&&i.plugins.lineNumbers;s.hasClass(r,s.LINE_NUMBERS_CLASS)&&n&&!o?O.hooks.add("line-numbers",t):(O.plugins.lineHighlight.highlightLines(r)(),e=setTimeout(s.highlightLinesIfRqd,1))})}static{s.registerHooks(),O.plugins.lineHighlight=new s}},Be=class s{static keyswordsList;static registerLanguage(){let e=[];for(let t=0;t<s.keyswordsList.length;t++)e.push(new RegExp(`\\b${s.keyswordsList[t]}\\b`,"i"));O.languages.trackmd=O.languages.extend("markdown",{keyword:e})}static registerFeatures(){O.languages.insertBefore("trackmd","prolog",{strike:{pattern:/--[^-]+--/,lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^~~)[\s\S]+(?=\1$)/,lookbehind:!0,inside:{}},punctuation:/~~/}},highlight:{pattern:/==[^=]+==/,lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^==)[\s\S]+(?=\1$)/,lookbehind:!0,inside:{}},punctuation:/==/}}})}static registerHooks(){O.hooks.add("wrap",function(e){e.language==="trackmd"&&(e.type==="strike"?e.content=e.content.replaceAll('<span class="token punctuation">~~</span>',""):e.type==="highlight"&&(e.content=e.content.replaceAll('<span class="token punctuation">==</span>',"")))})}};var Ii=class s extends N{static SELECTED_CSS="border-l-4 border-blue-600";static SUBCTX="/";static collections;model;view;textMarkers={mouseState:-1,begin:-1,end:-1,mobileMessageInterval:void 0};_onTextSelectionHandler=e=>{this._onCodeTextSelection()};_onWindowResizeHandler=e=>{this._onRefreshCursorPositionAndHighlighting()};constructor(e,t,i,r){super(e,t,i,r,s.SUBCTX,"./templates/track.html"),this.model=this.app.model.track}async asyncConstructor(){if(!s.collections){s.collections=[];for(let e of this.shell.app.catalog)s.collections.push(e.id)}if(!Be.keyswordsList){let e=await this.shell.app.albumStoreWorkerClient.selectKeywordsList();Be.keyswordsList=e.keywords,Be.registerLanguage(),Be.registerFeatures(),Be.registerHooks()}}async canHandle(e){if(!e.pathname.startsWith(s.SUBCTX))return!1;let t=e.pathname.substring(s.SUBCTX.length),i=t.lastIndexOf("/"),r=t.substring(0,i);i=s.collections.indexOf(r);let n=i>-1;return!n&&this.model.playlist.selectedPlaylistItem.trackRef?n=!0:n=(await this.app.albumStoreWorkerClient.selectTrackWhere({trackRef:t})).track!==void 0,n}async onEnter(e){await super.onEnter(e),document.addEventListener("selectionchange",this._onTextSelectionHandler),window.addEventListener("resize",this._onWindowResizeHandler)}async onExit(){await super.onExit(),document.removeEventListener("selectionchange",this._onTextSelectionHandler),window.removeEventListener("resize",this._onWindowResizeHandler)}_saveSearchParamPositionToModel(){this.model.cursorLinePosition=ce.getSearchParamValueAsFloat(this.model.urlRoute.searchParams.get("cursorLinePosition"),void 0),!this.model.cursorLinePosition&&this.visitations===1&&(this.scrollYPos=0)}_saveSearchParamAudioPositionsToModel(){return this.model.prevAudioConfig=this.model.currAudioConfig,this.model.startAudio=ce.getSearchParamValueAsFloat(this.model.urlRoute.searchParams.get("startAudio"),void 0),this.model.stopAudio=ce.getSearchParamValueAsFloat(this.model.urlRoute.searchParams.get("stopAudio"),void 0),this.model.currAudioConfig=`${this.model.startAudio}_${this.model.stopAudio}`,this.model.currAudioConfig!==this.model.prevAudioConfig}_saveSearchParamHighlightLinesToModel(){this.model.urlRoute.cargo.rangeSelections=this.model.highlightLineRanges;let e=this.model.urlRoute.searchParams.get("highlightLineRanges");this.model.highlightLineRanges.toString()!==e&&this.model.highlightLineRanges.fromString(e??"")}_saveSearchParamMarkupsToModel(){let e=this.model.urlRoute.searchParams.get("markTextRanges");this.model.markTextRanges.toString()!==e&&(this.model.markTextRanges.fromString(e??""),this._prepareMarkTextMarkdown(e))}async setup(){await super.setup(),this.view=new ur(this),this._initialiseView(),this._registerListeners()}_initialiseView(){ee();let e=window.FlowbiteInstances._instances.Dial.menuTrackPgDiv;this.eventRegistry.register(e._triggerEl,"click",t=>{e.toggle()}),Z(),this.model.persistentModel.href&&(this.$menuItem.href=this.model.persistentModel.href)}_registerListeners(){this.view.$textTrackPgCode.addEventListener("mousedown",e=>{this._onCodeMouseDown(e)}),this.view.$textTrackPgCode.addEventListener("mouseup",e=>{this._onCodeMouseUp(e)}),this.eventRegistry.register(this.view.$textTrackPgCode,"click",e=>{this._onLineNumberClick(e)}),this.eventRegistry.register(this.view.$textTrackPgCode,"dblclick",e=>{this._onLineNumberDblClick(e)}),this.eventRegistry.register(this.view.$copyBookmarkTrackPgA,"click",e=>{e.preventDefault(),this._copyBookmark()}),this.eventRegistry.register(this.view.$toggleLineCursorTrackPgA,"click",e=>{e.preventDefault(),this._toggleLineCursor(!1)}),this.eventRegistry.register(this.view.$toggleTextSelTrackPgA,"click",e=>{e.preventDefault(),this._toggleTextMarkups(!1)}),this.eventRegistry.register(this.view.$toggleLineHighlightTrackPgA,"click",e=>{e.preventDefault(),this._toggleLineHighlight(!1)}),this.eventRegistry.register(this.view.$syncAudioTrackPgA,"click",e=>{e.preventDefault(),this._moveAudioToSelection()}),this.eventRegistry.register(this.view.$toggleAudStartTrackPgA,"click",e=>{e.preventDefault(),this.toggleAudioStart(!1)}),this.eventRegistry.register(this.view.$toggleAudStopTrackPgA,"click",e=>{e.preventDefault(),this.toggleAudioStop(!1)}),this.eventRegistry.register(this.view.$clearBookmakTrackPgSelect,"change",e=>{this._clearBookmarkSelectChange(e)}),this.eventRegistry.register(this.view.$autoScrollWithAudioTrackPgInput,"change",e=>{this.app.model.textSettings.autoScrollWithAudio=this.view.$autoScrollWithAudioTrackPgInput.checked})}_copyBookmark(){let e={trackRef:this.model.trackRef,cursorLinePosition:this.model.cursorLinePosition,highlightLineRanges:this.model.highlightLineRanges.toString(),markTextRanges:this.model.markTextRanges.toString(),startAudio:this.model.startAudio,stopAudio:this.model.stopAudio};this.shell.setBookmark(e)}_clearBookmarkSelectChange(e){let t=this.view.$clearBookmakTrackPgSelect.selectedIndex;this.view.$clearBookmakTrackPgSelect.selectedIndex=0,t===3&&this._toggleLineCursor(!0),(t===1||t===3)&&this._toggleTextMarkups(!0),(t===2||t===3)&&this._toggleLineHighlight(!0),t===3&&this.toggleAudioStart(!0),t===3&&this.toggleAudioStop(!0),this._reloadPageUsingQueryString()}_moveAudioToSelection(){if(!this.model.currMarkedTextSelection)return;let e=this.model.currMarkedTextSelection.toNumbers(),t=this.model.estimateAudioPosition(e[0]);this.app.shell.model.onAudioResetTimeTo(t)}_onCodeMouseDown(e){this.textMarkers.mouseState=1}_onCodeMouseUp(e){this._onFinaliseTextSelection()}_onCodeTextSelection(){J.IS_MOBILE_PLATFORM&&this.textMarkers.mouseState<=0&&this._onCodeMouseDown(null);let e=window.getSelection();if(e.rangeCount>0){let t=e.getRangeAt(0),i=t.commonAncestorContainer,r=this._findNearestCodeElement(i);if(!r)return;this.textMarkers.mouseState===1&&(this.textMarkers.mouseState=2);let n=this._getOffsetWithinElement(r,t.startContainer,t.startOffset),o=this._getOffsetWithinElement(r,t.endContainer,t.endOffset);o-=o>n?1:0,this.textMarkers.begin=n,this.textMarkers.end=o,J.IS_MOBILE_PLATFORM&&this.textMarkers.mouseState===2&&(clearTimeout(this.textMarkers.mobileMessageInterval),this.textMarkers.mobileMessageInterval=setTimeout(()=>{this._onCodeMouseUp(null)},3e3))}}_onFinaliseTextSelection(){this.textMarkers.mouseState===2&&(this.model.currMarkedTextSelection=new Ie().fromString(`${this.textMarkers.begin}-${this.textMarkers.end}`),this.textMarkers.begin===this.textMarkers.end?this.app.shell.showMessage("Cursor position marked for audio sync"):this._toggleTextMarkups(),this.textMarkers.mouseState=0)}_findNearestCodeElement(e){for(;e&&e!==document.body;){if(e.nodeType===Node.ELEMENT_NODE&&e.tagName==="CODE")return e;e=e.parentNode}return null}_getOffsetWithinElement(e,t,i){let r=0,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);for(;n.nextNode();){let o=n.currentNode;if(o.nodeType===Node.TEXT_NODE?r+=o.nodeValue.length:r+=o.textContent.length,o===t){o.nodeType===Node.TEXT_NODE?r-=o.nodeValue.length-i:r-=o.textContent.length-i;break}}return r}toggleAudioStart(e=!1){this.model.startAudio!==void 0||e?(this.model.startAudio=void 0,this.model.urlRoute.searchParams.delete("startAudio")):(this.model.startAudio=this.shell.view.$controlShellPgAudio.currentTime,this.model.urlRoute.searchParams.set("startAudio",this.model.startAudio.toString())),this.view.$toggleAudStartTrackPgSpan.textContent="Toggle audio start "+(this.model.startAudio?this.model.startAudio.toFixed(2):""),e||this._reloadPageUsingQueryString()}toggleAudioStop(e=!1){this.model.stopAudio!==void 0||e?(this.model.stopAudio=void 0,this.model.urlRoute.searchParams.delete("stopAudio")):(this.model.stopAudio=this.shell.view.$controlShellPgAudio.currentTime,this.model.urlRoute.searchParams.set("stopAudio",this.model.stopAudio.toString())),this.view.$toggleAudStopTrackPgSpan.textContent="Toggle audio stop "+(this.model.stopAudio?this.model.stopAudio.toFixed(2):""),e||this._reloadPageUsingQueryString()}_toggleLineCursor(e=!1){let t=this.model.urlRoute.searchParams.get("cursorLinePosition");this.model.cursorLinePosition=e?void 0:this.model.lineWithPercRef,this.view.$prevLineCursorPos&&(this.view.$prevLineCursorPos.className=""),t!==null||e?this.model.urlRoute.searchParams.delete("cursorLinePosition"):this.model.urlRoute.searchParams.set("cursorLinePosition",`${this.model.lineWithPercRef}`),this.view.$toggleLineCursorTrackPgSpan.textContent="Toggle line cursor "+(this.model.cursorLinePosition??""),e||this._reloadPageUsingQueryString()}_toggleTextMarkups(e=!1){if(e)this.model.markTextRanges.selections.clear();else{if(!this.model.currMarkedTextSelection)return;this.model.currMarkedTextSelection.toNumbers().forEach((t,i,r)=>{this.model.markTextRanges.toggle(t)})}this.model.markTextRanges.selections.size===0?this.model.urlRoute.searchParams.delete("markTextRanges"):this.model.urlRoute.searchParams.set("markTextRanges",this.model.markTextRanges.toString()),this.model.markTextRanges.selections.clear(),e||this._reloadPageUsingQueryString()}_toggleLineHighlight(e=!1){e?this.model.highlightLineRanges.selections.clear():this.model.highlightLineRanges.toggle(parseInt(this.model.lineWithPercRef)),this.model.highlightLineRanges.selections.size===0?this.model.urlRoute.searchParams.delete("highlightLineRanges"):this.model.urlRoute.searchParams.set("highlightLineRanges",this.model.highlightLineRanges.toString()),e||this._reloadPageUsingQueryString()}_onLineNumberBase(e){let t=e.target,i=t.getAttribute("data-ln");if(!(t instanceof HTMLSpanElement)||!i)return!1;let{lineRef:r}=this._getLineClickInfo(e,t);return this.model.lineWithPercRef=r,!0}_onLineNumberClick(e){this._onLineNumberBase(e)&&this._toggleLineHighlight()}_onLineNumberDblClick(e){this._onLineNumberBase(e)&&this._toggleLineCursor()}_reloadPageUsingQueryString(){let e=this._prepareHashUsingSearchParams();this.setLocationHash(e,!0)}_prepareHashUsingSearchParams(){let e=this.model.urlRoute.searchParams.toString();return e=e?"?"+e:"",e&&(e=e.replaceAll("%2C",",")),this.model.urlRoute.ctxHash+e}_getLineClickInfo(e,t){let i=t.parentElement.getBoundingClientRect(),r=(e.clientY-i.top)/i.height,n=t.getBoundingClientRect(),o=n.height>30,a=parseInt(t.id.substring(3)),l=o?(e.clientY-n.top)/n.height:0,c=Math.round((a+l)*100)/100;return{overrallPerc:r,lineNumber:a,linePerc:l,lineRef:c}}async _fetchAndPrepareHeaderMarkdown(){let e=await this.app.albumStoreWorkerClient.readTrackAsMarkdown({trackRef:this.model.trackRef,markupHeaders:!0});if(e.err)throw new Error(`Track /text/suttas/${this.model.trackRef}.txt not found`);this.model.trackMarkdown=e.text;let t=K.lineLengths(this.model.trackMarkdown,this.model.lineStartPositions);return!0}_prepareMarkTextMarkdown(e){this.model.currTrackMarkups=Ei.markupContent(this.model.trackMarkdown,!1,e)}async _onShow(e){let t=e.urlRoute.pathname.substring(s.SUBCTX.length);if(t){let i=!1;this.model.urlRoute=e.urlRoute,this.model.urlRoute.cargo.pageController=this,this.model.lastLoadedPathname!==e.urlRoute.pathname&&(i=!0,this.model.trackRef=t,await this._fetchTrackRecord(),await this._fetchAndPrepareHeaderMarkdown(),this.visitations=1),this._saveSearchParamPositionToModel();let r=this._saveSearchParamAudioPositionsToModel();this._saveSearchParamHighlightLinesToModel(),this._saveSearchParamMarkupsToModel(),this._refreshTrackMetadata(e.urlRoute);let n=await this._refreshTrackText();await this._refreshTrackAudio(i,r),this._onRefreshCursorPositionAndHighlighting(),this.$menuItem.hash=this._prepareHashUsingSearchParams(),this.model.persistentModel.href=this.$menuItem.hash}await super._onShow(e)}_onRefreshCursorPositionAndHighlighting(){let e=this.scrollYPos;this.scrollToLineNumberIfRqd(),Ai.highlightLinesIfRqd(this.view.$textTrackPgPre),this.visitations>1&&this.setScrollPosition(void 0,e)}scrollToLineNumberIfRqd(){let e,t=this.model.urlRoute.searchParams.get("cursorLinePosition");if(t){e=parseInt(t);let i=this.scrollToLineNumberScrollYPos(parseFloat(t));i!==void 0&&(this.scrollYPos=i)}return e}scrollToLineNumberScrollYPos(e){let t,i=parseInt(`${e}`),r=e-i,n=document.getElementById(`_ln${i}`);if(this.view.$prevLineCursorPos&&this.view.$prevLineCursorPos!==n&&(this.view.$prevLineCursorPos.className=""),n){n.className=s.SELECTED_CSS;let o=n.scrollHeight,l=n.getBoundingClientRect().top+window.scrollY+o*r,c=window.innerHeight||document.documentElement.clientHeight;t=l-c/2,this.view.$prevLineCursorPos=n}return t}async _fetchTrackRecord(){let e=await this.app.albumStoreWorkerClient.selectTrackWhere({trackRef:this.model.trackRef});this.model.trackRecord=e.track}_refreshTrackMetadata(e){this.view.$trackRefTrackPgA.textContent=this.model.trackRef,this.view.$trackRefTrackPgA.href=Pe.toHref(this.model.trackRef),this.view.$toggleLineCursorTrackPgSpan.textContent="Toggle line cursor "+(this.model.cursorLinePosition??""),this.view.$toggleAudStartTrackPgSpan.textContent="Toggle audio start "+(this.model.startAudio?this.model.startAudio.toFixed(2):""),this.view.$toggleAudStopTrackPgSpan.textContent="Toggle audio stop "+(this.model.stopAudio?this.model.stopAudio.toFixed(2):""),this.view.$autoScrollWithAudioTrackPgInput.checked=this.shell.app.model.textSettings.autoScrollWithAudio}async _refreshTrackText(){let e=this.view.$textTrackPgPre,t="urlRoute"in e?e.urlRoute:void 0;return this.view.$textTrackPgPre.urlRoute=this.model.urlRoute,(this.model.lastLoadedPathname!==this.model.urlRoute.pathname||this.model.prevTrackMarkups!==this.model.currTrackMarkups)&&(this.view.$textTrackPgCode.textContent=this.model.currTrackMarkups,this.model.prevTrackMarkups=this.model.currTrackMarkups,O.highlightElement(this.view.$textTrackPgCode,!1)),this.model.lastLoadedPathname=this.model.urlRoute.pathname,t}async _refreshTrackAudio(e,t){this.shell.model.trackModel=this.model,this.shell.model.playlist||this.shell.model.mount(this.model.playlist,this),await this.app.model.shell.setAudioTrackSrc(e,t)}scrollToLineWithPerc(e){this.setScrollPosition(void 0,this.scrollToLineNumberScrollYPos(e)),super.moveToScrollPosition({urlRoute:this.model.urlRoute,restorePosition:!0})}},ur=class{$trackRefTrackPgA=document.getElementById("trackRefTrackPgA");$textTrackPgPre=document.getElementById("textTrackPgPre");$textTrackPgCode=document.getElementById("textTrackPgCode");$copyBookmarkTrackPgA=document.getElementById("copyBookmarkTrackPgA");$toggleLineCursorTrackPgA=document.getElementById("toggleLineCursorTrackPgA");$toggleLineCursorTrackPgSpan=document.getElementById("toggleLineCursorTrackPgSpan");$toggleTextSelTrackPgA=document.getElementById("toggleTextSelTrackPgA");$toggleLineHighlightTrackPgA=document.getElementById("toggleLineHighlightTrackPgA");$syncAudioTrackPgA=document.getElementById("syncAudioTrackPgA");$toggleAudStartTrackPgA=document.getElementById("toggleAudStartTrackPgA");$toggleAudStartTrackPgSpan=document.getElementById("toggleAudStartTrackPgSpan");$toggleAudStopTrackPgA=document.getElementById("toggleAudStopTrackPgA");$toggleAudStopTrackPgSpan=document.getElementById("toggleAudStopTrackPgSpan");$clearBookmakTrackPgSelect=document.getElementById("clearBookmakTrackPgSelect");$autoScrollWithAudioTrackPgInput=document.getElementById("autoScrollWithAudioTrackPgInput");$prevLineCursorPos;controller;constructor(e){this.controller=e}};var Ri=class extends A{type="TextSettingsModel";autoScrollWithAudio=!1;findInPageCriteria=""},xi=class extends A{type="AudioSettingsModel";playbackRate=1;autoPlay=!0;playNext=!0;repeat=!1;skipSize=5;applyStopStartRange=!0},Ci=class extends A{type="GeneralSettingsModel";darkTheme=!1;useTransfer=0};var Mi=class{audioState=-1;playlist;playlistController;trackModel;startTime;stopTime;currentTime;lastSyncTime=0;preventOnTimeUpdate=!1;onAudioPlayEnd;onAudioResetTimeTo;onAudioStateChange;onAudioTimeChange;onAudioTrackConfigChange;onAudioTrackSrcChange;onMountChange;onPlayToggle;onSkipWithinTrack;onSyncTextWithAudioIfReqd;onTrackIndexChange;mount(e,t){this.playlist===e&&this.playlistController===t||(this.audioState=-1,this.playlist=e,this.playlistController=t,this.onMountChange(e))}async setAudioTrackSrc(e,t){if((e||t)&&(this.startTime=this.trackModel.startAudio===void 0?0:this.trackModel.startAudio,this.stopTime=this.trackModel.stopAudio===void 0?this.trackModel.trackRecord.duration:this.trackModel.stopAudio,this.lastSyncTime=this.startTime),e){let i=ce.queryTrackHtmlAudioSrcRef(this.trackModel.trackRef);await this.onAudioTrackSrcChange(i,this.playlist.selectedPlaylistItem)}else t&&this.onAudioTrackConfigChange()}async playToggle(e){await this.onPlayToggle(e)}hasPrevious(){return this.playlist?this.playlist.getSelectionItem()>0:!1}hasNext(){return this.playlist?this.playlist.getSelectionItem()<this.playlist.items.length-1:!1}playNext(){return this._playNextPrev(1)}playPrevious(){return this._playNextPrev(-1)}skipWithinTrack(e){e!==0&&this.onSkipWithinTrack(e)}async setAudioState(e){let t=this.audioState;this.audioState=e,this.onAudioStateChange(t,e),this.audioState===6&&await this.onAudioPlayEnd()}getAudioState(){return this.audioState}async receiveTimeUpdate(e,t){let[i,r]=this.adjustTimeWithinStartStopRangesIfReqd(e,t);if(i!==e){if(this.currentTime=i,r&&(this.audioState===4&&await this.playToggle(!0),await this.onAudioPlayEnd()))return;this.preventOnTimeUpdate=!0,this.onAudioResetTimeTo(i)}this.onAudioTimeChange(i),this._notifySyncTextWithAudioIfReqd(i)}adjustTimeWithinStartStopRangesIfReqd(e,t){let i=[e,!1];return t&&(e<this.startTime?i[0]=this.startTime:e>this.stopTime&&this.stopTime!==this.trackModel.trackRecord.duration&&(i[0]=this.stopTime,i[1]=!0)),i}_notifySyncTextWithAudioIfReqd(e){let t=e-this.lastSyncTime;if(Math.abs(t)>3){this.lastSyncTime=e;let i=e/this.trackModel.trackRecord.duration;this.onSyncTextWithAudioIfReqd(e,i)}}_playNextPrev(e){let t=e>0?this.hasNext():this.hasPrevious();if(t){let i=this.playlist.getSelectionItem();this.playlist.setSelectionItem(i+e),this.onTrackIndexChange(e,i,i+e)}return t}};var pr=class extends A{type="TrackPersistentModel";href},Li=class{persistentModel=new pr;trackRef;cursorLinePosition;highlightLineRanges=new Ie;markTextRanges=new Ie;startAudio;stopAudio;trackRecord;trackMarkdown;lineStartPositions=[];currAudioConfig;prevAudioConfig;currTrackMarkups;prevTrackMarkups;urlRoute;lastLoadedPathname;lineWithPercRef;currMarkedTextSelection;playlist=new G(void 0,"1","Single track playlist");constructor(){this.playlist.items.push(this),this.playlist.setSelectionItem(0)}async save(e){await this.persistentModel.save(e)}async restore(e){await this.persistentModel.restore(e)}estimateAudioPosition(e){return e/this.lineStartPositions[this.lineStartPositions.length-1]*this.trackRecord.duration}estimateTextSyncPosition(e){let t=this.lineStartPositions[this.lineStartPositions.length-1]*e,i=this.getLineNumber(t),r=this.lineStartPositions[i]-this.lineStartPositions[i-1],n=t-this.lineStartPositions[i-1],o=Math.round(100*n/r)/100;return[i,o]}getLineNumber(e){let t=0;for(let i=0;i<this.lineStartPositions.length;i++)if(this.lineStartPositions[i]>e){t=i;break}return t}};var $i=class{static bindRpc(e){let t=e;t.api||(t.api=0),t.bindRpcFunc(t,e.updateTrackCacheInfo,{}),t.bindRpcFunc(t,e.selectAllAlbums,{hasNoArgs:!0,hasReturn:!0}),t.bindRpcFunc(t,e.selectAlbumWhere,{hasReturn:!0}),t.bindRpcFunc(t,e.selectAllTracksForAlbumWhere,{hasReturn:!0}),t.bindRpcFunc(t,e.selectTrackWhere,{hasReturn:!0}),t.bindRpcFunc(t,e.selectTracksWhere,{hasReturn:!0}),t.bindRpcFunc(t,e.selectKeywordsList,{hasNoArgs:!0,hasReturn:!0}),t.bindRpcFunc(t,e.readFileAsText,{hasReturn:!0}),t.bindRpcFunc(t,e.readTrackAsMarkdown,{hasReturn:!0})}};var Hi=class extends le{__getName__(){return"AlbumStoreWorkerClient"}_bindMethods(){super._bindMethods(),$i.bindRpc(this)}async updateTrackCacheInfo(e){let t=this._prepareMessage(this.updateTrackCacheInfo,e),i=await this._postMessage(this._getRecipient(),t)}async selectAllAlbums(){let e=this._prepareMessage(this.selectAllAlbums);return(await this._postMessage(this._getRecipient(),e)).resp}async selectAlbumWhere(e){let t=this._prepareMessage(this.selectAlbumWhere,e);return(await this._postMessage(this._getRecipient(),t)).resp}async selectAllTracksForAlbumWhere(e){let t=this._prepareMessage(this.selectAllTracksForAlbumWhere,e);return(await this._postMessage(this._getRecipient(),t)).resp}async selectTrackWhere(e){let t=this._prepareMessage(this.selectTrackWhere,e);return(await this._postMessage(this._getRecipient(),t)).resp}async selectTracksWhere(e){let t=this._prepareMessage(this.selectTracksWhere,e);return(await this._postMessage(this._getRecipient(),t)).resp}async selectKeywordsList(){let e=this._prepareMessage(this.selectKeywordsList);return(await this._postMessage(this._getRecipient(),e)).resp}async readFileAsText(e){let t=this._prepareMessage(this.readFileAsText,e);return(await this._postMessage(this._getRecipient(),t)).resp}async readTrackAsMarkdown(e){let t=this._prepareMessage(this.readTrackAsMarkdown,e);return(await this._postMessage(this._getRecipient(),t)).resp}};var wt=class s{static queryServiceWorkerReadyState(e){if(e){if(e.active)return"active";if(e.installing)return"installing";if(e.waiting)return"waiting"}else return"unregistered";throw new Error("IllegalState: Unknown service worker ready state")}static async queryServiceWorkerRegistrations(e,t){let i=await navigator.serviceWorker.getRegistrations(),r={total:i.length,active:0,installing:0,waiting:0,registrations:Array.from(i)};return i.forEach((n,o,a)=>{s.updateUpdateFoundListener(n,t);let l=n.installing||n.active||n.waiting;s.updateStateChangeListener(l,e);let c=s.queryServiceWorkerReadyState(n);r[c]=r[c]+1}),r}static updateStateChangeListener(e,t,i){e.removeEventListener("statechange",i||t),e.addEventListener("statechange",t)}static updateUpdateFoundListener(e,t,i){e.removeEventListener("updatefound",i||t),e.addEventListener("updatefound",t)}};var gr=class{shell=new Mi;catalog=new Pe;search=new vt;playlists=new gt;track=new Li;audioSettings=new xi;textSettings=new Ri;generalSettings=new Ci;async saveAll(){let e=new ae(new ve);for(let t in this){let i=this;"save"in i[t]&&await i[t].save(e),"commit"in i[t]&&await i[t].commit(e)}}async restoreAll(){let e=new ae(new ve);for(let t in this){let i=this;"restore"in i[t]&&await i[t].restore(e)}}},li=class s{static VERSION="2.1.0";isFactoryReset=!1;model=new gr;appConfig;router;shell;catalog;trackPage;catalogPage;searchPage;playlistPage;aboutPage;helpPage;e404Page;pagesControllers=[];albumStoreWorkerClient;swRegStates;_onSwStateChange=e=>{e.target.state==="installed"&&(this.shell.showMessage("Precaching completed!"),this.swRegStates.total>0&&this.shell.showPrompt("A new App version is available! Select Okay to activate it now.",i=>{let r=setInterval(()=>{let n=1;console.log(`trying after: ${n}s`),n++>10&&clearInterval(r),this.swRegStates.registrations[0].waiting&&(this.swRegStates.registrations[0].waiting.postMessage({type:"skipWaiting"}),window.location.reload(),clearInterval(r))},1e3)}))};_onSwRegUpdateFound=e=>{console.log(`updateFound > swRegStates: ${JSON.stringify(this.swRegStates)}`),this.swRegStates.total>0&&(this.shell.showMessage("Precaching App update in the background...",0),this.swRegStates.registrations[0].installing.addEventListener("statechange",this._onSwStateChange))};async asyncConstructor(){await this.model.restoreAll(),this.appConfig=await s._queryAppConfig(),this.router=new D(this.appConfig.appRoot,!0),this.shell=new ai(this),this.shell.launch(),await this._manageServiceWorkerState(),this._registerRoutes(),this._registerWorkers();let e=await this.albumStoreWorkerClient.selectAllAlbums();this.catalog=e.albums;for(let t=0;t<this.pagesControllers.length;t++)await this.pagesControllers[t].asyncConstructor()}run(){console.log(`SuttaPlayer v${s.VERSION} started`),window.addEventListener("load",async()=>{await this.asyncConstructor(),await this.router.start()}),window.addEventListener("visibilitychange",async e=>{this.isFactoryReset?this.isFactoryReset=!1:await this.model.saveAll(),this.shell.terminate()})}async reset(){this.isFactoryReset=!0;try{this.appConfig.isProd&&await navigator.serviceWorker.ready.then(e=>e.unregister()),caches.keys().then(e=>Promise.all(e.map(t=>caches.delete(t)))),localStorage.clear(),window.location.reload()}catch(e){console.error("IllegalState: Failed to factory reset",e)}}async _manageServiceWorkerState(){this.swRegStates=await wt.queryServiceWorkerRegistrations(this._onSwStateChange,this._onSwRegUpdateFound),this.appConfig.isProd&&this.swRegStates.total===0&&await this._registerPrecacheAudioRouteServiceWorker()}async _registerPrecacheAudioRouteServiceWorker(){let e=this.appConfig.precacheAudioRouteServiceWorker,i=await new Promise(r=>{navigator.serviceWorker.register(e.scriptURL,{...e,name:"precacheAudioRouteServiceWorker"}).then(n=>{wt.updateUpdateFoundListener(n,this._onSwRegUpdateFound),n.installing&&this.shell.showMessage("Precaching App & sutta texts in the background...",0);let o=n.installing||n.active||n.waiting;wt.updateStateChangeListener(o,this._onSwStateChange),r(o)})})}_registerRoutes(){this.catalogPage=new vi(this,this.shell,"catalogPageSection","catMenuShellPgA"),this.searchPage=new Si(this,this.shell,"searchPageSection","srchMenuShellPgA"),this.playlistPage=new wi(this,this.shell,"playlistPageSection","playMenuShellPgA"),this.aboutPage=new ui(this,this.shell,"aboutPageSection","abtMenuShellPgA"),this.helpPage=new yi(this,this.shell,"helpPageSection","hlpMenuShellPgA"),this.trackPage=new Ii(this,this.shell,"trackPageSection","trackMenuShellPgA"),this.e404Page=new ci(this,this.shell,"e404PageSection",null);let e=async(t,i,r,n)=>{let o={urlRoute:r,restorePosition:!1};t&&await t.onExit(),o.restorePosition=n<2,await i.onEnter(o)};this.router.onroutechange=e,this.router.onrouteerror=async(t,i)=>{this.shell.showMessage(i,500)}}_registerWorkers(){let e=this.appConfig.albumStoreWorker,t=new Worker(e.scriptURL,{...e,name:"albumStoreWorker"}),i=new we(t);this.albumStoreWorkerClient=new Hi(i),this.albumStoreWorkerClient.startClient()}static async _queryAppConfig(){let i=`./bin/app-config${document.getElementById("importMapScript")!==null?"-dev":""}.json`,n=await(await fetch(i)).json(),o=location.host,a=n.hosts.indexOf(o),l="";return a>-1?l=n.appRoots[a]:(console.log(`registered hosts: ${n.hosts}`),console.log(`registered appRoots: ${n.appRoots}`)),console.log(`host: ${o}`),console.log(`appRoot: ${l}`),{...n,host:o,appRoot:l}}static{A.VER=s.VERSION,A.VER_TUPLE=A.toVersionTuple(A.VER),new s().run()}};})();
